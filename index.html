<!DOCTYPE html>



  


<html class="theme-next muse use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">



  
  
    
    
  <script src="/lib/pace/pace.min.js?v=1.0.2"></script>
  <link href="/lib/pace/pace-theme-minimal.min.css?v=1.0.2" rel="stylesheet">







<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  
    
      
    

    
  

  
    
      
    

    
  

  
    
      
    

    
  

  
    
    
    <link href="//fonts.cat.net/css?family=Roboto Slab:300,300italic,400,400italic,700,700italic|Roboto Slab:300,300italic,400,400italic,700,700italic|Lobster Two:300,300italic,400,400italic,700,700italic|PT Mono:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=6.3.0" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=6.3.0">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=6.3.0">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=6.3.0">


  <link rel="mask-icon" href="/images/logo.svg?v=6.3.0" color="#222">





  <meta name="keywords" content="Hexo, NexT" />




  


  <link rel="alternate" href="/atom.xml" title="XieJava's blog" type="application/atom+xml" />






<meta property="og:type" content="website">
<meta property="og:title" content="XieJava&#39;s blog">
<meta property="og:url" content="http://xiejava.ishareread.com/index.html">
<meta property="og:site_name" content="XieJava&#39;s blog">
<meta property="article:author" content="XieJava">
<meta name="twitter:card" content="summary">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    version: '6.3.0',
    sidebar: {"position":"right","display":"hide","offset":12,"b2t":false,"scrollpercent":true,"onmobile":true},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: 'undefined',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://xiejava.ishareread.com/"/>





  <title>XieJava's blog</title>
  








<meta name="generator" content="Hexo 4.2.1"></head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-right 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">XieJava's blog</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <h1 class="site-subtitle" itemprop="description">记录最好的自己</h1>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-question-circle"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            关于
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://xiejava.ishareread.com/posts/91eaa3b2/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="XieJava">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="https://img9.doubanio.com/icon/ul70489051-4.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="XieJava's blog">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/posts/91eaa3b2/" itemprop="url">5分钟，我搭了一套AI知识库</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2025-12-09T20:00:42+08:00">
                2025-12-09
              </time>
            

            
              <span class="post-meta-divider">|</span>
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-check-o"></i>
              </span>
              
                <span class="post-meta-item-text">更新于&#58;</span>
              
              <time title="更新于" itemprop="dateModified" datetime="2025-12-10T08:58:41+08:00">
                2025-12-10
              </time>
            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%8A%80%E6%9C%AF/" itemprop="url" rel="index">
                    <span itemprop="name">技术</span>
                  </a>
                </span>

                
                
                  ， 
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%8A%80%E6%9C%AF/AI/" itemprop="url" rel="index">
                    <span itemprop="name">AI</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/posts/91eaa3b2/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count valine-comment-count" data-xid="/posts/91eaa3b2/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          
             <span id="/posts/91eaa3b2/" class="leancloud_visitors" data-flag-title="5分钟，我搭了一套AI知识库">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数&#58;</span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  2.1k
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">
                  7
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>一直以来都想把我的文档都集中起来建一套知识库，方便统一的搜索查询和调用。我用过很多的文档编写管理工具有在线的、离线的，包括有有道云笔记、语雀、飞书、Notion、Obsidian等。这些工具编写管理文档还可以但是要做为一个知识库还远远不够。我认为知识库不但要解决“知识存哪里” 的问题，更要解决 “知识怎么用” 的痛点，能够将多源的知识内容进行聚合，方便检索查询和使用。</p>
<p>我需要的知识库系统能够具备以下能力：</p>
<ul>
<li>多源内容聚合的能力：能够将我的博客网站、飞书、语雀、离线的文档等都能导入到知识库中。</li>
<li>方便快捷的搜索能力：AI辅助搜索，能够随时快速找到我想要的东西，AI辅助问答，能够基于已有的知识快速给出比较靠谱的答案。</li>
<li>便捷强大的编辑能力：能够通过富文本、Markdown随时记录文本，通过AI来辅助创作。</li>
</ul>
<p>几番比较找到了PandaWiki，这款开源AI大模型驱动的知识库搭建系统，我觉得满足了目前我对知识库的要求，其安装方便、使用便捷、免费开源，零成本就能拥有自己的AI知识库，目前在github上斩获了8.4K的Star说明了受欢迎的程度。</p>
<h1 id="一、什么是PandaWiki"><a href="#一、什么是PandaWiki" class="headerlink" title="一、什么是PandaWiki"></a>一、什么是PandaWiki</h1><p>PandaWiki 是一款 AI 大模型驱动的开源知识库搭建系统，帮助你快速构建智能化的 产品文档、技术文档、FAQ、博客系统，借助大模型的力量为你提供 AI 创作、AI 问答、AI 搜索等能力，具备富文本编辑、第三方集成和内容导入能力，采用AGPL-3.0开源协议。</p>
<p>它的核心价值在于将 AI 能力与知识库深度融合，不仅解决了 “知识存哪里” 的问题，更攻克了 “知识怎么用” 的痛点。<br><img src="https://xiejava1018.github.io/xiejavaimagesrc/images/2025/20251209/1-PandaWiki.png" alt="PandaWiki"><br>PandaWiki 的功能设计围绕 “智能化” 与 “便捷性” 展开，核心可概括为三大 AI 功能与五大实用特性，覆盖知识库从搭建到使用的全场景需求：</p>
<table>
<thead>
<tr>
<th>类别</th>
<th>具体功能</th>
<th>价值说明</th>
</tr>
</thead>
<tbody><tr>
<td>AI 核心功能</td>
<td>AI 创作</td>
<td>辅助生成、优化文档内容，降低内容生产门槛，提升写作效率</td>
</tr>
<tr>
<td></td>
<td>AI 问答</td>
<td>支持用户以自然语言提问，AI 基于知识库内容精准作答，而非返回杂乱链接</td>
</tr>
<tr>
<td></td>
<td>AI 搜索</td>
<td>依托 AI 大模型实现语义化搜索，精准匹配用户需求，解决传统关键词搜索的局限性</td>
</tr>
<tr>
<td>实用特性</td>
<td>富文本编辑</td>
<td>支持 Markdown 与 HTML 语法，满足不同用户编辑习惯；文档可导出为 Word、PDF、Markdown 格式</td>
</tr>
<tr>
<td></td>
<td>多渠道内容导入</td>
<td>支持通过飞书文档、Notion、URL、Sitemap、RSS 及离线文件导入内容，省去重复复制粘贴操作</td>
</tr>
<tr>
<td></td>
<td>第三方平台集成</td>
<td>可接入钉钉、飞书、企业微信、Discord 等平台的聊天机器人，实现 “随处查知识”</td>
</tr>
<tr>
<td></td>
<td>高度自定义</td>
<td>支持配置 Wiki 网站配色、背景图、水印、页脚（企业名称、ICP 备案、品牌 Logo 等），打造专属风格</td>
</tr>
<tr>
<td></td>
<td>数据统计与反馈</td>
<td>管理后台可实时查看 Wiki 网站的访问次数、用户分布、问答记录及反馈信息，便于优化内容</td>
</tr>
</tbody></table>
<p>PandaWiki 的最大优势之一是 “低门槛”—— 无需复杂代码开发，提供了一键部署安装脚本，全程耗时不超过 5 分钟，即使是非技术人员也能轻松上手。</p>
<h1 id="二、PandaWiki的安装部署"><a href="#二、PandaWiki的安装部署" class="headerlink" title="二、PandaWiki的安装部署"></a>二、PandaWiki的安装部署</h1><h2 id="1、部署前的准备"><a href="#1、部署前的准备" class="headerlink" title="1、部署前的准备"></a>1、部署前的准备</h2><p>PandaWiki的官方文档见 <a href="https://pandawiki.docs.baizhi.cloud/node/01971602-bb4e-7c90-99df-6d3c38cfd6d5" target="_blank" rel="noopener">https://pandawiki.docs.baizhi.cloud/node/01971602-bb4e-7c90-99df-6d3c38cfd6d5</a></p>
<p>PandaWiki安装需Linux系统、x86_64架构，依赖Docker 20.10.14+和Docker Compose 2.0.0+，推荐1核2G内存10G磁盘。<br>安装 PandaWiki 系统环境要求如下：</p>
<ul>
<li>操作系统：Linux</li>
<li>CPU 指令架构：x86_64、aarch64</li>
<li>软件依赖：Docker 20.10.14 版本以上</li>
<li>软件依赖：Docker Compose 2.0.0 版本以上</li>
<li>推荐配置：2 核 CPU / 4 GB 内存 / 20 GB 磁盘</li>
<li>最低配置：1 核 CPU / 2 GB 内存 / 5 GB 磁盘</li>
</ul>
<p>我的配置是ubuntu系统2核CPU/4GB内存/100GB磁盘。</p>
<h2 id="2、安装PandaWiki"><a href="#2、安装PandaWiki" class="headerlink" title="2、安装PandaWiki"></a>2、安装PandaWiki</h2><p>官方提供了一键自动安装命令，可以非常便捷无脑的就把系统给装上。<br>使用 root 权限登录你的服务器，然后执行以下命令。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bash -c <span class="string">"<span class="variable">$(curl -fsSLk https://release.baizhi.cloud/panda-wiki/manager.sh)</span>"</span></span><br></pre></td></tr></table></figure>

<p><img src="https://xiejava1018.github.io/xiejavaimagesrc/images/2025/20251209/2-%E5%AE%89%E8%A3%85%E7%95%8C%E9%9D%A2.png" alt="安装界面"><br>选择“安装”，回车<br><img src="https://xiejava1018.github.io/xiejavaimagesrc/images/2025/20251209/3-%E5%AE%89%E8%A3%85docker.png" alt="安装"><br>系统检测到没有安装docker，输入“y”,系统自动安装docker<br><img src="https://xiejava1018.github.io/xiejavaimagesrc/images/2025/20251209/4-%E8%BE%93%E5%85%A5%E5%AE%89%E8%A3%85%E7%9B%AE%E5%BD%95.png" alt="自动安装docker"></p>
<p>默认安装路径位于 <code>/data/pandawiki</code><br>到显示所有容器安装完成并启动就会显示如下信息</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">SUCCESS  控制台信息:</span><br><span class="line">SUCCESS    访问地址(内网): https://*.*.*.*:2443</span><br><span class="line">SUCCESS    访问地址(外网): https://*.*.*.*:2443</span><br><span class="line">SUCCESS    用户名: admin</span><br><span class="line">SUCCESS    密码: **********************</span><br></pre></td></tr></table></figure>

<p>修改默认密码</p>
<blockquote>
<p>如果需要修改admin的密码可以修改安装目录下.env文件中的 ADMIN_PASSWORD 后，执行</p>
<p><code>bash docker compose up -d</code></p>
<p>即可生效。</p>
</blockquote>
<p>使用浏览器打开上述内容中的 “访问地址”，就可以看到 PandaWiki 的控制台登录入口。</p>
<p><img src="https://xiejava1018.github.io/xiejavaimagesrc/images/2025/20251209/5-PandaWiki%E7%99%BB%E5%BD%95%E7%95%8C%E9%9D%A2.png" alt="Panda登录地址"></p>
<h1 id="三、PandaWiki的使用"><a href="#三、PandaWiki的使用" class="headerlink" title="三、PandaWiki的使用"></a>三、PandaWiki的使用</h1><h2 id="1、配置-AI-大模型"><a href="#1、配置-AI-大模型" class="headerlink" title="1、配置 AI 大模型"></a>1、配置 AI 大模型</h2><p>由于 PandaWiki 的 AI 功能（创作、问答、搜索）均依赖 AI 大模型，首次使用需先完成模型配置，否则相关功能无法正常使用。其支持的模型类型及推荐方案如下：</p>
<ul>
<li>Chat 模型：用于对话与内容生成，如 ChatGPT-4、Deepseek-r1、Deepseek-v3 等</li>
<li>Embedding 模型：将文档转化为向量，支撑智能搜索与内容关联，如 BGE-M3</li>
<li>Reranker 模型：对搜索结果二次排序，提升检索精准度，如 BGE-Reranker-V2-M3</li>
</ul>
<p>我这里直接使用PandaWiki默认的模型“自动配置”。自动配置需要点击“获取百智云API Key”来获取API Key，注册登录百智云就可以获取5元的免费额度。当然通过手动配置用其他的模型API也可以。<br><img src="https://xiejava1018.github.io/xiejavaimagesrc/images/2025/20251209/6-%E9%85%8D%E7%BD%AE%E5%A4%A7%E6%A8%A1%E5%9E%8B%E7%95%8C%E9%9D%A2.png" alt="配置大模型"></p>
<h2 id="2、启用创建门户网站"><a href="#2、启用创建门户网站" class="headerlink" title="2、启用创建门户网站"></a>2、启用创建门户网站</h2><p>启用创建门户网站PandaWiki会自动帮创建一个门户网站，可以自定义门户网站的模板，“启用HTTP”输入暴露的端口80就可以开启门户网站，注意不要和2443端口重了，2443是后台admin的管理服务。<br><img src="https://xiejava1018.github.io/xiejavaimagesrc/images/2025/20251209/7-%E5%88%9B%E5%BB%BA%E9%97%A8%E6%88%B7%E7%BD%91%E7%AB%99.png" alt="创建门户网站"></p>
<p>通过简单的配置就可以生成一个wiki网站，如果有域名就可以通过域名访问了，没有域名就通过IP访问。<br>我这里配了域名，可以通过wiki.xiejava.dpdns.org访问。<br><img src="https://xiejava1018.github.io/xiejavaimagesrc/images/2025/20251209/8-%E8%AE%BF%E9%97%AE%E9%97%A8%E6%88%B7%E7%BD%91%E7%AB%99.png" alt="wiki门户网站"></p>
<h2 id="3、导入文档到PandaWiki创建知识库"><a href="#3、导入文档到PandaWiki创建知识库" class="headerlink" title="3、导入文档到PandaWiki创建知识库"></a>3、导入文档到PandaWiki创建知识库</h2><p>PandaWiki 支持从第三方文档中导入文档，目前支持以下几种方式</p>
<ul>
<li>通过离线文件导入</li>
<li>通过 URL 导入</li>
<li>通过 RSS 导入</li>
<li>通过 Sitemap 导入</li>
<li>通过 Notion 导入</li>
<li>通过 Epub 导入</li>
<li>通过 MiniDoc 导入</li>
<li>通过 Wiki.js 导入</li>
<li>通过 Confluence 导入</li>
<li>通过飞书文档导入</li>
<li>通过语雀导入</li>
<li>通过思源笔记导入</li>
</ul>
<p>官方都有详细的说明文档<br>我这里将我的博客文档通过离线方式进行导入。<br><img src="https://xiejava1018.github.io/xiejavaimagesrc/images/2025/20251209/9-%E9%80%89%E6%8B%A9%E5%AF%BC%E5%85%A5%E7%A6%BB%E7%BA%BF%E6%96%87%E4%BB%B6.png" alt="离线导入文件"></p>
<p>在离线文件导入界面选择要导入的文件，支持的格式包括<code>.txt、.md、.xlx、.xlsx、.docx、.pdf</code> 。<br>注意：每个文件的大小不能超过 20 MB。<br><img src="https://xiejava1018.github.io/xiejavaimagesrc/images/2025/20251209/10-%E5%AF%BC%E5%85%A5%E7%A6%BB%E7%BA%BF%E6%96%87%E4%BB%B6%E7%95%8C%E9%9D%A2.png" alt="导入文件"></p>
<p>选择要导入的文件后，会对.md文件自动进行解析。<br><img src="https://xiejava1018.github.io/xiejavaimagesrc/images/2025/20251209/11-%E5%AF%BC%E5%85%A5%E7%A6%BB%E7%BA%BF%E6%96%87%E4%BB%B6.png" alt="解析文件"></p>
<p>解析完了点击“批量导入”，就可以将文件导入到知识库，并且展示的是解析后的富文本形式。<br><img src="https://xiejava1018.github.io/xiejavaimagesrc/images/2025/20251209/12-%E6%89%B9%E9%87%8F%E5%AF%BC%E5%85%A5%E6%96%87%E4%BB%B6.png" alt="批量导入"></p>
<p>批量导入处理中<br><img src="https://xiejava1018.github.io/xiejavaimagesrc/images/2025/20251209/13-%E6%89%B9%E9%87%8F%E5%AF%BC%E5%85%A5%E4%B8%AD.png" alt="批量导入中"></p>
<p>新导入的文件虽然是可以被可见、被访问、被问答，但是还没有进行增强学习处理需要进一步的学习<br><img src="https://xiejava1018.github.io/xiejavaimagesrc/images/2025/20251209/14-%E5%AD%A6%E4%B9%A0%E6%96%87%E4%BB%B6.png" alt="发布和学习"></p>
<p>PandaWiki的文档处理状态如下图：<br><img src="https://xiejava1018.github.io/xiejavaimagesrc/images/2025/20251209/15-%E6%96%87%E6%A1%A3%E5%A4%84%E7%90%86%E7%8A%B6%E6%80%81.png" alt="文档处理状态"></p>
<p>选择需要学习的文档点“确认”进行学习<br><img src="https://xiejava1018.github.io/xiejavaimagesrc/images/2025/20251209/16-%E7%A1%AE%E8%AE%A4%E5%AD%A6%E4%B9%A0.png" alt="学习和发布"></p>
<p>当学习和发布完成后，可以在web门户网站进行AI检索和AI问答了。<br><img src="https://xiejava1018.github.io/xiejavaimagesrc/images/2025/20251209/17-%E5%90%91AI%E6%8F%90%E9%97%AE.png" alt="AI问答"></p>
<p><img src="https://xiejava1018.github.io/xiejavaimagesrc/images/2025/20251209/18-AI%E6%A3%80%E7%B4%A2%E7%9F%A5%E8%AF%86%E5%BA%93.png" alt="AI问答"></p>
<p>我们可以将pandawiki直接当一个博客网站来使用，它对markdown的解析和展示还挺好的。<br><img src="https://xiejava1018.github.io/xiejavaimagesrc/images/2025/20251209/19-AI-Wiki.png" alt="pandawiki博客站点"></p>
<p>欢迎访问我的wiki站点 <a href="https://wiki.xiejava.dpdns.org" target="_blank" rel="noopener">https://wiki.xiejava.dpdns.org</a> 在这里我将和你一起分享IT技术，感受AI带来的便捷。</p>
<hr>
<p>作者博客：<a href="http://xiejava.ishareread.com/">http://xiejava.ishareread.com/</a></p>
<center> 

<br>

<p><img src="https://xiejava1018.github.io/xiejavaimagesrc/images/fullbug%E5%BE%AE%E4%BF%A1%E5%85%AC%E4%BC%97%E5%8F%B7.jpg" alt="“fullbug”微信公众号" title="“fullbug”微信公众号"> </p>
<p>关注：微信公众号,一起学习成长！</center></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://xiejava.ishareread.com/posts/3ea90a75/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="XieJava">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="https://img9.doubanio.com/icon/ul70489051-4.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="XieJava's blog">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/posts/3ea90a75/" itemprop="url">企业级私有docker镜像仓库Harbor的搭建和使用</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2025-12-04T11:22:22+08:00">
                2025-12-04
              </time>
            

            
              <span class="post-meta-divider">|</span>
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-check-o"></i>
              </span>
              
                <span class="post-meta-item-text">更新于&#58;</span>
              
              <time title="更新于" itemprop="dateModified" datetime="2025-12-04T14:11:19+08:00">
                2025-12-04
              </time>
            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%8A%80%E6%9C%AF/" itemprop="url" rel="index">
                    <span itemprop="name">技术</span>
                  </a>
                </span>

                
                
                  ， 
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%8A%80%E6%9C%AF/%E6%9E%B6%E6%9E%84/" itemprop="url" rel="index">
                    <span itemprop="name">架构</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/posts/3ea90a75/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count valine-comment-count" data-xid="/posts/3ea90a75/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          
             <span id="/posts/3ea90a75/" class="leancloud_visitors" data-flag-title="企业级私有docker镜像仓库Harbor的搭建和使用">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数&#58;</span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  1.4k
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">
                  5
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="一、什么是Harbor"><a href="#一、什么是Harbor" class="headerlink" title="一、什么是Harbor"></a>一、什么是Harbor</h1><p>简单来说，Harbor 是一个开源的企业级私有 Docker 镜像仓库服务。我们可以把它理解成一个 “私有的、安全的、功能强大的 Docker Hub”。</p>
<ul>
<li>私有： 它部署在你自己的基础设施（如公司的数据中心或私有云）上，你完全掌控其中的所有镜像，不对外公开。</li>
<li>企业级： 这意味着它不仅仅是一个简单的存储服务器。它提供了企业所需的高级功能，如权限控制、安全扫描、镜像复制、图形化操作界面等。</li>
<li>镜像仓库： 它是专门用来存储、管理和分发 Docker 镜像的地方。你可以向 Harbor 中推送（上传）镜像，也可以从 Harbor 中拉取（下载）镜像。</li>
</ul>
<p>目前国内的上网环境公共的Docker Hub不能直接访问了，对于公司和个人开发者来说有必要搭建私有的Docker镜像仓库，使用 Harbor 几乎是必须的。公司自己开发的应用程序镜像可能包含敏感代码和配置，绝不能放到公共仓库。Harbor 提供了一个安全的私有环境来存放这些资产。Harbor 可以配置为 Docker Hub、Google Container Registry（GCR）等公有仓库的代理缓存。当公司内第一个开发者拉取某个公有镜像（如 nginx:latest）时，Harbor 会从公网下载并缓存到本地。后续所有开发者再拉取这个镜像时，都会直接从内网的 Harbor 服务器高速获取，极大地节省了公网带宽，加快了拉取速度。</p>
<p>Harbor 将一个简单的镜像存储服务，升级为一个安全、高效、可靠的企业级镜像生命周期管理平台，是现代云原生应用开发和运维不可或缺的基础设施组件。</p>
<p>本文介绍如何通过Harbor搭建和使用自己的私有镜像仓库。</p>
<h1 id="二、安装Harbor"><a href="#二、安装Harbor" class="headerlink" title="二、安装Harbor"></a>二、安装Harbor</h1><p>准备一台linux的服务器，我这里是ubuntu 24.04  IP地址是192.168.0.49<br>Harbor的docker安装要求<br>On a Linux host: docker 20.10.10-ce+ and docker-compose 1.18.0+ .</p>
<h2 id="1、安装docker"><a href="#1、安装docker" class="headerlink" title="1、安装docker"></a>1、安装docker</h2><p>执行以下命令一键安装docker </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo curl -fsSL https://get.docker.com | bash -s docker --mirror Aliyun</span><br><span class="line">service docker start</span><br></pre></td></tr></table></figure>

<p>配置国内镜像加速</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/docker/daemon.json</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="string">"registry-mirrors"</span>: [</span><br><span class="line">        <span class="string">"https://docker.1ms.run"</span></span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">service docker restart</span><br></pre></td></tr></table></figure>

<h2 id="2、安装Harbor"><a href="#2、安装Harbor" class="headerlink" title="2、安装Harbor"></a>2、安装Harbor</h2><p>下载harbor安装包，下载地址如下：<br><a href="https://github.com/goharbor/harbor/releases/download/v2.14.1/harbor-offline-installer-v2.14.1.tgz" target="_blank" rel="noopener">https://github.com/goharbor/harbor/releases/download/v2.14.1/harbor-offline-installer-v2.14.1.tgz</a><br>将下载的harbor安装包上传到安装harbor的目标服务器的目录下<br>如/home/app/harbor<br>解压上传的harbor安装包</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tar -zxvf harbor-offline-installer-v2.14.1.tgz</span><br></pre></td></tr></table></figure>

<p>备份配置文件</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cp harbor.yml.tmpl harbor.yml</span><br></pre></td></tr></table></figure>

<p>修改配置文件</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim harbor.yml</span><br></pre></td></tr></table></figure>
<p><img src="https://xiejava1018.github.io/xiejavaimagesrc/images/2025/20251204/1-%E4%BF%AE%E6%94%B9harbor%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6.png" alt="修改harbor.yml配置文件"></p>
<p> 执行安装脚本</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./install.sh</span><br></pre></td></tr></table></figure>

<p>安装完成后通过浏览器即可以访问harbor的管理界面<br><img src="https://xiejava1018.github.io/xiejavaimagesrc/images/2025/20251204/2-harbor%E7%99%BB%E5%BD%95%E7%95%8C%E9%9D%A2.png" alt="harbor登录界面"></p>
<p>默认的用户名和密码是<code>admin/Harbor12345</code></p>
<h1 id="三、使用Harbor"><a href="#三、使用Harbor" class="headerlink" title="三、使用Harbor"></a>三、使用Harbor</h1><h2 id="1、通过Harbor代理拉取镜像"><a href="#1、通过Harbor代理拉取镜像" class="headerlink" title="1、通过Harbor代理拉取镜像"></a>1、通过Harbor代理拉取镜像</h2><p>先在仓库管理中建一个目标，目标是从docker的加速镜像站点去拉取镜像，我这里配置目标URL是<code>https://docker.1ms.run</code>，点击测试链接，提示“测试连接成功”表示目标URL站点没有问题，就可以点击确定。<br><img src="https://xiejava1018.github.io/xiejavaimagesrc/images/2025/20251204/3-harbor%E6%96%B0%E5%BB%BA%E7%9B%AE%E6%A0%87.png" alt="新建目标"></p>
<p>这样我们就有了一个目标的加速仓库<br><img src="https://xiejava1018.github.io/xiejavaimagesrc/images/2025/20251204/4-%E6%88%90%E5%8A%9F%E5%88%9B%E5%BB%BA%E4%BB%93%E5%BA%93%E7%AE%A1%E7%90%86%E7%9B%AE%E6%A0%87.png" alt="新建目标成功"></p>
<p>在“项目”中点击“新建项目”，在镜像代理中<strong>开启</strong>“镜像代理”，选择我们开始在仓库管理中新建的目标仓库。<br><img src="https://xiejava1018.github.io/xiejavaimagesrc/images/2025/20251204/5-%E6%96%B0%E5%BB%BA%E9%A1%B9%E7%9B%AE%E5%BC%80%E5%90%AF%E9%95%9C%E5%83%8F%E4%BB%A3%E7%90%86.png" alt="开启镜像代理"></p>
<p>在配置管理生成软件物料清单中勾选“在推送镜像时自动生成软件物料清单”，这样我们在拉取镜像时harbor会自动帮我们缓存镜像到本地的harbor仓库，下次拉取时速度就非常快了。<br><img src="https://xiejava1018.github.io/xiejavaimagesrc/images/2025/20251204/6-%E5%BC%80%E5%90%AF%E6%8E%A8%E9%80%81%E7%94%9F%E6%88%90%E7%89%A9%E6%96%99%E6%B8%85%E5%8D%95.png" alt="勾选物料清单"></p>
<p>在另外一台需要拉取镜像的机器上配置docker的镜像仓库，将地址配置为Harbor的地址</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/docker/daemon.json</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="string">"registry-mirrors"</span>: [</span><br><span class="line">        <span class="string">"http://192.168.0.49"</span></span><br><span class="line">    ],</span><br><span class="line">    <span class="string">"insecure-registries"</span>: [<span class="string">"192.168.0.49"</span>]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>重启docker服务</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">service docker restart</span><br></pre></td></tr></table></figure>

<p>拉取目标镜像，这里要带上harbor中的项目名称，<code>docker1ms/nginx:1.22</code></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker pull docker1ms/nginx:1.22</span><br></pre></td></tr></table></figure>

<p><img src="https://xiejava1018.github.io/xiejavaimagesrc/images/2025/20251204/7-docker%E6%8B%89%E5%8F%96%E9%95%9C%E5%83%8F.png" alt="拉取镜像"></p>
<p>在harbor的管理界面可以看到，通过拉取镜像，harbor通过代理镜像源对镜像进行了拉取并缓存到harbor仓库，下次拉取速度更快了。<br><img src="https://xiejava1018.github.io/xiejavaimagesrc/images/2025/20251204/8-harbor%E6%8B%89%E5%8F%96%E9%95%9C%E5%83%8F%E6%88%90%E5%8A%9F.png" alt="harbor镜像缓存"></p>
<h2 id="2、上传镜像到Harbor仓库"><a href="#2、上传镜像到Harbor仓库" class="headerlink" title="2、上传镜像到Harbor仓库"></a>2、上传镜像到Harbor仓库</h2><p>另一个在工作中最常用的场景就是将自己的镜像上传到镜像仓库，以便其他人拉取使用。<br>下面就以在本地已经存在的docker1ms/busybox:latest为例，上传到自己的harbor仓库。<br>我的harbor仓库的地址是192.168.0.49,上传到默认的library项目中<br>为镜像打上带仓库地址和项目名的tag</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker tag docker1ms/busybox:latest 192.168.0.49/library/busybox:latest</span><br></pre></td></tr></table></figure>

<p><img src="https://xiejava1018.github.io/xiejavaimagesrc/images/2025/20251204/9-%E7%BB%99%E9%95%9C%E5%83%8F%E6%89%93%E6%A0%87%E7%AD%BE.png" alt="为镜像打标签"></p>
<p>客户端登录到harbor</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker login 192.168.0.49</span><br></pre></td></tr></table></figure>

<p>输入harbor的用户名和口令进行登录<br><img src="https://xiejava1018.github.io/xiejavaimagesrc/images/2025/20251204/10-%E7%99%BB%E5%BD%95%E5%88%B0harbor.png" alt="登录到harbor仓"></p>
<p>登录成功后，通过push命令上传镜像到本地harbor仓库</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker push 192.168.0.49/library/busybox:latest</span><br></pre></td></tr></table></figure>

<p><img src="https://xiejava1018.github.io/xiejavaimagesrc/images/2025/20251204/11-push%E9%95%9C%E5%83%8F.png" alt="push镜像"></p>
<p>到harbor管理界面查看push到仓库中的镜像<br><img src="https://xiejava1018.github.io/xiejavaimagesrc/images/2025/20251204/12-%E6%9F%A5%E7%9C%8Bpush%E7%9A%84%E9%A1%B9%E7%9B%AE.png" alt="push到仓库中的镜像"></p>
<p>可以看到busybox镜像已经成功push到harbor的library项目中了。<br><img src="https://xiejava1018.github.io/xiejavaimagesrc/images/2025/20251204/13-%E6%9F%A5%E7%9C%8Bpush%E7%9A%84%E9%A1%B9%E7%9B%AE%E7%9A%84%E9%95%9C%E5%83%8F%E4%BB%93%E5%BA%93.png" alt="成功push"></p>
<p>在Artifacts中可以看到push上来的镜像物料详情，可看到这个busybox镜像的大小是2.1MB<br><img src="https://xiejava1018.github.io/xiejavaimagesrc/images/2025/20251204/14-%E6%9F%A5%E7%9C%8Bpush%E9%95%9C%E5%83%8F%E7%9A%84%E7%89%A9%E6%96%99.png" alt="物料清单"></p>
<p>我们可以直接拉取harbor中我们刚push上去的镜像<br>可以看到如果是默认仓库library项目直接可以docker pull 镜像名就可以拉取</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker pull busybox:latest</span><br></pre></td></tr></table></figure>

<p><img src="https://xiejava1018.github.io/xiejavaimagesrc/images/2025/20251204/15-%E7%9B%B4%E6%8E%A5%E6%8B%89%E5%8F%96harbor%E5%BA%93%E4%B8%AD%E7%9A%84%E9%95%9C%E5%83%8F.png" alt="拉取镜像"></p>
<p>至此，我们通过安装自己私有的镜像仓库Harbor，实现了docker镜像代理下载和上传自己的镜像到Harbor仓库，覆盖了我们平时工作中的大部分场景。</p>
<hr>
<p>作者博客：<a href="http://xiejava.ishareread.com/">http://xiejava.ishareread.com/</a></p>
<center> 

<br>

<p><img src="https://xiejava1018.github.io/xiejavaimagesrc/images/fullbug%E5%BE%AE%E4%BF%A1%E5%85%AC%E4%BC%97%E5%8F%B7.jpg" alt="“fullbug”微信公众号" title="“fullbug”微信公众号"> </p>
<p>关注：微信公众号,一起学习成长！</center></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://xiejava.ishareread.com/posts/52b3e2de/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="XieJava">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="https://img9.doubanio.com/icon/ul70489051-4.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="XieJava's blog">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/posts/52b3e2de/" itemprop="url">开源安全管理平台wazuh-检测SQL注入攻击</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2025-10-22T16:33:12+08:00">
                2025-10-22
              </time>
            

            
              <span class="post-meta-divider">|</span>
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-check-o"></i>
              </span>
              
                <span class="post-meta-item-text">更新于&#58;</span>
              
              <time title="更新于" itemprop="dateModified" datetime="2025-10-22T16:41:21+08:00">
                2025-10-22
              </time>
            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%8A%80%E6%9C%AF/" itemprop="url" rel="index">
                    <span itemprop="name">技术</span>
                  </a>
                </span>

                
                
                  ， 
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%8A%80%E6%9C%AF/%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8/" itemprop="url" rel="index">
                    <span itemprop="name">网络安全</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/posts/52b3e2de/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count valine-comment-count" data-xid="/posts/52b3e2de/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          
             <span id="/posts/52b3e2de/" class="leancloud_visitors" data-flag-title="开源安全管理平台wazuh-检测SQL注入攻击">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数&#58;</span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  742
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">
                  3
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>Wazuh是一个功能强大的开源安全平台，它集成了安全信息与事件管理（SIEM）和扩展检测与响应（XDR）的能力，旨在为本地、虚拟化、容器化及云环境中的工作负载提供统一的威胁预防、检测和响应解决方案。</p>
<p>SQL 注入是一种攻击，在这种攻击中，威胁行为者将恶意代码插入传输到数据库服务器的字符串中进行解析和执行。成功的 SQL 注入攻击可以未经授权访问数据库中包含的机密信息。</p>
<p>我们可以使用 Wazuh 从 Web 服务器日志中检测 SQL 注入攻击，这些日志包含 select、union 和其他常见 SQL 注入模式等模式。本文通过POC来验证wazuh检测SQL注入攻击。</p>
<h1 id="一、环境准备"><a href="#一、环境准备" class="headerlink" title="一、环境准备"></a>一、环境准备</h1><p>POC测试环境拓扑如下图所示：</p>
<p><img src="https://xiejava1018.github.io/xiejavaimagesrc/images/2025/20251022/1-POC%E6%B5%8B%E8%AF%95%E7%8E%AF%E5%A2%83%E6%8B%93%E6%89%91.png" alt="POC测试环境拓扑"></p>
<table>
<thead>
<tr>
<th>主机</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>安全管理平台wazuh-server<br>(192.168.0.40)</td>
<td>All in one安装wazuh，监控wazuh-agent上报的告警信息进行威胁检测</td>
</tr>
<tr>
<td>DVWA靶机<br>（192.168.0.43）</td>
<td>被监控主机安装wazuh-agent，安装DVWA靶机，模拟被攻击</td>
</tr>
</tbody></table>
<p>DVWA靶机安装参考《<a href="https://blog.csdn.net/fullbug/article/details/129879670" target="_blank" rel="noopener">CentOS7+LAMP+DVWA靶机搭建</a>》<br>首先安装LAMP环境</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">apt update</span><br><span class="line">apt install -y apache2 mariadb-server mariadb-client php php-mysqli php-gd libapache2-mod-php</span><br></pre></td></tr></table></figure>

<p>下载DVWA的软件包<br>进入到默认的web发布目录</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /var/www/html</span><br><span class="line">git <span class="built_in">clone</span> https://github.com/digininja/DVWA.git</span><br></pre></td></tr></table></figure>

<p>将config/config.inc.php.dist复制成config/config.inc.php并配置环境</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cp config.inc.php.dist config.inc.php</span><br></pre></td></tr></table></figure>

<p>用root用户登录数据库，然后执行以下命令创建dvwa数据库:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; create database dvwa;</span><br><span class="line">Query OK, 1 row affected (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; create user dvwa@localhost identified by <span class="string">'p@ssw0rd'</span>;</span><br><span class="line">Query OK, 0 rows affected (0.01 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; grant all on dvwa.* to dvwa@localhost;</span><br><span class="line">Query OK, 0 rows affected (0.01 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; flush privileges;</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br></pre></td></tr></table></figure>

<p>默认用户 = <code>admin</code><br>默认密码 = <code>password</code><br>将安全级别设为 Low（最易注入）</p>
<h1 id="二、wazuh配置"><a href="#二、wazuh配置" class="headerlink" title="二、wazuh配置"></a>二、wazuh配置</h1><p>将以下行添加到 Wazuh 代理 <code>/var/ossec/etc/ossec.conf</code> 文件中。允许 Wazuh-agent 代理监控 Apache 服务器的访问日志：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;ossec_config&gt;</span><br><span class="line">  &lt;localfile&gt;</span><br><span class="line">    &lt;log_format&gt;apache&lt;/log_format&gt;</span><br><span class="line">    &lt;location&gt;/var/<span class="built_in">log</span>/apache2/access.log&lt;/location&gt;</span><br><span class="line">  &lt;/localfile&gt;</span><br><span class="line">&lt;/ossec_config&gt;</span><br></pre></td></tr></table></figure>

<p>重新启动 Wazuh 代理以使应用配置更改生效：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo systemctl restart wazuh-agent</span><br></pre></td></tr></table></figure>

<h1 id="三、模拟攻击"><a href="#三、模拟攻击" class="headerlink" title="三、模拟攻击"></a>三、模拟攻击</h1><p>访问DVWA的靶机地址<a href="http://192.168.0.43/DVWA/login.php" target="_blank" rel="noopener">http://192.168.0.43/DVWA/login.php</a><br>默认用户 = admin<br>默认密码 = password<br>登录后找到SQL Injection 输入例如”<code>1&#39; UNION SELECT database(), version()</code>“ 等SQL注入Payload</p>
<p><img src="https://xiejava1018.github.io/xiejavaimagesrc/images/2025/20251022/2-dvwaSQL%E6%B3%A8%E5%85%A5.png" alt="DVWA-SQL注入"></p>
<h1 id="四、效果验证"><a href="#四、效果验证" class="headerlink" title="四、效果验证"></a>四、效果验证</h1><p>在wazuh此处的预期结果是规则 ID 为 31164  <code>SQL injection attempt</code> 的告警，但成功的 SQL 注入尝试会生成规则 ID 为 31106  <code>A web attack returned code 200 (success)</code>的告警。</p>
<p><img src="https://xiejava1018.github.io/xiejavaimagesrc/images/2025/20251022/3-wazuhSQL%E6%B3%A8%E5%85%A5%E5%91%8A%E8%AD%A6.png" alt="sql注入检测"></p>
<p>我们可以点击详情看到具体的SQL注入攻击日志</p>
<p><img src="https://xiejava1018.github.io/xiejavaimagesrc/images/2025/20251022/4-wazuhSQL%E6%B3%A8%E5%85%A5%E5%91%8A%E8%AD%A6%E8%AF%A6%E6%83%85.png" alt="SQL注入检测日志详情"></p>
<p>至此，我们通过POC验证了wazuh检测SQL注入攻击场景。</p>
<hr>
<p>作者博客：<a href="http://xiejava.ishareread.com/" target="_blank" rel="noopener">http://xiejava.ishareread.com/</a></p>
<center> 

<br>

<p><img src="https://xiejava1018.github.io/xiejavaimagesrc/images/fullbug%E5%BE%AE%E4%BF%A1%E5%85%AC%E4%BC%97%E5%8F%B7.jpg" alt="“fullbug”微信公众号" title="“fullbug”微信公众号"> </p>
<p>关注：微信公众号,一起学习成长！</center></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://xiejava.ishareread.com/posts/e0557478/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="XieJava">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="https://img9.doubanio.com/icon/ul70489051-4.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="XieJava's blog">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/posts/e0557478/" itemprop="url">开源安全管理平台wazuh-非法可疑进程检测</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2025-10-15T19:50:52+08:00">
                2025-10-15
              </time>
            

            
              <span class="post-meta-divider">|</span>
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-check-o"></i>
              </span>
              
                <span class="post-meta-item-text">更新于&#58;</span>
              
              <time title="更新于" itemprop="dateModified" datetime="2025-10-15T20:08:07+08:00">
                2025-10-15
              </time>
            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%8A%80%E6%9C%AF/" itemprop="url" rel="index">
                    <span itemprop="name">技术</span>
                  </a>
                </span>

                
                
                  ， 
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%8A%80%E6%9C%AF/%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8/" itemprop="url" rel="index">
                    <span itemprop="name">网络安全</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/posts/e0557478/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count valine-comment-count" data-xid="/posts/e0557478/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          
             <span id="/posts/e0557478/" class="leancloud_visitors" data-flag-title="开源安全管理平台wazuh-非法可疑进程检测">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数&#58;</span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  1.1k
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">
                  4
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>Wazuh是一个功能强大的开源安全平台，它集成了安全信息与事件管理（SIEM）和扩展检测与响应（XDR）的能力，旨在为本地、虚拟化、容器化及云环境中的工作负载提供统一的威胁预防、检测和响应解决方案。</p>
<p>Wazuh命令监控功能在端点上运行命令并监控命令的输出。通过监控命令来检测是否有非法可疑进程。</p>
<p>本文通过POC展示Wazuh如何通过配置来实现对非法可疑进行的检测及时预警威胁攻击行为。</p>
<h1 id="一、环境准备"><a href="#一、环境准备" class="headerlink" title="一、环境准备"></a>一、环境准备</h1><p>POC测试环境拓扑如下图所示：<br><img src="https://xiejava1018.github.io/xiejavaimagesrc/images/2025/20251015/1-wazuh%E9%9D%9E%E6%B3%95%E5%8F%AF%E7%96%91%E8%BF%9B%E7%A8%8B%E6%A3%80%E6%B5%8B.png" alt="POC测试环境拓扑"></p>
<table>
<thead>
<tr>
<th>主机</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>安全管理平台wazuh-server<br>(192.168.0.40)</td>
<td>All in one安装wazuh，监控wazuh-agent上报的告警信息进行威胁检测</td>
</tr>
<tr>
<td>被监控Kali主机<br>（192.168.0.65）</td>
<td>被监控kali主机安装wazuh-agent，运行非法可疑进程。</td>
</tr>
</tbody></table>
<h1 id="二、wazuh配置"><a href="#二、wazuh配置" class="headerlink" title="二、wazuh配置"></a>二、wazuh配置</h1><h2 id="1、kali检测端点配置"><a href="#1、kali检测端点配置" class="headerlink" title="1、kali检测端点配置"></a>1、kali检测端点配置</h2><p>1）按照以下步骤配置命令监控并查询被监控kali主机端点上的所有运行进程。<br>将以下配置块添加到wazuh-agent的<code>/var/ossec/etc/ossec.conf</code>文件，允许wazuh-agent定期获取运行进程列表：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">ossec_config</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">localfile</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">log_format</span>&gt;</span>full_command<span class="tag">&lt;/<span class="name">log_format</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">alias</span>&gt;</span>process list<span class="tag">&lt;/<span class="name">alias</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">command</span>&gt;</span>ps -e -o pid,uname,command<span class="tag">&lt;/<span class="name">command</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">frequency</span>&gt;</span>30<span class="tag">&lt;/<span class="name">frequency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">localfile</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">ossec_config</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>这段配置告诉 Wazuh 代理：</p>
<ol>
<li>做什么：​ 每 30 秒执行一次命令 <code>ps -e -o pid,uname,command</code>。</li>
<li>捕获什么：​ 捕获该命令的完整输出。</li>
<li>如何标记：​ 在输出的每一行前面添加一个标准化的头部 <code>ossec: output: &#39;process list: &#39;</code>。</li>
<li>发送给谁：​ 将处理后的日志行（即带有前缀的进程列表）发送给配置的 Wazuh 服务器。</li>
</ol>
<p>这个配置让 Wazuh 代理定期（每 30 秒）抓取一次完整的系统进程快照，并格式化后发送给服务器，为基于进程行为的入侵检测提供基础数据。</p>
<p>2）重新启动Wazuh代理以使配置生效：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo systemctl restart wazuh-agent</span><br></pre></td></tr></table></figure>

<p>3）在kali上安装Netcat等工具：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt install ncat nmap -y</span><br></pre></td></tr></table></figure>


<h2 id="2、wazuh-server配置"><a href="#2、wazuh-server配置" class="headerlink" title="2、wazuh server配置"></a>2、wazuh server配置</h2><p>1）将以下规则添加到Wazuh服务器上的 /var/ossec/etc/rules/local_rules.xml 文件中：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">group</span> <span class="attr">name</span>=<span class="string">"ossec,"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">rule</span> <span class="attr">id</span>=<span class="string">"100050"</span> <span class="attr">level</span>=<span class="string">"0"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">if_sid</span>&gt;</span>530<span class="tag">&lt;/<span class="name">if_sid</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">match</span>&gt;</span>^ossec: output: 'process list'<span class="tag">&lt;/<span class="name">match</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">description</span>&gt;</span>List of running processes.<span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">group</span>&gt;</span>process_monitor,<span class="tag">&lt;/<span class="name">group</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">rule</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">rule</span> <span class="attr">id</span>=<span class="string">"100051"</span> <span class="attr">level</span>=<span class="string">"7"</span> <span class="attr">ignore</span>=<span class="string">"900"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">if_sid</span>&gt;</span>100050<span class="tag">&lt;/<span class="name">if_sid</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">match</span>&gt;</span>nc -l<span class="tag">&lt;/<span class="name">match</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">description</span>&gt;</span>netcat listening for incoming connections.<span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">group</span>&gt;</span>process_monitor,<span class="tag">&lt;/<span class="name">group</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">rule</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">group</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>这个配置片段定义了一个监控逻辑，专门用于在系统进程列表中检测监听模式的 netcat(<code>nc -l</code>)，一旦发现就产生高优先级告警。规则 100050 负责捕获进程列表数据，规则 100051 负责在其中搜索特定的威胁指标 (<code>nc -l</code>)。</p>
<p>2）重新启动Wazuh管理器以使配置生效：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo systemctl restart wazuh-manager</span><br></pre></td></tr></table></figure>

<h1 id="三、模拟攻击"><a href="#三、模拟攻击" class="headerlink" title="三、模拟攻击"></a>三、模拟攻击</h1><p>在被监控的Kali主机（192.168.0.65）端点上，运行<code>nc -l 8000</code> 30秒。</p>
<p>netcat​（网络工具中的“瑞士军刀”）的命令，它的核心作用是：​在你的计算机上启动一个临时的 TCP 服务端，监听端口 8000，等待其他计算机连接并与之通信。</p>
<p>监听模式的 netcat常被用作后门、端口监听器或进行未经授权的文件传输，是攻击者建立持久访问或进行横向移动的常见工具。</p>
<h1 id="四、效果验证"><a href="#四、效果验证" class="headerlink" title="四、效果验证"></a>四、效果验证</h1><p>我们可以在Wazuh威胁狩猎模块仪表板中可看到检测到kali主机上有netcat 进行正在监听的告警并可视化展示出来。<br><img src="https://xiejava1018.github.io/xiejavaimagesrc/images/2025/20251015/2-%E9%9D%9E%E6%B3%95%E5%8F%AF%E7%96%91%E8%BF%9B%E7%A8%8B%E6%A3%80%E6%B5%8B%E5%91%8A%E8%AD%A6.png" alt="非法可疑进程检测告警"></p>
<p>我们点开告警详情可以看到日志中显示通过<code>ps -e -o pid,uname,command</code>，检测到有<code>nc -l 8000</code>的非法进程在运行，进行了<code>netcat listening for incoming connections.</code>告警输出。<br><img src="https://xiejava1018.github.io/xiejavaimagesrc/images/2025/20251015/3-%E9%9D%9E%E6%B3%95%E5%8F%AF%E7%96%91%E8%BF%9B%E7%A8%8B%E6%A3%80%E6%B5%8B%E5%91%8A%E8%AD%A6%E8%AF%A6%E6%83%85.png" alt="非法可疑进程检测告警详情"></p>
<p>至此，我们通过一个完整的POC实例验证了wuzuh对非法可疑进程的检测，能够有效发现潜在的威胁。</p>
<hr>
<p>作者博客：<a href="http://xiejava.ishareread.com/" target="_blank" rel="noopener">http://xiejava.ishareread.com/</a></p>
<center> 

<br>

<p><img src="https://xiejava1018.github.io/xiejavaimagesrc/images/fullbug%E5%BE%AE%E4%BF%A1%E5%85%AC%E4%BC%97%E5%8F%B7.jpg" alt="“fullbug”微信公众号" title="“fullbug”微信公众号"> </p>
<p>关注：微信公众号,一起学习成长！</center></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://xiejava.ishareread.com/posts/b9af79aa/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="XieJava">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="https://img9.doubanio.com/icon/ul70489051-4.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="XieJava's blog">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/posts/b9af79aa/" itemprop="url">开源安全管理平台wazuh-与网络入侵检测系统集成增强威胁检测能力</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2025-10-12T16:19:42+08:00">
                2025-10-12
              </time>
            

            
              <span class="post-meta-divider">|</span>
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-check-o"></i>
              </span>
              
                <span class="post-meta-item-text">更新于&#58;</span>
              
              <time title="更新于" itemprop="dateModified" datetime="2025-10-12T16:33:56+08:00">
                2025-10-12
              </time>
            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%8A%80%E6%9C%AF/" itemprop="url" rel="index">
                    <span itemprop="name">技术</span>
                  </a>
                </span>

                
                
                  ， 
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%8A%80%E6%9C%AF/%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8/" itemprop="url" rel="index">
                    <span itemprop="name">网络安全</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/posts/b9af79aa/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count valine-comment-count" data-xid="/posts/b9af79aa/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          
             <span id="/posts/b9af79aa/" class="leancloud_visitors" data-flag-title="开源安全管理平台wazuh-与网络入侵检测系统集成增强威胁检测能力">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数&#58;</span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  1.1k
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">
                  4
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>Wazuh是一个功能强大的开源安全平台，它集成了安全信息与事件管理（SIEM）和扩展检测与响应（XDR）的能力，旨在为本地、虚拟化、容器化及云环境中的工作负载提供统一的威胁预防、检测和响应解决方案。</p>
<p>Wazuh可以与基于网络的入侵检测系统（NIDS）集成，通过监控和分析网络流量来增强威胁检测。Suricata 是一个开源的高性能网络安全监控工具，由开放信息安全基金会（OISF）开发维护。它被广泛用于实时网络流量分析、威胁检测和防护。Suricata 是现代网络安全架构中的重要组件，特别适合需要高性能实时流量分析的场景，是构建深度防御体系的关键工具。</p>
<p>本文通过POC展示如何将Suricata与Wazuh集成，并模拟对目标主机进行端口扫描，通过Suricata监控和分析网络流量进行威胁检测与Wazuh集成后在Wazuh的威胁狩猎中及时预警威胁攻击行为。</p>
<h1 id="一、环境准备"><a href="#一、环境准备" class="headerlink" title="一、环境准备"></a>一、环境准备</h1><p>POC环境拓扑如下图所示：<br><img src="https://xiejava1018.github.io/xiejavaimagesrc/images/2025/20251012/1-POC%E6%8B%93%E6%89%91%E5%9B%BE.png" alt="POC环境拓扑图"></p>
<table>
<thead>
<tr>
<th>主机</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>安全管理平台wazuh-server<br>(192.168.0.40)</td>
<td>All in one安装wazuh，监控wazuh-agent、suricata上报的告警信息进行威胁检测</td>
</tr>
<tr>
<td>ubuntu应用服务器<br>（192.168.0.30）</td>
<td>ubuntu应用服务器安装wazuh-agent并与Suricata集成 ,模拟被攻击的服务器</td>
</tr>
<tr>
<td>Kali Linux模拟攻击机器<br>（192.168.0.65）</td>
<td>Kali linux ,模拟攻击机器，模拟发起恶意端口扫描攻击</td>
</tr>
</tbody></table>
<h1 id="二、安装Suricata"><a href="#二、安装Suricata" class="headerlink" title="二、安装Suricata"></a>二、安装Suricata</h1><h2 id="1、安装Suricata"><a href="#1、安装Suricata" class="headerlink" title="1、安装Suricata"></a>1、安装Suricata</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo add-apt-repository ppa:oisf/suricata-stable</span><br><span class="line">sudo apt-get update</span><br><span class="line">sudo apt-get install suricata -y</span><br></pre></td></tr></table></figure>

<h2 id="2、下载Suricata的扩展检测规则集"><a href="#2、下载Suricata的扩展检测规则集" class="headerlink" title="2、下载Suricata的扩展检测规则集"></a>2、下载Suricata的扩展检测规则集</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /tmp/ &amp;&amp; curl -LO https://rules.emergingthreats.net/open/suricata-6.0.8/emerging.rules.tar.gz</span><br><span class="line">sudo tar -xvzf emerging.rules.tar.gz &amp;&amp; sudo mkdir /etc/suricata/rules &amp;&amp; sudo mv rules/*.rules /etc/suricata/rules/</span><br><span class="line">sudo chmod 777 /etc/suricata/rules/*.rules</span><br></pre></td></tr></table></figure>

<h2 id="3、配置Surcata"><a href="#3、配置Surcata" class="headerlink" title="3、配置Surcata"></a>3、配置Surcata</h2><p>在 <code>/etc/suricata/suricata.yaml</code> 文件中修改 Suricata 设置并设置以下变量</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">HOME_NET: <span class="string">"&lt;UBUNTU_IP&gt;"</span></span><br><span class="line">EXTERNAL_NET: <span class="string">"any"</span></span><br><span class="line"></span><br><span class="line">default-rule-path: /etc/suricata/rules</span><br><span class="line">rule-files:</span><br><span class="line">- <span class="string">"*.rules"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Global stats configuration</span></span><br><span class="line">stats:</span><br><span class="line">enabled: yes</span><br><span class="line"></span><br><span class="line"><span class="comment"># Linux high speed capture support</span></span><br><span class="line">af-packet:</span><br><span class="line">  - interface: ens2</span><br></pre></td></tr></table></figure>

<p>接口表示您想要监控的网络接口。将值替换为 Ubuntu 端点的接口名称。</p>
<p><img src="https://xiejava1018.github.io/xiejavaimagesrc/images/2025/20251012/2-%E8%AE%BE%E7%BD%AE%E4%B8%BA%E6%B5%81%E9%87%8F%E6%A3%80%E6%B5%8B%E7%9A%84%E7%BD%91%E5%8D%A1.png" alt="设置为流量检测的网卡"></p>
<p>可以通过ifconfig查看Ubuntu的网络接口，例如，我这里是ens2。<br><img src="https://xiejava1018.github.io/xiejavaimagesrc/images/2025/20251012/3-ifconfig%E6%9F%A5%E7%9C%8B%E7%BD%91%E5%8D%A1.png" alt="查看网络接口"></p>
<h2 id="4、重启Suricata服务"><a href="#4、重启Suricata服务" class="headerlink" title="4、重启Suricata服务"></a>4、重启Suricata服务</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo systemctl restart suricata</span><br></pre></td></tr></table></figure>

<h1 id="三、wazuh与Suricata集成"><a href="#三、wazuh与Suricata集成" class="headerlink" title="三、wazuh与Suricata集成"></a>三、wazuh与Suricata集成</h1><p>将以下配置添加到Wazuh代理的<code>/var/ossec/etc/ossec.conf</code>文件中。这允许Wazuh代理读取Suricata日志文件：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;ossec_config&gt;</span><br><span class="line">  &lt;localfile&gt;</span><br><span class="line">    &lt;log_format&gt;json&lt;/log_format&gt;</span><br><span class="line">    &lt;location&gt;/var/<span class="built_in">log</span>/suricata/eve.json&lt;/location&gt;</span><br><span class="line">  &lt;/localfile&gt;</span><br><span class="line">&lt;/ossec_config&gt;</span><br></pre></td></tr></table></figure>

<p><img src="https://xiejava1018.github.io/xiejavaimagesrc/images/2025/20251012/4-%E9%85%8D%E7%BD%AEwazuh%E6%8E%A5%E6%94%B6suricata%E6%95%B0%E6%8D%AE.png" alt="配置wazuh接受suricata数据"></p>
<p>重新启动Wazuh代理以使配置生效</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo systemctl restart wazuh-agent</span><br></pre></td></tr></table></figure>

<h1 id="四、模拟攻击"><a href="#四、模拟攻击" class="headerlink" title="四、模拟攻击"></a>四、模拟攻击</h1><blockquote>
<p>请注意：本文介绍的模拟攻击仅限于自己搭建测试环境进行POC验证。请不要使用这些工具和方法对其它目标主机进行测试，使用这些工具前，务必获得目标系统的明确书面授权，未经授权的测试属违法行为。</p>
</blockquote>
<p>端口扫描是渗透测试的第一步，通过端口扫描可以快速发现目标主机的攻击面。使用 nmap进行端口扫描是网络安全中最基础且关键的操作之一。我们在Kali Linux主机上通过nmap对目标靶机192.168.0.30进行端口扫描看开放有哪些端口。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nmap -p- -sV -O -A -T4 -Pn -oX full_scan.xml 192.168.0.30</span><br></pre></td></tr></table></figure>

<h1 id="五、效果验证"><a href="#五、效果验证" class="headerlink" title="五、效果验证"></a>五、效果验证</h1><p>在Kali Linux主机上通过nmap对目标靶机192.168.0.30进行端口扫描的过程中，我们在192.168.0.40的wazuh server的威胁狩猎界面可以看到suricata通过流量检测识别到端口扫描的攻击行为，并通过wazuh的可视化界面进行告警的展示。</p>
<p><img src="https://xiejava1018.github.io/xiejavaimagesrc/images/2025/20251012/5-suricata%E5%91%8A%E8%AD%A6.png" alt="surcata告警"></p>
<p>点击可以查看告警的详情，可以看到是通过suricata发现的来自源IP192.168.0.65的nmap扫描行为。</p>
<p><img src="https://xiejava1018.github.io/xiejavaimagesrc/images/2025/20251012/6-suricata%E5%91%8A%E8%AD%A6%E8%AF%A6%E6%83%85.png" alt="suricata告警详情"></p>
<p>至此，我们通过wasuh与网络入侵检测系统（suricata）进行集成，并模拟对目标主机进行端口扫描，验证了通过Suricata监控和分析网络流量进行威胁检测与Wazuh集成后在Wazuh的威胁狩猎中及时预警威胁攻击行为。</p>
<hr>
<p>作者博客：<a href="http://xiejava.ishareread.com/" target="_blank" rel="noopener">http://xiejava.ishareread.com/</a></p>
<center> 

<br>

<p><img src="https://xiejava1018.github.io/xiejavaimagesrc/images/fullbug%E5%BE%AE%E4%BF%A1%E5%85%AC%E4%BC%97%E5%8F%B7.jpg" alt="“fullbug”微信公众号" title="“fullbug”微信公众号"> </p>
<p>关注：微信公众号,一起学习成长！</center></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://xiejava.ishareread.com/posts/c76cd9e6/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="XieJava">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="https://img9.doubanio.com/icon/ul70489051-4.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="XieJava's blog">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/posts/c76cd9e6/" itemprop="url">开源安全管理平台wazuh-暴力破解检测与响应</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2025-10-11T14:25:00+08:00">
                2025-10-11
              </time>
            

            
              <span class="post-meta-divider">|</span>
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-check-o"></i>
              </span>
              
                <span class="post-meta-item-text">更新于&#58;</span>
              
              <time title="更新于" itemprop="dateModified" datetime="2025-10-12T16:23:44+08:00">
                2025-10-12
              </time>
            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%8A%80%E6%9C%AF/" itemprop="url" rel="index">
                    <span itemprop="name">技术</span>
                  </a>
                </span>

                
                
                  ， 
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%8A%80%E6%9C%AF/%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8/" itemprop="url" rel="index">
                    <span itemprop="name">网络安全</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/posts/c76cd9e6/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count valine-comment-count" data-xid="/posts/c76cd9e6/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          
             <span id="/posts/c76cd9e6/" class="leancloud_visitors" data-flag-title="开源安全管理平台wazuh-暴力破解检测与响应">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数&#58;</span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  1.5k
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">
                  5
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>Wazuh是一个功能强大的开源安全平台，它集成了安全信息与事件管理（SIEM）和扩展检测与响应（XDR）的能力，旨在为本地、虚拟化、容器化及云环境中的工作负载提供统一的威胁预防、检测和响应解决方案。</p>
<p>暴力破解是网络安全领域一种常见且顽固的威胁，像Linux端点的SSH这样的服务通常容易受到暴力破解攻击，攻击者利用它来非法访问端点和服务。有效应对暴力破解需要“侦测”和“防护”双管齐下。Wazuh通过关联多个认证失败事件来识别暴力破解攻击并可以配置主动响应以阻止攻击者的IP地址。</p>
<p>本文通过POC来验证wazuh对暴力破解检测与响应能力</p>
<h1 id="一、环境准备"><a href="#一、环境准备" class="headerlink" title="一、环境准备"></a>一、环境准备</h1><p>POC环境如下图所示：</p>
<p><img src="https://xiejava1018.github.io/xiejavaimagesrc/images/2025/20251011/1-POC%E6%8B%93%E6%89%91%E5%9B%BE.png" alt="POC拓扑图"></p>
<table>
<thead>
<tr>
<th>主机</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>安全管理平台wazuh-server<br>(192.168.0.40)</td>
<td>All in one安装wazuh，监控wazuh-agent上报的告警信息进行暴力破解检测并联动wazuh-agent进行封堵响应</td>
</tr>
<tr>
<td>ubuntu应用服务器<br>（192.168.0.30）</td>
<td>ubuntu应用服务器ssh服务，安装wazuh-agent ,模拟被攻击的服务器</td>
</tr>
<tr>
<td>Kali Linux模拟攻击机器<br>（192.168.0.65）</td>
<td>Kali linux ,模拟攻击机器</td>
</tr>
</tbody></table>
<h1 id="二、wazuh-配置"><a href="#二、wazuh-配置" class="headerlink" title="二、wazuh 配置"></a>二、wazuh 配置</h1><p>Wazuh使用主动响应模块在受监控端点上运行脚本或可执行文件，对某些触发器采取行动。在本用例中，我们模拟对ubuntu应用服务器端点的SSH暴力破解攻击，并配置主动响应模块以阻止攻击端点的IP地址。目标是防止SSH暴力破解攻击。</p>
<p>Wazuh附带一套用于主动响应的默认脚本。这些脚本位于Linux/Unix端点的<code>/var/ossec/active-response/bin/</code>目录中。firewall-drop主动响应脚本与Linux/Unix操作系统兼容。它使用iptables来阻止恶意IP地址。</p>
<h2 id="Wazuh-server配置"><a href="#Wazuh-server配置" class="headerlink" title="Wazuh server配置"></a>Wazuh server配置</h2><p>1、打开Wazuh服务器<code>/var/ossec/etc/ossec.conf</code>文件，并验证在<code>&lt;ossec_config&gt;</code>块中存在名为firewall-drop的<code>&lt;command&gt;</code>块，其配置如下：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">command</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">name</span>&gt;</span>firewall-drop<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">executable</span>&gt;</span>firewall-drop<span class="tag">&lt;/<span class="name">executable</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">timeout_allowed</span>&gt;</span>yes<span class="tag">&lt;/<span class="name">timeout_allowed</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">command</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><code>&lt;command&gt;</code>块包含有关在Wazuh代理上执行的操作的信息：</p>
<ul>
<li><code>&lt;name&gt;</code>：为命令设置名称。在本例中，为firewall-drop。</li>
<li><code>&lt;executable&gt;</code>：指定在触发时必须运行的响应脚本或可执行文件。在本例中，是firewall-drop可执行文件。</li>
<li><code>&lt;timeout_allowed&gt;</code>：允许在一段时间后超时。在此处，此标签设置为yes，表示状态性主动响应。</li>
</ul>
<p>2、将以下 <code>&lt;active-response&gt;</code> 块添加到 Wazuh 服务器 <code>/var/ossec/etc/ossec.conf</code> 配置文件中：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">ossec_config</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">active-response</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">disabled</span>&gt;</span>no<span class="tag">&lt;/<span class="name">disabled</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">command</span>&gt;</span>firewall-drop<span class="tag">&lt;/<span class="name">command</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">location</span>&gt;</span>local<span class="tag">&lt;/<span class="name">location</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">rules_id</span>&gt;</span>5763<span class="tag">&lt;/<span class="name">rules_id</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">timeout</span>&gt;</span>180<span class="tag">&lt;/<span class="name">timeout</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">active-response</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">ossec_config</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li><code>&lt;comand&gt;</code>：指定要配置的命令。这是在上一步骤中定义的防火墙丢弃命令 firewall-drop。</li>
<li><code>&lt;location&gt;</code>：指定命令执行的位置。使用本地值表示命令在触发事件发生的监控端点处执行。</li>
<li><code>&lt;rules_id&gt;</code>：如果规则ID 5763 - SSHD暴力破解尝试访问系统触发，则活动响应模块将执行该命令。</li>
<li><code>&lt;timeout&gt;</code>：指定活动响应操作必须持续的时间。在本用例中，模块将阻止执行暴力破解攻击的端点IP地址180秒。</li>
</ul>
<p>3、重新启动Wazuh管理器服务以应用更改：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo systemctl restart wazuh-manager</span><br></pre></td></tr></table></figure>

<h1 id="三、模拟攻击"><a href="#三、模拟攻击" class="headerlink" title="三、模拟攻击"></a>三、模拟攻击</h1><p>我们通过Kali Linux自带的Hydra进行模拟攻击。</p>
<blockquote>
<p>请注意：本文介绍的模拟攻击仅限于自己搭建测试环境进行POC验证。请不要使用这些工具和方法对其它目标主机进行测试，使用这些工具前，务必获得目标系统的明确书面授权，未经授权的测试属违法行为。</p>
</blockquote>
<p>Hydra 配合 SecLists 工具包，可以显著提升密码破解测试的效率和成功率。<br>SecLists 是一款在安全测试中非常受欢迎的开源集合项目，提供了各种类型的字典列表，包括但不限于用户名、密码、目录路径、子域名等。Hydra 则是一款强大的网络登录破解工具，支持多种协议。将两者结合，可以针对各种网络服务进行高效的密码暴力破解测试。<br>在 Kali Linux 中，SecLists 通常位于 <code>/usr/share/seclists</code>目录。如果系统未安装，可以使用以下命令安装：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt update &amp;&amp; sudo apt install seclists</span><br></pre></td></tr></table></figure>

<p>在Kali Linux（192.168.0.65）上执行hydra 对 192.168.0.30 进行模拟攻击</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hydra -L /usr/share/seclists/Usernames/top-usernames-shortlist.txt -P /usr/share/seclists/Passwords/Common-Credentials/top-20-common-SSH-passwords.txt 192.168.0.30 ssh -t 4 -vV</span><br></pre></td></tr></table></figure>

<h1 id="四、效果验证"><a href="#四、效果验证" class="headerlink" title="四、效果验证"></a>四、效果验证</h1><p>可以看到触发了wazuh的告警规则，在Wazuh仪表板中看到多次的登录失败的告警数据，并生成了试图暴力破解的攻击告警。<br><img src="https://xiejava1018.github.io/xiejavaimagesrc/images/2025/20251011/2-%E6%9A%B4%E5%8A%9B%E7%A0%B4%E8%A7%A3%E6%A3%80%E6%B5%8B%E4%B8%8E%E5%93%8D%E5%BA%94%E5%91%8A%E8%AD%A6.png" alt="告警"></p>
<p>在详情中可以清楚的看到多次尝试暴力破解ssh登录<br><img src="https://xiejava1018.github.io/xiejavaimagesrc/images/2025/20251011/3-%E6%9A%B4%E5%8A%9B%E7%A0%B4%E8%A7%A3%E5%91%8A%E8%AD%A6%E8%AF%A6%E6%83%85.png" alt="告警详情"></p>
<p>可以看到wazuh检测到有ssh暴力破解的行为并自动调用防火墙对攻击IP进行封堵，封堵180秒。<br><img src="https://xiejava1018.github.io/xiejavaimagesrc/images/2025/20251011/4-%E6%9A%B4%E5%8A%9B%E7%A0%B4%E8%A7%A3%E5%91%8A%E8%AD%A6%E5%B0%81%E5%A0%B5.png" alt="封堵"></p>
<p>在Hydra的攻击日志可以看到，被wazuh进行响应封堵后ssh超时报错，说明已经成功阻断阻止了攻击行为。<br><img src="https://xiejava1018.github.io/xiejavaimagesrc/images/2025/20251011/5-%E6%9A%B4%E5%8A%9B%E7%A0%B4%E8%A7%A3%E5%B0%81%E5%A0%B5%E6%95%88%E6%9E%9C.png" alt="阻止效果"></p>
<p>至此，我们通过一个实际的POC实例验证了wazuh对ssh暴力破解攻击行为的检测和响应，通过“侦测”和“防护”双管齐下能有效减轻ssh暴力破解威胁攻击风险。</p>
<hr>
<p>作者博客：<a href="http://xiejava.ishareread.com/" target="_blank" rel="noopener">http://xiejava.ishareread.com/</a></p>
<center> 

<br>

<p><img src="https://xiejava1018.github.io/xiejavaimagesrc/images/fullbug%E5%BE%AE%E4%BF%A1%E5%85%AC%E4%BC%97%E5%8F%B7.jpg" alt="“fullbug”微信公众号" title="“fullbug”微信公众号"> </p>
<p>关注：微信公众号,一起学习成长！</center></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://xiejava.ishareread.com/posts/8d366bb0/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="XieJava">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="https://img9.doubanio.com/icon/ul70489051-4.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="XieJava's blog">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/posts/8d366bb0/" itemprop="url">开源安全管理平台wazuh-文件完整性监控FIM</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2025-10-08T20:26:53+08:00">
                2025-10-08
              </time>
            

            
              <span class="post-meta-divider">|</span>
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-check-o"></i>
              </span>
              
                <span class="post-meta-item-text">更新于&#58;</span>
              
              <time title="更新于" itemprop="dateModified" datetime="2025-10-08T20:46:31+08:00">
                2025-10-08
              </time>
            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%8A%80%E6%9C%AF/" itemprop="url" rel="index">
                    <span itemprop="name">技术</span>
                  </a>
                </span>

                
                
                  ， 
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%8A%80%E6%9C%AF/%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8/" itemprop="url" rel="index">
                    <span itemprop="name">网络安全</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/posts/8d366bb0/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count valine-comment-count" data-xid="/posts/8d366bb0/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          
             <span id="/posts/8d366bb0/" class="leancloud_visitors" data-flag-title="开源安全管理平台wazuh-文件完整性监控FIM">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数&#58;</span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  1.1k
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">
                  4
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>Wazuh是一个功能强大的开源安全平台，它集成了安全信息与事件管理（SIEM）和扩展检测与响应（XDR）的能力，旨在为本地、虚拟化、容器化及云环境中的工作负载提供统一的威胁预防、检测和响应解决方案。<br>文件完整性监控（File integrity monitoring FIM）有助于审计敏感文件和满足合规性要求。Wazuh内置了一个FIM模块，用于监控文件系统变化，以检测文件的创建、修改和删除。<br>本文通过POC来验证Wazuh的FIM功能，使用Wazuh FIM模块来检测Ubuntu和Windows端点上监控目录的变化。Wazuh FIM模块通过使用who-data审计获取有关更改用户和进程的信息来丰富告警数据。</p>
<h1 id="一、环境准备"><a href="#一、环境准备" class="headerlink" title="一、环境准备"></a>一、环境准备</h1><p>POC环境如下图所示：<br><img src="https://xiejava1018.github.io/xiejavaimagesrc/images/2025/20251008/1-FIMPOC%E6%8B%93%E6%89%91%E5%9B%BE.png" alt="POC环境拓扑图"></p>
<table>
<thead>
<tr>
<th>主机</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>安全管理平台wazuh-server<br>(192.168.0.40)</td>
<td>All in one安装wazuh，监控wazuh-agent上报的告警信息进行文件完整性监控(FIM)</td>
</tr>
<tr>
<td>被监控Windows 11机器<br>(192.168.0.16)</td>
<td>安装wazuh-agent，通过Wazuh FIM模块在此端点监控一个目录，以检测文件创建、更改和删除。</td>
</tr>
<tr>
<td>被监控Ubuntu主机<br>(192.168.0.41)</td>
<td>安装wazuh-agent，通过Wazuh FIM模块在此端点监控一个目录，以检测文件创建、更改和删除。</td>
</tr>
</tbody></table>
<h1 id="二、wazuh配置"><a href="#二、wazuh配置" class="headerlink" title="二、wazuh配置"></a>二、wazuh配置</h1><h2 id="1、window机器安装wazuh并配置"><a href="#1、window机器安装wazuh并配置" class="headerlink" title="1、window机器安装wazuh并配置"></a>1、window机器安装wazuh并配置</h2><h3 id="1）安装wazuh-agent"><a href="#1）安装wazuh-agent" class="headerlink" title="1）安装wazuh-agent"></a>1）安装wazuh-agent</h3><p>在wazuh的管理端找到部署agent界面，选择window的agent安装包</p>
<p><img src="https://xiejava1018.github.io/xiejavaimagesrc/images/2025/20251008/2-wazuh%E9%83%A8%E7%BD%B2agent%E7%95%8C%E9%9D%A2.png" alt="wazuh部署agent界面"></p>
<p>wazuh会自动生成部署agent的脚本</p>
<p><img src="https://xiejava1018.github.io/xiejavaimagesrc/images/2025/20251008/3-%E8%87%AA%E5%8A%A8%E7%94%9F%E6%88%90%E9%83%A8%E7%BD%B2agent%E7%9A%84%E8%84%9A%E6%9C%AC.png" alt="自动生成部署agent的脚本"></p>
<p>在window11（192.168.0.16）机器上以管理员权限运行powershell,在powershell中运行agent安装脚本</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Invoke-WebRequest -Uri https://packages.wazuh.com/4.x/windows/wazuh-agent-4.13.0-1.msi -OutFile <span class="variable">$env</span>:tmp\wazuh-agent; msiexec.exe /i <span class="variable">$env</span>:tmp\wazuh-agent /q WAZUH_MANAGER=<span class="string">'192.168.0.40'</span> WAZUH_AGENT_NAME=<span class="string">'Lenovo-L13-agent'</span></span><br></pre></td></tr></table></figure>

<p><img src="https://xiejava1018.github.io/xiejavaimagesrc/images/2025/20251008/4-%E8%BF%90%E8%A1%8Cagent%E5%AE%89%E8%A3%85%E8%84%9A%E6%9C%AC.png" alt="运行agent安装脚本"></p>
<p>运行<code>NET START Wazuh</code>启动wazuh-agent，过一会就可以在wazuh服务端的dashboard中看到window 11的wazuh-agent注册上来了。</p>
<p><img src="https://xiejava1018.github.io/xiejavaimagesrc/images/2025/20251008/5-%E6%B3%A8%E5%86%8Cagent.png" alt="注册agent"></p>
<h3 id="2）-配置window端点的wazuh-agent"><a href="#2）-配置window端点的wazuh-agent" class="headerlink" title="2） 配置window端点的wazuh-agent"></a>2） 配置window端点的wazuh-agent</h3><p>按照以下步骤配置Wazuh代理以监控以下目录的文件系统更改。如监控<code>C:\Users\xiejava\Desktop</code>的文件更改。<br>在受监控的Windows端点上编辑<code>C:\Program Files (x86)\ossec-agent\ossec.conf</code>配置文件。在<code>&lt;syscheck&gt;</code>块内添加监控目录。配置Wazuh监控<code>C:\Users\xiejava\Desktop</code>目录。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">directories</span> <span class="attr">check_all</span>=<span class="string">"yes"</span> <span class="attr">report_changes</span>=<span class="string">"yes"</span> <span class="attr">realtime</span>=<span class="string">"yes"</span>&gt;</span>C:\Users\xiejava\Desktop<span class="tag">&lt;/<span class="name">directories</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><img src="https://xiejava1018.github.io/xiejavaimagesrc/images/2025/20251008/6-%E9%85%8D%E7%BD%AEwindow%E7%AB%AF%E7%82%B9%E7%9A%84FIM%E7%9B%91%E6%8E%A7.png" alt="配置FIM监控"></p>
<p>使用具有管理员权限的PowerShell重新启动Wazuh代理以使配置更改生效。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Restart-Service -Name wazuh</span><br></pre></td></tr></table></figure>

<h2 id="2、ubuntu主机的wazuh-agent配置"><a href="#2、ubuntu主机的wazuh-agent配置" class="headerlink" title="2、ubuntu主机的wazuh-agent配置"></a>2、ubuntu主机的wazuh-agent配置</h2><p>由于ubuntu主机（192.168.0.41）已经安装了wazuh-agent，只需要对wazuh-agent进行配置就可以了。<br>执行以下步骤以配置Wazuh代理以监控<code>/root</code>目录中的文件系统更改。<br>编辑Wazuh代理的<code>/var/ossec/etc/ossec.conf</code>配置文件。在<code>&lt;syscheck&gt;</code>块中添加监控的目录。配置Wazuh监控<code>/root</code>目录。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">directories</span> <span class="attr">check_all</span>=<span class="string">"yes"</span> <span class="attr">report_changes</span>=<span class="string">"yes"</span> <span class="attr">realtime</span>=<span class="string">"yes"</span>&gt;</span>/root<span class="tag">&lt;/<span class="name">directories</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><img src="https://xiejava1018.github.io/xiejavaimagesrc/images/2025/20251008/7-%E9%85%8D%E7%BD%AEubuntu%E7%AB%AF%E7%82%B9%E7%9A%84FIM%E7%9B%91%E6%8E%A7.png" alt="配置ubuntu端点的FIM监控"></p>
<p>重新启动Wazuh代理以使配置生效</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo systemctl restart wazuh-agent</span><br></pre></td></tr></table></figure>

<h1 id="三、效果验证"><a href="#三、效果验证" class="headerlink" title="三、效果验证"></a>三、效果验证</h1><h2 id="1、windows端点文件完整性监控"><a href="#1、windows端点文件完整性监控" class="headerlink" title="1、windows端点文件完整性监控"></a>1、windows端点文件完整性监控</h2><h3 id="1）文件增、删、改"><a href="#1）文件增、删、改" class="headerlink" title="1）文件增、删、改"></a>1）文件增、删、改</h3><p>在window 11(192.168.0.16)的机器的桌面上新建一个.txt文件，然后重命名为test-win11.txt，再修改test-win11.txt的内容。</p>
<h3 id="2）可视化告警监控"><a href="#2）可视化告警监控" class="headerlink" title="2）可视化告警监控"></a>2）可视化告警监控</h3><p>在wazuh的dashboard中可以看到window 11机器的完整性监控告警。<br><img src="https://xiejava1018.github.io/xiejavaimagesrc/images/2025/20251008/8-win11%E7%9A%84FIM%E5%91%8A%E8%AD%A6.png" alt="win11的FIM告警"></p>
<p>在详情中可以看到window11机器c:\users\xiejava\desktop\下文件变更的详情。<br><img src="https://xiejava1018.github.io/xiejavaimagesrc/images/2025/20251008/9-win11%E7%9A%84FIM%E5%91%8A%E8%AD%A6%E8%AF%A6%E6%83%85.png" alt="win11的FIM告警详情"></p>
<h2 id="2、ubuntu主机文件完整性监控"><a href="#2、ubuntu主机文件完整性监控" class="headerlink" title="2、ubuntu主机文件完整性监控"></a>2、ubuntu主机文件完整性监控</h2><h3 id="1）文件增、删、改-1"><a href="#1）文件增、删、改-1" class="headerlink" title="1）文件增、删、改"></a>1）文件增、删、改</h3><p>  在ubuntu(192.168.0.41)的机器的/root新建一个test.txt文件，然后重命名为test-ubuntu.txt，再修改test-ubuntu.txt的内容。</p>
<h3 id="2）可视化告警监控-1"><a href="#2）可视化告警监控-1" class="headerlink" title="2）可视化告警监控"></a>2）可视化告警监控</h3><p>在wazuh的dashboard中可以看到ubuntu(192.168.0.41)主机的文件完整性监控告警。<br><img src="https://xiejava1018.github.io/xiejavaimagesrc/images/2025/20251008/10-ubuntu%E7%AB%AF%E7%82%B9%E7%9A%84FIM%E5%91%8A%E8%AD%A6%E4%BA%8B%E4%BB%B6.png" alt="ubuntu端点的FIM告警事件"></p>
<p>在Dashboard中可以看到FIM的统计信息包括对文件的新增、删除、修改等。<br><img src="https://xiejava1018.github.io/xiejavaimagesrc/images/2025/20251008/11-ubuntu%E7%AB%AF%E7%82%B9%E7%9A%84FIMDashboard.png" alt="ubuntu端点的FIMDashboard"></p>
<p>在Events中可以看到文件被修改触发的事件<br><img src="https://xiejava1018.github.io/xiejavaimagesrc/images/2025/20251008/12-ubuntu%E7%AB%AF%E7%82%B9%E7%9A%84FIM%E5%91%8A%E8%AD%A6%E5%88%97%E8%A1%A8.png" alt="ubuntu端点的FIM告警列表"></p>
<p>可以查看具体的事件详情<br><img src="https://xiejava1018.github.io/xiejavaimagesrc/images/2025/20251008/13-ubuntu%E7%AB%AF%E7%82%B9%E7%9A%84FIM%E5%91%8A%E8%AD%A6%E8%AF%A6%E6%83%85.png" alt="ubuntu端点的FIM告警详情"></p>
<p>至此，我们通过POC实例来验证了Wazuh的文件完整性监控FIM功能，使用Wazuh FIM模块来检测Ubuntu和Windows端点上监控目录的变化。</p>
<hr>
<p>作者博客：<a href="http://xiejava.ishareread.com/" target="_blank" rel="noopener">http://xiejava.ishareread.com/</a></p>
<center> 

<br>

<p><img src="https://xiejava1018.github.io/xiejavaimagesrc/images/fullbug%E5%BE%AE%E4%BF%A1%E5%85%AC%E4%BC%97%E5%8F%B7.jpg" alt="“fullbug”微信公众号" title="“fullbug”微信公众号"> </p>
<p>关注：微信公众号,一起学习成长！</center></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://xiejava.ishareread.com/posts/8d7a03ba/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="XieJava">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="https://img9.doubanio.com/icon/ul70489051-4.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="XieJava's blog">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/posts/8d7a03ba/" itemprop="url">开源安全管理平台wazuh-阻止恶意IP访问</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2025-10-07T19:46:43+08:00">
                2025-10-07
              </time>
            

            
              <span class="post-meta-divider">|</span>
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-check-o"></i>
              </span>
              
                <span class="post-meta-item-text">更新于&#58;</span>
              
              <time title="更新于" itemprop="dateModified" datetime="2025-10-07T20:28:17+08:00">
                2025-10-07
              </time>
            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%8A%80%E6%9C%AF/" itemprop="url" rel="index">
                    <span itemprop="name">技术</span>
                  </a>
                </span>

                
                
                  ， 
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%8A%80%E6%9C%AF/%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8/" itemprop="url" rel="index">
                    <span itemprop="name">网络安全</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/posts/8d7a03ba/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count valine-comment-count" data-xid="/posts/8d7a03ba/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          
             <span id="/posts/8d7a03ba/" class="leancloud_visitors" data-flag-title="开源安全管理平台wazuh-阻止恶意IP访问">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数&#58;</span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  1.5k
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">
                  6
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>Wazuh是一个功能强大的开源安全平台，它集成了安全信息与事件管理（SIEM）和扩展检测与响应（XDR）的能力，旨在为本地、虚拟化、容器化及云环境中的工作负载提供统一的威胁预防、检测和响应解决方案。<br>《<a href="https://blog.csdn.net/fullbug/article/details/152279929" target="_blank" rel="noopener">开源安全管理平台wazuh-安装与配置</a>》介绍了wazuh的安装和配置，本文基于已经完成的wazuh安装配置基础上通过POC来验证wazuh的功能，通过wazuh来阻止已知的恶意IP的访问。</p>
<h2 id="一、环境准备"><a href="#一、环境准备" class="headerlink" title="一、环境准备"></a>一、环境准备</h2><p>POC环境如下图所示：</p>
<p><img src="https://xiejava1018.github.io/xiejavaimagesrc/images/2025/20251007/1-wazuhPOC%E7%8E%AF%E5%A2%83%E6%8B%93%E6%89%91%E5%9B%BE.png" alt="POC拓扑图"></p>
<table>
<thead>
<tr>
<th>主机</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>安全管理平台wazuh-server<br>(192.168.0.40)</td>
<td>All in one安装wazuh，监控wazuh-agent上报的告警信息进行可视化展示，并联动wazuh-agent进行主动的拦截阻止</td>
</tr>
<tr>
<td>Nginx服务器<br>（192.168.0.41）</td>
<td>安装Nginx服务及wazuh-agent</td>
</tr>
<tr>
<td>Apache2服务器<br>（192.168.0.43）</td>
<td>安装Apache2服务及wazuh-agent</td>
</tr>
<tr>
<td>kali<br>（192.168.0.65）</td>
<td>Kali (模拟恶意IP主机)</td>
</tr>
</tbody></table>
<p>以上除192.168.0.65是kali linux外，其他主机都是ubuntu。</p>
<h2 id="二、wazuh配置"><a href="#二、wazuh配置" class="headerlink" title="二、wazuh配置"></a>二、wazuh配置</h2><h3 id="1、wazuh-agent配置"><a href="#1、wazuh-agent配置" class="headerlink" title="1、wazuh-agent配置"></a>1、wazuh-agent配置</h3><h4 id="1）安装nginx服务并配置wazuh-agent"><a href="#1）安装nginx服务并配置wazuh-agent" class="headerlink" title="1）安装nginx服务并配置wazuh-agent"></a>1）安装nginx服务并配置wazuh-agent</h4><p>在192.168.0.41上安装nginx</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo apt updat</span><br><span class="line">sudo apt install nginx</span><br></pre></td></tr></table></figure>

<p>允许防火墙访问</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo ufw allow <span class="string">'Nginx Full'</span></span><br><span class="line">sudo ufw status</span><br><span class="line">sudo ufw app list</span><br></pre></td></tr></table></figure>

<p>验证nginx服务状态</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo systemctl status nginx</span><br></pre></td></tr></table></figure>

<p>用浏览器访问<a href="http://192.168.0.41" target="_blank" rel="noopener">http://192.168.0.41</a> 验证nginx服务是否正常访问<br><img src="https://xiejava1018.github.io/xiejavaimagesrc/images/2025/20251007/2-%E8%AE%BF%E9%97%AEnginx.png" alt="nginx"></p>
<p>将以下内容添加到 <code>/var/ossec/etc/ossec.conf</code> 文件中，以配置 Wazuh 代理并监控 nginx访问日志</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">localfile</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">log_format</span>&gt;</span>syslog<span class="tag">&lt;/<span class="name">log_format</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">location</span>&gt;</span>/var/log/nginx/access.log<span class="tag">&lt;/<span class="name">location</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">localfile</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>如下图所示：</p>
<p><img src="https://xiejava1018.github.io/xiejavaimagesrc/images/2025/20251007/3-nginx%E8%AE%BF%E9%97%AE%E6%97%A5%E5%BF%97%E8%B7%AF%E5%BE%84.png" alt="nginx访问日志路径"></p>
<p>重启wazuh-agent使配置生效</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo systemctl restart wazuh-agent</span><br></pre></td></tr></table></figure>

<h4 id="2-安装apach2并配置wazuh-agent"><a href="#2-安装apach2并配置wazuh-agent" class="headerlink" title="2)  安装apach2并配置wazuh-agent"></a>2)  安装apach2并配置wazuh-agent</h4><p>在192.168.0.43上安装apach2</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo apt update</span><br><span class="line">sudo apt install apache2</span><br></pre></td></tr></table></figure>

<p>允许防火墙访问</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo ufw allow <span class="string">'Apache'</span></span><br><span class="line">sudo ufw status</span><br><span class="line">sudo ufw app list</span><br></pre></td></tr></table></figure>

<p>验证nginx服务状态</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo systemctl status apache2</span><br></pre></td></tr></table></figure>

<p>用浏览器访问<a href="http://192.168.0.43" target="_blank" rel="noopener">http://192.168.0.43</a> 验证apache2服务是否正常访问</p>
<p><img src="https://xiejava1018.github.io/xiejavaimagesrc/images/2025/20251007/4-%E8%AE%BF%E9%97%AEapache2.png" alt="apache2"></p>
<p>将以下内容添加到 <code>/var/ossec/etc/ossec.conf</code> 文件中，以配置 Wazuh 代理并监控 apache2访问日志</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">localfile</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">log_format</span>&gt;</span>syslog<span class="tag">&lt;/<span class="name">log_format</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">location</span>&gt;</span>/var/log/apache2/access.log<span class="tag">&lt;/<span class="name">location</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">localfile</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>如下图所示：</p>
<p><img src="https://xiejava1018.github.io/xiejavaimagesrc/images/2025/20251007/5-apache%E8%AE%BF%E9%97%AE%E6%97%A5%E5%BF%97%E8%B7%AF%E5%BE%84.png" alt="apache访问日志路径"></p>
<p>重启wazuh-agent使配置生效</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo systemctl restart wazuh-agent</span><br></pre></td></tr></table></figure>

<h3 id="2、wazuh-server配置"><a href="#2、wazuh-server配置" class="headerlink" title="2、wazuh-server配置"></a>2、wazuh-server配置</h3><h4 id="1）配置IP信息黑名单"><a href="#1）配置IP信息黑名单" class="headerlink" title="1）配置IP信息黑名单"></a>1）配置IP信息黑名单</h4><p>下载Alienvault IP信誉数据库：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo wget https://iplists.firehol.org/files/alienvault_reputation.ipset -O /var/ossec/etc/lists/alienvault_reputation.ipset</span><br></pre></td></tr></table></figure>

<p>将攻击端点的IP地址（kali的IP地址192.168.0.65）添加到IP信誉数据库中：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo <span class="built_in">echo</span> <span class="string">"192.168.0.65"</span> &gt;&gt; /var/ossec/etc/lists/alienvault_reputation.ipset</span><br></pre></td></tr></table></figure>

<p>下载一个将 .ipset 格式转换为 .cdb 列表格式的脚本：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo wget https://wazuh.com/resources/iplist-to-cdblist.py -O /tmp/iplist-to-cdblist.py</span><br></pre></td></tr></table></figure>

<p>通过运行iplist-to-cdblist.py将ipset转换成.cdb 列表格式blacklist-alienvault</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo python3 /tmp/iplist-to-cdblist.py /var/ossec/etc/lists/alienvault_reputation.ipset /var/ossec/etc/lists/blacklist-alienvault</span><br></pre></td></tr></table></figure>

<p>为生成的文件分配正确的权限：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo chown wazuh:wazuh /var/ossec/etc/lists/blacklist-alienvault</span><br></pre></td></tr></table></figure>

<p>确认一下恶意IP192.168.0.65是否在黑名单里</p>
<p><img src="https://xiejava1018.github.io/xiejavaimagesrc/images/2025/20251007/6-%E6%81%B6%E6%84%8FIP%E9%BB%91%E5%90%8D%E5%8D%95.png" alt="恶意IP在信誉库的黑名单中"></p>
<h4 id="2）配置响应模块以阻止恶意IP地址"><a href="#2）配置响应模块以阻止恶意IP地址" class="headerlink" title="2）配置响应模块以阻止恶意IP地址"></a>2）配置响应模块以阻止恶意IP地址</h4><p>在Wazuh服务器上的 <code>/var/ossec/etc/rules/local_rules.xml</code> 自定义规则集文件中添加一个自定义规则以触发Wazuh主动响应脚本。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;group name=<span class="string">"attack,"</span>&gt;</span><br><span class="line">  &lt;rule id=<span class="string">"100100"</span> level=<span class="string">"10"</span>&gt;</span><br><span class="line">    &lt;if_group&gt;web|attack|attacks&lt;/if_group&gt;</span><br><span class="line">    &lt;list field=<span class="string">"srcip"</span> lookup=<span class="string">"address_match_key"</span>&gt;etc/lists/blacklist-alienvault&lt;/list&gt;</span><br><span class="line">    &lt;description&gt;IP address found <span class="keyword">in</span> AlienVault reputation database.&lt;/description&gt;</span><br><span class="line">  &lt;/rule&gt;</span><br><span class="line">&lt;/group&gt;</span><br></pre></td></tr></table></figure>

<p>将自定义规则集加入到Wazuh server <code>/var/ossec/etc/ossec.conf</code> 的配置文件中</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">ossec_config</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">ruleset</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- Default ruleset --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">decoder_dir</span>&gt;</span>ruleset/decoders<span class="tag">&lt;/<span class="name">decoder_dir</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">rule_dir</span>&gt;</span>ruleset/rules<span class="tag">&lt;/<span class="name">rule_dir</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">rule_exclude</span>&gt;</span>0215-policy_rules.xml<span class="tag">&lt;/<span class="name">rule_exclude</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">list</span>&gt;</span>etc/lists/audit-keys<span class="tag">&lt;/<span class="name">list</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">list</span>&gt;</span>etc/lists/amazon/aws-eventnames<span class="tag">&lt;/<span class="name">list</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">list</span>&gt;</span>etc/lists/security-eventchannel<span class="tag">&lt;/<span class="name">list</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">list</span>&gt;</span>etc/lists/blacklist-alienvault<span class="tag">&lt;/<span class="name">list</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- User-defined ruleset --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">decoder_dir</span>&gt;</span>etc/decoders<span class="tag">&lt;/<span class="name">decoder_dir</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">rule_dir</span>&gt;</span>etc/rules<span class="tag">&lt;/<span class="name">rule_dir</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">ruleset</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">ossec_config</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>将活动响应块添加到Wazuh服务器<code>/var/ossec/etc/ossec.conf</code> 文件:<br>防火墙丢弃命令与Ubuntu本地iptables防火墙集成，并丢弃来自攻击端点的网络连接60秒</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">ossec_config</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">active-response</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">disabled</span>&gt;</span>no<span class="tag">&lt;/<span class="name">disabled</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">command</span>&gt;</span>firewall-drop<span class="tag">&lt;/<span class="name">command</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">location</span>&gt;</span>local<span class="tag">&lt;/<span class="name">location</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">rules_id</span>&gt;</span>100100<span class="tag">&lt;/<span class="name">rules_id</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">timeout</span>&gt;</span>60<span class="tag">&lt;/<span class="name">timeout</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">active-response</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">ossec_config</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>重新启动Wazuh管理器以应用更改生效：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo systemctl restart wazuh-manager</span><br></pre></td></tr></table></figure>

<h2 id="三、效果验证"><a href="#三、效果验证" class="headerlink" title="三、效果验证"></a>三、效果验证</h2><h3 id="1、模拟攻击"><a href="#1、模拟攻击" class="headerlink" title="1、模拟攻击"></a>1、模拟攻击</h3><p>用kali(192.168.0.65)访问 <a href="http://192.168.0.41和http://192.168.0.43" target="_blank" rel="noopener">http://192.168.0.41和http://192.168.0.43</a><br>攻击端点首次连接到受害者的Web服务器。首次连接后，Wazuh主动响应模块临时阻止对Web服务器的任何后续连接60秒。</p>
<p><img src="https://xiejava1018.github.io/xiejavaimagesrc/images/2025/20251007/7-%E6%A8%A1%E6%8B%9F%E6%94%BB%E5%87%BB%E8%AE%BF%E9%97%AEWeb%E6%9C%8D%E5%8A%A1%E5%99%A8.png" alt="模拟攻击"></p>
<p>通过浏览器访问可以看到首次访问后每次都会被阻止60秒才能继续访问。</p>
<p>通过<code>curl  http://192.168.0.41</code>和<code>curl http://192.168.0.43</code> 首次可以返回信息，每次过60秒才能再次返回信息。</p>
<h3 id="2、可视化效果验证"><a href="#2、可视化效果验证" class="headerlink" title="2、可视化效果验证"></a>2、可视化效果验证</h3><p>可以在Wazuh仪表板中可视化警报数据。在威胁狩猎模块，添加过滤器以查询警报。</p>
<p><img src="https://xiejava1018.github.io/xiejavaimagesrc/images/2025/20251007/8-%E5%A8%81%E8%83%81%E7%8B%A9%E7%8C%8E%E6%A8%A1%E5%9D%97%E6%9F%A5%E8%AF%A2%E5%91%8A%E8%AD%A6.png" alt="告警信息"></p>
<p>在威胁狩猎模块可以看到有恶意IP地址在信誉库中被匹配到的告警，被防火墙自动阻断响应的告警以及60秒以后自动解除阻断的处置信息。</p>
<p>在详情信息中可以看到攻击阻止的详细信息，通过攻击源IP匹配到了信誉库的黑名单，触发了防火墙封堵规则进行了自动封堵。</p>
<p><img src="https://xiejava1018.github.io/xiejavaimagesrc/images/2025/20251007/9-%E6%8B%A6%E6%88%AA%E9%98%BB%E6%96%AD%E5%A4%84%E7%BD%AE%E8%AF%A6%E6%83%85.png" alt="告警详情"></p>
<p>至此，我们通过一个完整的POC验证了wazuh发现恶意IP攻击到自动封堵阻止攻击的全过程。</p>
<hr>
<p>作者博客：<a href="http://xiejava.ishareread.com/" target="_blank" rel="noopener">http://xiejava.ishareread.com/</a></p>
<center> 

<br>

<p><img src="https://xiejava1018.github.io/xiejavaimagesrc/images/fullbug%E5%BE%AE%E4%BF%A1%E5%85%AC%E4%BC%97%E5%8F%B7.jpg" alt="“fullbug”微信公众号" title="“fullbug”微信公众号"> </p>
<p>关注：微信公众号,一起学习成长！</center></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://xiejava.ishareread.com/posts/1ef039a/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="XieJava">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="https://img9.doubanio.com/icon/ul70489051-4.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="XieJava's blog">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/posts/1ef039a/" itemprop="url">开源安全管理平台wazuh-安装与配置</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2025-09-29T19:49:14+08:00">
                2025-09-29
              </time>
            

            
              <span class="post-meta-divider">|</span>
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-check-o"></i>
              </span>
              
                <span class="post-meta-item-text">更新于&#58;</span>
              
              <time title="更新于" itemprop="dateModified" datetime="2025-09-30T10:55:11+08:00">
                2025-09-30
              </time>
            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%8A%80%E6%9C%AF/" itemprop="url" rel="index">
                    <span itemprop="name">技术</span>
                  </a>
                </span>

                
                
                  ， 
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%8A%80%E6%9C%AF/%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8/" itemprop="url" rel="index">
                    <span itemprop="name">网络安全</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/posts/1ef039a/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count valine-comment-count" data-xid="/posts/1ef039a/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          
             <span id="/posts/1ef039a/" class="leancloud_visitors" data-flag-title="开源安全管理平台wazuh-安装与配置">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数&#58;</span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  1.6k
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">
                  6
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>Wazuh是一个功能强大的开源安全平台，它集成了安全信息与事件管理（SIEM）和扩展检测与响应（XDR）的能力，旨在为本地、虚拟化、容器化及云环境中的工作负载提供统一的威胁预防、检测和响应解决方案。</p>
<p>Wazuh的核心能力如下：</p>
<table>
<thead>
<tr>
<th>核心功能</th>
<th>核心功能说明</th>
</tr>
</thead>
<tbody><tr>
<td>威胁检测与响应</td>
<td>提供入侵检测（如恶意软件、Rootkit检测）、日志数据分析、文件完整性监控以及主动响应（如自动封禁IP）等能力。</td>
</tr>
<tr>
<td>资产与漏洞管理</td>
<td>自动进行资产盘点（端口、进程、应用等），并关联CVE数据库实现漏洞检测，帮助识别系统弱点。</td>
</tr>
<tr>
<td>合规性与配置评估​</td>
<td>支持PCI DSS、GDPR、HIPAA等多种合规标准，提供预定义的检查策略和自动化报告生成功能。</td>
</tr>
<tr>
<td>云与容器安全​</td>
<td>支持通过API监控AWS、Azure、Google Cloud等云环境，并能与Docker引擎集成，监控容器镜像、配置和运行时行为。</td>
</tr>
<tr>
<td>架构与可扩展性</td>
<td>采用代理/服务器架构，支持Windows、Linux、macOS等多种操作系统，并拥有灵活的规则引擎，允许用户自定义检测规则。</td>
</tr>
</tbody></table>
<h2 id="核心组件与工作方式"><a href="#核心组件与工作方式" class="headerlink" title="核心组件与工作方式"></a>核心组件与工作方式</h2><p>Wazuh的典型架构主要包含三个组件，它们协同工作以提供完整的安全防护闭环：<br><img src="https://xiejava1018.github.io/xiejavaimagesrc/images/2025/20250929/1-wazuh%E6%9E%B6%E6%9E%84.png" alt="核心组件"></p>
<ol>
<li>Wazuh代理（Agent）​​：这是安装在需要保护的端点（如服务器、笔记本电脑、云实例）上的轻量级软件。它负责收集日志、监控文件完整性、扫描系统配置和漏洞，并将这些数据安全地发送给中央管理器。</li>
<li>Wazuh服务器（Server）​​：作为大脑，服务器接收来自所有代理的数据，并通过内置的解码器和规则引擎进行分析，以识别潜在的安全威胁和异常活动。它还可以管理代理的配置和升级。</li>
<li>Wazuh索引器（Index）​​：Wazuh索引器是一个高度可扩展的全文本搜索和分析引擎。这个中央组件索引并存储由Wazuh服务器生成的警报。</li>
<li>Wazuh仪表盘（dashboard）：Wazuh仪表盘是数据可视化和分析的网络用户界面。它包括用于威胁狩猎、合规性（例如，PCI DSS、GDPR、CIS、HIPAA、NIST 800-53）的现成仪表盘，检测到的易受攻击的应用程序，文件完整性监控数据，配置评估结果，云基础设施监控事件以及其他内容。它还用于管理Wazuh配置并监控其状态。</li>
</ol>
<h2 id="主要应用场景"><a href="#主要应用场景" class="headerlink" title="主要应用场景"></a>主要应用场景</h2><p>基于上述特点，Wazuh可以在多种环境中发挥重要作用：</p>
<ul>
<li>企业网络安全​：保护企业内网中的服务器和终端设备，检测和响应来自内部和外部的安全威胁，如SSH暴力破解、Web应用攻击等。</li>
<li>满足合规性要求​：对于需要遵守PCI DSS、GDPR（通用数据保护条例）等法规的组织，Wazuh的自动化合规检查和报告功能可以显著降低审计复杂度。</li>
<li>云原生环境防护​：在混合云或多云环境中，Wazuh能提供统一的安全视图，监控云基础设施的配置风险（如公开的S3存储桶）和容器化应用的安全。</li>
</ul>
<h2 id="安装与配置"><a href="#安装与配置" class="headerlink" title="安装与配置"></a>安装与配置</h2><h3 id="1、资源要求"><a href="#1、资源要求" class="headerlink" title="1、资源要求"></a>1、资源要求</h3><p>wazuh安装的硬件需求高度依赖于受保护端点数量和云工作负载。<br>以下配置在同一主机上all in one部署Wazuh服务器、Wazuh索引器和Wazuh仪表板。这通常足以监控多达100个端点，并存储90天的可查询/索引警报数据。下表显示了all in one部署的推荐硬件：</p>
<table>
<thead>
<tr>
<th>Agents</th>
<th>CPU</th>
<th>RAM</th>
<th>Storage (90 days)</th>
</tr>
</thead>
<tbody><tr>
<td>1-25</td>
<td>4 vCPU</td>
<td>8 GiB</td>
<td>50 GB</td>
</tr>
<tr>
<td>25–50</td>
<td>8 vCPU</td>
<td>8 GiB</td>
<td>100 GB</td>
</tr>
<tr>
<td>50–100</td>
<td>8 vCPU</td>
<td>8 GiB</td>
<td>200 GB</td>
</tr>
</tbody></table>
<p>Wazuh 的中心组件需要 64 位 Intel、AMD 或 ARM Linux 处理器（x86_64/AMD64 或 AARCH64/ARM64 架构）来运行。Wazuh 推荐以下任何一种操作系统版本：</p>
<ul>
<li>Amazon Linux 2，Amazon Linux 2023</li>
<li>CentOS 7，8</li>
<li>CentOS Stream 10</li>
<li>Red Hat Enterprise Linux 7，8，9，10</li>
<li>Ubuntu 16.04，18.04，20.04，22.04，24.04</li>
</ul>
<h3 id="2、快速安装"><a href="#2、快速安装" class="headerlink" title="2、快速安装"></a>2、快速安装</h3><p>Wazuh的安装很简单，直接执行以下命令即可。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -sO https://packages.wazuh.com/4.13/wazuh-install.sh &amp;&amp; sudo bash ./wazuh-install.sh -a</span><br></pre></td></tr></table></figure>

<p>命令执行完成，输出将显示访问用户名密码，并显示确认安装成功的消息。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">INFO: --- Summary ---</span><br><span class="line">INFO: You can access the web interface https://&lt;WAZUH_DASHBOARD_IP_ADDRESS&gt;</span><br><span class="line">    User: admin</span><br><span class="line">    Password: &lt;ADMIN_PASSWORD&gt;</span><br><span class="line">INFO: Installation finished.</span><br></pre></td></tr></table></figure>

<p>通过web界面就可以访问安装好的wazuh<br><img src="https://xiejava1018.github.io/xiejavaimagesrc/images/2025/20250929/2-wazuh%E7%99%BB%E5%BD%95%E7%95%8C%E9%9D%A2.png" alt="wazuh登录界面"></p>
<p>输入用户名和密码就可以登录到wazuh<br><img src="https://xiejava1018.github.io/xiejavaimagesrc/images/2025/20250929/3-wazuh%E7%9A%84dashboard.png" alt="wazuh的dashboard"></p>
<h3 id="3、修改密码"><a href="#3、修改密码" class="headerlink" title="3、修改密码"></a>3、修改密码</h3><p>wazuh安装后会默认给个admin的密码，这个密码比较长也不好记忆。可以通过以下命令对admin的默认密码进行修改。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bash wazuh-passwords-tool.sh -u admin -p Secr3tP4ssw*rd</span><br></pre></td></tr></table></figure>

<h3 id="4、安装EDR的agent"><a href="#4、安装EDR的agent" class="headerlink" title="4、安装EDR的agent"></a>4、安装EDR的agent</h3><p>Wazuh代理是一种单一且轻量级的监控软件。它是一个多平台组件，可以部署到笔记本电脑、台式机、服务器、云实例、容器或虚拟机。它通过收集关键系统和应用记录、库存数据以及检测异常，为端点的安全性提供可见性。<br>在wazuh的dashboard界面，找到Agents summary 点击进去后，点击“Deploy new agent” 安装新的agent代理<br><img src="https://xiejava1018.github.io/xiejavaimagesrc/images/2025/20250929/4-wazuh%E7%9A%84endpoints.png" alt="\[图片\]"></p>
<p>将显示agent安装的向导界面。<br><img src="https://xiejava1018.github.io/xiejavaimagesrc/images/2025/20250929/5-wazuh%E7%9A%84%E6%96%B0%E5%A2%9Eagent.png" alt="\[图片\]"></p>
<p>选择目标主机的操作系统，填写wazuh的服务的IP后，将自动生成安装agent的脚本命令。<br><img src="https://xiejava1018.github.io/xiejavaimagesrc/images/2025/20250929/6-wazuh%E8%87%AA%E5%8A%A8%E7%94%9F%E6%88%90agent%E5%AE%89%E8%A3%85%E8%84%9A%E6%9C%AC.png" alt="\[图片\]"></p>
<p>在目标主机上直接执行命令就可以成功将agent安装。<br><img src="https://xiejava1018.github.io/xiejavaimagesrc/images/2025/20250929/7-wazuh%E5%AE%89%E8%A3%85.png" alt="\[图片\]"></p>
<p>通过以下命令启动wazuh-agent</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo systemctl daemon-reload</span><br><span class="line">sudo systemctl <span class="built_in">enable</span> wazuh-agent</span><br><span class="line">sudo systemctl start wazuh-agent</span><br></pre></td></tr></table></figure>

<p>再通过 <code>sudo systemctl status wazuh-agent</code> 查看wazuh-agent的运行状态。<br><img src="https://xiejava1018.github.io/xiejavaimagesrc/images/2025/20250929/8-wazuh%E5%AE%89%E8%A3%85agent%E5%90%AF%E5%8A%A8%E7%8A%B6%E6%80%81.png" alt="\[图片\]"></p>
<h3 id="5、验证EDR的效果"><a href="#5、验证EDR的效果" class="headerlink" title="5、验证EDR的效果"></a>5、验证EDR的效果</h3><p>wazuh-agent安装完后，就可以在wazuh的dashbord中看到agent采集到的相应的安全风险概览数据了。<br><img src="https://xiejava1018.github.io/xiejavaimagesrc/images/2025/20250929/9-wazuh%E5%AE%89%E5%85%A8%E9%A3%8E%E9%99%A9%E6%A6%82%E8%A7%88.png" alt="\[图片\]"></p>
<h2 id="总结与建议"><a href="#总结与建议" class="headerlink" title="总结与建议"></a>总结与建议</h2><p>总的来说，Wazuh是一个功能全面、可扩展性强的开源安全平台，特别适合那些希望构建统一、高效且成本可控的安全运营体系的企业或技术团队。后续我将通过一系列POC来验证wazuh的能力。</p>
<hr>
<p>作者博客：<a href="http://xiejava.ishareread.com/" target="_blank" rel="noopener">http://xiejava.ishareread.com/</a></p>
<center> 

<br>

<p><img src="https://xiejava1018.github.io/xiejavaimagesrc/images/fullbug%E5%BE%AE%E4%BF%A1%E5%85%AC%E4%BC%97%E5%8F%B7.jpg" alt="“fullbug”微信公众号" title="“fullbug”微信公众号"> </p>
<p>关注：微信公众号,一起学习成长！</center></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://xiejava.ishareread.com/posts/d2b2ee39/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="XieJava">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="https://img9.doubanio.com/icon/ul70489051-4.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="XieJava's blog">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/posts/d2b2ee39/" itemprop="url">Easytier快速实现异地组网</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2025-08-30T15:51:04+08:00">
                2025-08-30
              </time>
            

            
              <span class="post-meta-divider">|</span>
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-check-o"></i>
              </span>
              
                <span class="post-meta-item-text">更新于&#58;</span>
              
              <time title="更新于" itemprop="dateModified" datetime="2025-08-30T16:05:23+08:00">
                2025-08-30
              </time>
            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%8A%80%E6%9C%AF/" itemprop="url" rel="index">
                    <span itemprop="name">技术</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/posts/d2b2ee39/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count valine-comment-count" data-xid="/posts/d2b2ee39/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          
             <span id="/posts/d2b2ee39/" class="leancloud_visitors" data-flag-title="Easytier快速实现异地组网">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数&#58;</span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  1.6k
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">
                  5
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>玩NAS的小伙伴在安装完NAS系统后都在折腾“回家”，NAS是放在家里的设备，如何在外面方便的访问家里的主机设备是很多小伙伴面临的课题。“回家”的办法有很多，今天主要介绍我个人觉得很方便的Easytier来快速实现异地组网在外面访问家里的设备。</p>
<h2 id="一、什么是Easytier"><a href="#一、什么是Easytier" class="headerlink" title="一、什么是Easytier"></a>一、什么是Easytier</h2><p>EasyTier 是一款简单、安全、去中心化的内网穿透和异地组网工具，适合远程办公、异地访问、游戏加速等多种场景。无需公网 IP，无需复杂配置，轻松实现不同地点设备间的安全互联。</p>
<h2 id="二、飞牛NAS安装Easytier"><a href="#二、飞牛NAS安装Easytier" class="headerlink" title="二、飞牛NAS安装Easytier"></a>二、飞牛NAS安装Easytier</h2><p>在飞牛NAS的镜像仓库中找到下载量最大的easytier斤镜像进行安装<br><img src="https://xiejava1018.github.io/xiejavaimagesrc/images/2025/20250830/1-%E9%A3%9E%E7%89%9Bnas-docker.png" alt="\[图片\]"></p>
<p>在启动容器时设置使用高权限执行容器<br><img src="https://xiejava1018.github.io/xiejavaimagesrc/images/2025/20250830/2-easytier-docker%E9%AB%98%E6%9D%83%E9%99%90%E9%85%8D%E7%BD%AE.png" alt="\[图片\]"></p>
<p>在“命令”输入框中输入</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">--network-name &lt;你的虚拟网络名称&gt;</span><br><span class="line">--network-secret &lt;你的网络密码，随便输入，后面加入网络的要用到&gt;</span><br><span class="line">-p tcp://public.easytier.top:11010</span><br><span class="line">--ipv4 10.10.10.3</span><br><span class="line">-n 192.168.0.0/24(这里换成自己的内网的网段)</span><br></pre></td></tr></table></figure>

<p>这是一个用于连接到一个现有 EasyTier 网络的客户端节点的典型配置。<br><img src="https://xiejava1018.github.io/xiejavaimagesrc/images/2025/20250830/3-easytier-docker%E5%91%BD%E4%BB%A4%E9%85%8D%E7%BD%AE.png" alt="\[图片\]"></p>
<h3 id="参数详解"><a href="#参数详解" class="headerlink" title="参数详解"></a>参数详解</h3><ol>
<li><code>--network-name 你的虚拟网络名称</code> <ul>
<li>含义： 指定要加入的虚拟网络的名称。</li>
<li>解释： 所有要组成同一个虚拟局域网（VLAN）的节点（客户端和超级节点）必须使用完全相同的网络名称。如网络名为 xiejava。这相当于一个共享的“房间号”或“频道号”，只有名称相同的节点才能互相发现和通信。</li>
</ul>
</li>
<li><code>--network-secret 你的网络密码</code><ul>
<li>含义： 用于验证和加密网络通信的密钥（密码）。</li>
<li>解释： 所有加入同一网络的节点必须使用完全相同的密钥。它有两个主要作用：<ul>
<li>身份认证： 防止未经授权的节点随意加入你的私有网络。</li>
<li>通信加密： 对节点之间传输的数据进行加密，保障通信安全。因此，一个强密码非常重要。</li>
</ul>
</li>
</ul>
</li>
<li><code>-p tcp://public.easytier.top:11010</code><ul>
<li>含义： 指定要连接的上层节点（Super Node）的地址。</li>
<li>解释：<ul>
<li>-p 是 –peer 的简写形式。</li>
<li>tcp:// 表示使用 TCP 协议进行连接。</li>
<li>public.easytier.top:11010 是超级节点的地址和端口。这是一个部署在公网上的服务器，它的作用是帮助位于不同内网中的客户端节点（比如你的这台机器）进行“打洞”和中转连接。</li>
</ul>
</li>
<li>简单来说，这个参数告诉你的客户端：“请去这个地址找中介服务器，它会帮你联系网络里的其他伙伴。”</li>
</ul>
</li>
<li><code>--ipv4 10.10.10.3</code><ul>
<li>含义： 指定本节点在虚拟网络中使用的静态 IPv4 地址。</li>
<li>解释： 加入虚拟网络后，你的机器会拥有两个IP地址：一个是物理网卡的真实地址（如 192.168.1.100），另一个就是这个虚拟地址 10.10.10.3。网络中的其他设备将通过这个 10.10.10.3 的地址来访问你的机器。使用静态IP可以方便地管理和访问特定的设备。</li>
</ul>
</li>
<li><code>-n 192.168.0.0/24</code><ul>
<li>含义： 为虚拟网络添加一条静态路由规则。</li>
<li>解释：<ul>
<li>-n 是 –route 的简写形式，用于添加路由。</li>
<li>192.168.0.0/24 是一个网段。这条命令的意思是：“所有发往 192.168.0.0/24 这个网段的数据包，都请通过本机的 EasyTier 虚拟网卡发送（即通过 EasyTier 虚拟网络来路由）。”</li>
</ul>
</li>
<li>用途： 假设你家里的本地局域网网段是 192.168.0.0/24，你在这台机器上添加了这条路由。那么，当网络中的其他节点（如 10.10.10.2）想访问你内网的服务器（如 192.168.0.100）时，它们的数据包会发到你这台机器（10.10.10.3），然后由你这台机器利用本地物理网络转发到 192.168.0.100。这样就实现了从异地访问公司内网资源的功能。这通常是在作为“网关”或提供路由服务的节点上配置的。</li>
</ul>
</li>
</ol>
<h3 id="配置总结"><a href="#配置总结" class="headerlink" title="配置总结"></a>配置总结</h3><p>这条完整的命令配置了一个 EasyTier 客户端，其作用是：</p>
<ol>
<li>加入一个名为 “虚拟网络名”、密码为 “你的虚拟网络密码” 的私有虚拟网络。</li>
<li>通过连接公网上的超级节点 public.easytier.top:11010 来与其他节点建立联系。</li>
<li>它在本虚拟网络中的固定IP地址是 10.10.10.3。</li>
<li>它同时宣布了自己可以为整个虚拟网络提供到 192.168.0.0/24 网段的路由服务，其他节点要访问这个网段的数据都会经过它。</li>
</ol>
<p>简单来说，将这台NAS机器作为家里网络内部的节点，它既加入了虚拟网络（地址 10.10.10.3），又扮演了让外部能够访问内部 192.168.0.x 服务器的“网关”角色。</p>
<h2 id="三、Easytier快速组网异地访问"><a href="#三、Easytier快速组网异地访问" class="headerlink" title="三、Easytier快速组网异地访问"></a>三、Easytier快速组网异地访问</h2><p>Easytier提供了多种符合各类操作系统的工具包括linux、window、MacOS、Android 等，下面以window为例，到官网<a href="https://easytier.rs/guide/download.html下载window的Easytier" target="_blank" rel="noopener">https://easytier.rs/guide/download.html下载window的Easytier</a> GUI。<br>在window机器上进行安装后打开Easytier GUI界面进行设置<br>在网络名称和网络密码中分别设置成在飞牛NAS中Easytier docker容器中命令中指定的网络名称和网络密码。<br><img src="https://xiejava1018.github.io/xiejavaimagesrc/images/2025/20250830/4-easytier-window%E7%BB%84%E7%BD%91.png" alt="\[图片\]"></p>
<p>设置完成后点击“运行网络”，稍等一会就发现节点信息中本机和飞牛NAS中的easytier都连上来了。<br><img src="https://xiejava1018.github.io/xiejavaimagesrc/images/2025/20250830/5-easytier-window%E7%BB%84%E7%BD%91%E6%88%90%E5%8A%9F.png" alt="\[图片\]"></p>
<p>可以看到运行window的Easytier GUI的机器在外面连的是手机热点的网络，可以ping通家里内网的IP，可以畅快的访问家里的网络了。<br><img src="https://xiejava1018.github.io/xiejavaimagesrc/images/2025/20250830/6-easytier%E7%BB%84%E7%BD%91%E6%95%88%E6%9E%9C.png" alt="\[图片\]"></p>
<h2 id="四、Easytier的适用场景"><a href="#四、Easytier的适用场景" class="headerlink" title="四、Easytier的适用场景"></a>四、Easytier的适用场景</h2><ul>
<li>远程办公：让公司、家中和外地的电脑像在同一局域网一样互通。</li>
<li>异地访问：随时随地安全访问家中 NAS、服务器或其他设备。</li>
<li>游戏加速：组建虚拟局域网，畅玩联机游戏。</li>
<li>物联网组网：让分布在不同地点的设备安全互联。</li>
</ul>
<hr>
<p>作者博客：<a href="http://xiejava.ishareread.com/" target="_blank" rel="noopener">http://xiejava.ishareread.com/</a></p>
<center> 

<br>

<p><img src="https://xiejava1018.github.io/xiejavaimagesrc/images/fullbug%E5%BE%AE%E4%BF%A1%E5%85%AC%E4%BC%97%E5%8F%B7.jpg" alt="“fullbug”微信公众号" title="“fullbug”微信公众号"> </p>
<p>关注：微信公众号,一起学习成长！</center></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><span class="space">&hellip;</span><a class="page-number" href="/page/22/">22</a><a class="extend next" rel="next" href="/page/2/">&gt;</a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
      <div id="sidebar-dimmer"></div>
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image"
                src="https://img9.doubanio.com/icon/ul70489051-4.jpg"
                alt="XieJava" />
            
              <p class="site-author-name" itemprop="name">XieJava</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives">
              
                  <span class="site-state-item-count">218</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">12</span>
                  <span class="site-state-item-name">分类</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">27</span>
                  <span class="site-state-item-name">标签</span>
                </a>
              </div>
            

          </nav>

          
            <div class="feed-link motion-element">
              <a href="/atom.xml" rel="alternate">
                <i class="fa fa-rss"></i>
                RSS
              </a>
            </div>
          

          <div class="links-of-author motion-element">
            
              
                <span class="links-of-author-item">
                  <a href="https://github.com/xiejava1018" target="_blank" title="GitHub">
                    
                      <i class="fa fa-fw fa-github"></i>GitHub</a>
                </span>
              
            
          </div>

          
          

          
          
            <div class="links-of-blogroll motion-element links-of-blogroll-inline">
              <div class="links-of-blogroll-title">
                <i class="fa  fa-fw fa-link"></i>
                友情链接
              </div>
              <ul class="links-of-blogroll-list">
                
                  <li class="links-of-blogroll-item">
                    <a href="http://www.ishareread.com/" title="爱分享读书" target="_blank">爱分享读书</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="https://blog.csdn.net/fullbug" title="CSDN" target="_blank">CSDN</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="https://www.douban.com/people/xiejava/" title="豆瓣" target="_blank">豆瓣</a>
                  </li>
                
              </ul>
            </div>
          

          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2025</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">XieJava</span>

  
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-area-chart"></i>
    </span>
    
      <span class="post-meta-item-text">Site words total count&#58;</span>
    
    <span title="Site words total count">440.3k</span>
  
  
<!--51la网站应用监控-->
<script src="https://sdk.51.la/perf/js-sdk-perf.min.js" crossorigin="anonymous"></script>
<script>
  new LingQue.Monitor().init({id:"JdyGwOQm8BurILgP"});
</script>
<!--51la网站访问统计-->
<script charset="UTF-8" id="LA_COLLECT" src="//sdk.51.la/js-sdk-pro.min.js"></script>
<script>LA.init({id: "JdyBT51UUKIm9A1e",ck: "JdyBT51UUKIm9A1e"})</script>
<br>
<script id="LA-DATA-WIDGET" crossorigin="anonymous" src="https://v6-widget.51.la/v6/JdyBT51UUKIm9A1e/quote.js?theme=0&f=12"></script>
<br>
<a target="_blank" title="51la网站统计" href="https://v6.51.la/land/JdyBT51UUKIm9A1e"><img src="https://sdk.51.la/icon/2-4.png"></a>
</div>






  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Muse</a></div>




        







  <div >
    <!-- 友盟代码 -->
    <script type="text/javascript">document.write(unescape("%3Cspan id='cnzz_stat_icon_1278575888'%3E%3C/span%3E%3Cscript src='https://v1.cnzz.com/z_stat.php%3Fid%3D1278575888%26online%3D1%26show%3Dline' type='text/javascript'%3E%3C/script%3E"));</script>
	<!-- 友盟代码 end -->
  </div>



        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
          <span id="scrollpercent"><span>0</span>%</span>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=6.3.0"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=6.3.0"></script>



  
  

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=6.3.0"></script>




  


  




	





  





  










  <script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script>
  <script src="//unpkg.com/valine/dist/Valine.min.js"></script>
  
  <script type="text/javascript">
    var GUEST = ['nick','mail','link'];
    var guest = 'nick,mail,link';
    guest = guest.split(',').filter(item=>{
      return GUEST.indexOf(item)>-1;
    });
    new Valine({
        el: '#comments' ,
        verify: true,
        notify: true,
        appId: 'LfKg3xroRwHlese1o0oSY2zx-gzGzoHsz',
        appKey: 'NXbIDcd2qs0UWvoi0MXdwbmW',
        placeholder: 'Just go go',
        avatar:'mm',
        guest_info:guest,
        pageSize:'10' || 10,
    });
  </script>



  





  

  
  <script src="https://cdn1.lncld.net/static/js/av-core-mini-0.6.4.js"></script>
  <script>AV.initialize("LfKg3xroRwHlese1o0oSY2zx-gzGzoHsz", "NXbIDcd2qs0UWvoi0MXdwbmW");</script>
  <script>
    function showTime(Counter) {
      var query = new AV.Query(Counter);
      var entries = [];
      var $visitors = $(".leancloud_visitors");

      $visitors.each(function () {
        entries.push( $(this).attr("id").trim() );
      });

      query.containedIn('url', entries);
      query.find()
        .done(function (results) {
          var COUNT_CONTAINER_REF = '.leancloud-visitors-count';

          if (results.length === 0) {
            $visitors.find(COUNT_CONTAINER_REF).text(0);
            return;
          }

          for (var i = 0; i < results.length; i++) {
            var item = results[i];
            var url = item.get('url');
            var time = item.get('time');
            var element = document.getElementById(url);

            $(element).find(COUNT_CONTAINER_REF).text(time);
          }
          for(var i = 0; i < entries.length; i++) {
            var url = entries[i];
            var element = document.getElementById(url);
            var countSpan = $(element).find(COUNT_CONTAINER_REF);
            if( countSpan.text() == '') {
              countSpan.text(0);
            }
          }
        })
        .fail(function (object, error) {
          console.log("Error: " + error.code + " " + error.message);
        });
    }

    function addCount(Counter) {
      var $visitors = $(".leancloud_visitors");
      var url = $visitors.attr('id').trim();
      var title = $visitors.attr('data-flag-title').trim();
      var query = new AV.Query(Counter);

      query.equalTo("url", url);
      query.find({
        success: function(results) {
          if (results.length > 0) {
            var counter = results[0];
            counter.fetchWhenSave(true);
            counter.increment("time");
            counter.save(null, {
              success: function(counter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(counter.get('time'));
              },
              error: function(counter, error) {
                console.log('Failed to save Visitor num, with error message: ' + error.message);
              }
            });
          } else {
            var newcounter = new Counter();
            /* Set ACL */
            var acl = new AV.ACL();
            acl.setPublicReadAccess(true);
            acl.setPublicWriteAccess(true);
            newcounter.setACL(acl);
            /* End Set ACL */
            newcounter.set("title", title);
            newcounter.set("url", url);
            newcounter.set("time", 1);
            newcounter.save(null, {
              success: function(newcounter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(newcounter.get('time'));
              },
              error: function(newcounter, error) {
                console.log('Failed to create');
              }
            });
          }
        },
        error: function(error) {
          console.log('Error:' + error.code + " " + error.message);
        }
      });
    }

    $(function() {
      var Counter = AV.Object.extend("Counter");
      if ($('.leancloud_visitors').length == 1) {
        addCount(Counter);
      } else if ($('.post-title-link').length > 1) {
        showTime(Counter);
      }
    });
  </script>



  

  

  
  

  

  
  <script type="text/javascript" src="/js/src/js.cookie.js?v=6.3.0"></script>
  <script type="text/javascript" src="/js/src/scroll-cookie.js?v=6.3.0"></script>


  


</body>
</html>
