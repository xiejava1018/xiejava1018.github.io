<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>XieJava&#39;s blog</title>
  
  <subtitle>记录最好的自己</subtitle>
  <link href="/atom.xml" rel="self"/>
  
  <link href="http://xiejava.ishareread.com/"/>
  <updated>2025-12-19T09:16:13.675Z</updated>
  <id>http://xiejava.ishareread.com/</id>
  
  <author>
    <name>XieJava</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>为了管好IP我上了一套开源的IP管理系统phpIPAM</title>
    <link href="http://xiejava.ishareread.com/posts/db0ebabe/"/>
    <id>http://xiejava.ishareread.com/posts/db0ebabe/</id>
    <published>2025-12-19T06:33:19.000Z</published>
    <updated>2025-12-19T09:16:13.675Z</updated>
    
    <content type="html"><![CDATA[<p>通常，网络或系统管理员会使用一个电子表格来记录IP地址的分配信息，然而，随着网络中的设备越来越多依赖于电子表格并不方便，十分容易出错，想管理好这些加入网络中的设备，就得有个更方便的工具。就我家里的网络而言，接入的设备就已经接近40个了，亟需找这么一个工具来记录和管理这些IP，目前找到的比较好用又轻量化的IP管理工具就是phpIPAM。</p><h1 id="一、什么是phpIPAM"><a href="#一、什么是phpIPAM" class="headerlink" title="一、什么是phpIPAM"></a>一、什么是phpIPAM</h1><p>phpIPAM（PHP IP Address Manager）是一个开源的网络 IP 地址管理工具，其目标是提供轻松，现代和有用的IP地址管理。它是基于php的应用程序，带有MySQL数据库后端，使用jQuery库，ajax和HTML5 / CSS3功能。主要用于企业级 IP 地址空间的规划、管理和跟踪。</p><p><strong>为什么要用phpIPAM</strong></p><table><thead><tr><th>问题场景</th><th>无 phpIPAM</th><th>有 phpIPAM</th></tr></thead><tbody><tr><td>IP分配冲突</td><td>人工记录 Excel，容易重复</td><td>系统自动管理，避免冲突</td></tr><tr><td>查找可用 IP</td><td>手动测试多个 IP</td><td>一键查找空闲 IP</td></tr><tr><td>网络规划</td><td>凭经验划分，不精确</td><td>可视化规划，最优利用</td></tr><tr><td>故障排查</td><td>不知道 IP 使用者</td><td>快速定位设备负责人</td></tr></tbody></table><p><strong>phpIPAM核心功能如下：</strong><br><img src="http://image2.ishareread.com/images/2025/20251219/1-phpIPAM%E5%8A%9F%E8%83%BD.png" alt="\[图片\]"></p><p>官网：<br><a href="https://www.phpipam.net/" target="_blank" rel="noopener">https://www.phpipam.net/</a><br><a href="https://hub.docker.com/r/phpipam/phpipam-www/" target="_blank" rel="noopener">https://hub.docker.com/r/phpipam/phpipam-www/</a></p><h1 id="二、安装phpIPAM"><a href="#二、安装phpIPAM" class="headerlink" title="二、安装phpIPAM"></a>二、安装phpIPAM</h1><p>安装phpIPAM可以用docker方式快速安装，根据官网的docker-compose.yml稍微做了优化，主要是加了mysql的健康检查，因为在安装的过程中数据库没有就绪或容器启动顺序有问题会导致安装失败。<br>docker-compose.yml文件内容如下：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">version: <span class="string">'3.8'</span></span><br><span class="line">services:</span><br><span class="line">  phpipam-web:</span><br><span class="line">    image: phpipam/phpipam-www:latest</span><br><span class="line">    ports:</span><br><span class="line">      - <span class="string">"8488:80"</span></span><br><span class="line">    environment:</span><br><span class="line">      - TZ=Asia/Shanghai</span><br><span class="line">      - IPAM_DATABASE_HOST=phpipam-db</span><br><span class="line">      - IPAM_DATABASE_PASS=12345678</span><br><span class="line">    depends_on:</span><br><span class="line">      - phpipam-db</span><br><span class="line">    restart: unless-stopped</span><br><span class="line"></span><br><span class="line">  phpipam-cron:</span><br><span class="line">    image: phpipam/phpipam-cron:latest</span><br><span class="line">    environment:</span><br><span class="line">      - TZ=Asia/Shanghai</span><br><span class="line">      - IPAM_DATABASE_HOST=phpipam-db</span><br><span class="line">      - IPAM_DATABASE_PASS=12345678</span><br><span class="line">      - SCAN_INTERVAL=1h</span><br><span class="line">    depends_on:</span><br><span class="line">      phpipam-db:</span><br><span class="line">        condition: service_healthy</span><br><span class="line">    restart: unless-stopped</span><br><span class="line"></span><br><span class="line">  phpipam-db:</span><br><span class="line">    image: mariadb:10.5</span><br><span class="line">    environment:</span><br><span class="line">      - MYSQL_ROOT_PASSWORD=12345678</span><br><span class="line">      - MYSQL_DATABASE=phpipam</span><br><span class="line">      - MYSQL_USER=phpipam</span><br><span class="line">      - MYSQL_PASSWORD=12345678</span><br><span class="line">    volumes:</span><br><span class="line">      - db_data:/var/lib/mysql</span><br><span class="line">    restart: unless-stopped</span><br><span class="line">    healthcheck:</span><br><span class="line">      <span class="built_in">test</span>: [<span class="string">"CMD"</span>, <span class="string">"mysqladmin"</span>, <span class="string">"ping"</span>, <span class="string">"-h"</span>, <span class="string">"localhost"</span>]</span><br><span class="line">      interval: 10s</span><br><span class="line">      timeout: 5s</span><br><span class="line">      retries: 5</span><br><span class="line"></span><br><span class="line">volumes:</span><br><span class="line">  db_data:</span><br></pre></td></tr></table></figure><p>将docker-compose.yml文件考到安装目录如/home/app/phpipam<br>执行<code>docker compose up -d</code> 就可以顺利安装完成<br>安装完成后通过 <code>docker compose ps</code> 查看 phpipam的几个容器是否都正常启动了。<br><img src="http://image2.ishareread.com/images/2025/20251219/2-docker-compose-ps.png" alt="docker-compose"></p><p>可以通过<code>docker compose logs</code>查看日志</p><h1 id="三、初始化phpIPAM"><a href="#三、初始化phpIPAM" class="headerlink" title="三、初始化phpIPAM"></a>三、初始化phpIPAM</h1><p>因为在docker-compose.yml文件中映射的宿主机的端口是8488<br>在浏览器中输入 http://服务器IP：8488/<br>1.选择新的phpipam安装<br><img src="http://image2.ishareread.com/images/2025/20251219/3-%E6%96%B0%E7%9A%84phpipam%E5%AE%89%E8%A3%85.png" alt="新的phpipam安装"></p><p>2.安装pfpipam数据库<br><img src="http://image2.ishareread.com/images/2025/20251219/4-%E8%87%AA%E5%8A%A8%E5%AE%89%E8%A3%85%E6%95%B0%E6%8D%AE%E5%BA%93.png" alt="安装pfpipam数据库"></p><p>3.设置数据库<br><img src="http://image2.ishareread.com/images/2025/20251219/5-root%E6%95%B0%E6%8D%AE%E5%BA%93%E8%B4%A6%E5%8F%B7%E5%AF%86%E7%A0%81.png" alt="设置数据库"></p><p>4.提示数据库安装成功<br><img src="http://image2.ishareread.com/images/2025/20251219/6-%E6%95%B0%E6%8D%AE%E5%BA%93%E5%AE%89%E8%A3%85%E6%88%90%E5%8A%9F.png" alt="数据库安装成功"></p><p>5.设置管理员密码<br><img src="http://image2.ishareread.com/images/2025/20251219/7-%E8%AE%BE%E7%BD%AEAdmin%E5%AF%86%E7%A0%81.png" alt="设置管理员密码"></p><p>6.用前面设置的管理员密码进行登录<br><img src="http://image2.ishareread.com/images/2025/20251219/8-%E7%94%A8%E6%88%B7%E5%90%8D%E5%AF%86%E7%A0%81%E7%99%BB%E5%BD%95.png" alt="用户名密码登录"></p><p>7.可以在用户的账户详情中选择语言为“Chinese(zh_CN.UTF-8)”切换成中文<br><img src="http://image2.ishareread.com/images/2025/20251219/9-%E5%88%87%E6%8D%A2%E6%88%90%E4%B8%AD%E6%96%87.png" alt="设置成中文"></p><h1 id="四、使用phpIPAM"><a href="#四、使用phpIPAM" class="headerlink" title="四、使用phpIPAM"></a>四、使用phpIPAM</h1><p>典型的IP管理流程如下：<br><img src="http://image2.ishareread.com/images/2025/20251219/10-phpIPAM%E7%AE%A1%E7%90%86%E6%B5%81%E7%A8%8B.png" alt="IP管理流程"></p><p>1.添加子网<img src="http://image2.ishareread.com/images/2025/20251219/11-%E6%B7%BB%E5%8A%A0%E5%AD%90%E7%BD%91.png" alt="添加子网"></p><p>2.添加子网信息，注意可以将Check hosts status、Discover new hosts、Resolve DNS name都打开。<br><img src="http://image2.ishareread.com/images/2025/20251219/12-%E7%BC%96%E8%BE%91%E5%AD%90%E7%BD%91.png" alt="添加子网信息"></p><p>3.在子网管理界面点击“Scan subnet for new hosts” 扫描子网的主机<br><img src="http://image2.ishareread.com/images/2025/20251219/13-%E7%82%B9%E5%87%BB%E6%89%AB%E6%8F%8F%E5%AD%90%E7%BD%91%E7%9A%84%E4%B8%BB%E6%9C%BA.png" alt="扫描子网"></p><p>4.点击“Scan subnet”<br>phpIPAM就会通过Ping scan的方式探测子网内存活的主机<br><img src="http://image2.ishareread.com/images/2025/20251219/14-%E5%AD%90%E7%BD%91%E6%89%AB%E6%8F%8F.png" alt="扫描子网"></p><p>在子网的管理界面就可以看到子网内存活的IP和空闲的IP<br><img src="http://image2.ishareread.com/images/2025/20251219/15-phpipam%E7%AE%A1%E7%90%86%E7%95%8C%E9%9D%A2.png" alt="子网管理界面"></p><p>IP列表<br><img src="http://image2.ishareread.com/images/2025/20251219/16-IP%E5%88%97%E8%A1%A8.png" alt="IP列表"></p><p>子网的可视化界面，可以很直观的看到子网内在用的IP和空闲的IP<br><img src="http://image2.ishareread.com/images/2025/20251219/17-%E5%AD%90%E7%BD%91%E5%8F%AF%E8%A7%86%E5%8C%96%E6%98%BE%E7%A4%BA.png" alt="子网可视化界面"></p><p>总的来说，phpIPAM安装简单使用方便，是个不错的IP管理工具。phpIPAM 本质上是一个 “网络的 CMDB”，让无形的 IP 地址变得可视、可控、可管理。对于任何有一定规模网络环境，它都是提升管理效率和规范性的重要工具。</p><hr><p>作者博客：<a href="http://xiejava.ishareread.com/">http://xiejava.ishareread.com/</a></p><center> <br><p><img src="http://image2.ishareread.com/images/fullbug%E5%BE%AE%E4%BF%A1%E5%85%AC%E4%BC%97%E5%8F%B7.jpg" alt="“fullbug”微信公众号" title="“fullbug”微信公众号"> </p><p>关注：微信公众号,一起学习成长！</center></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;通常，网络或系统管理员会使用一个电子表格来记录IP地址的分配信息，然而，随着网络中的设备越来越多依赖于电子表格并不方便，十分容易出错，想管理好这些加入网络中的设备，就得有个更方便的工具。就我家里的网络而言，接入的设备就已经接近40个了，亟需找这么一个工具来记录和管理这些IP
      
    
    </summary>
    
    
      <category term="技术" scheme="http://xiejava.ishareread.com/categories/%E6%8A%80%E6%9C%AF/"/>
    
      <category term="运维" scheme="http://xiejava.ishareread.com/categories/%E6%8A%80%E6%9C%AF/%E8%BF%90%E7%BB%B4/"/>
    
    
      <category term="网络安全" scheme="http://xiejava.ishareread.com/tags/%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8/"/>
    
      <category term="运维" scheme="http://xiejava.ishareread.com/tags/%E8%BF%90%E7%BB%B4/"/>
    
  </entry>
  
  <entry>
    <title>5分钟，我搭了一套AI知识库</title>
    <link href="http://xiejava.ishareread.com/posts/91eaa3b2/"/>
    <id>http://xiejava.ishareread.com/posts/91eaa3b2/</id>
    <published>2025-12-09T12:00:42.000Z</published>
    <updated>2025-12-10T07:13:21.037Z</updated>
    
    <content type="html"><![CDATA[<p>一直以来都想把我的文档都集中起来建一套知识库，方便统一的搜索查询和调用。我用过很多的文档编写管理工具有在线的、离线的，包括有有道云笔记、语雀、飞书、Notion、Obsidian等。这些工具编写管理文档还可以但是要做为一个知识库还远远不够。我认为知识库不但要解决“知识存哪里” 的问题，更要解决 “知识怎么用” 的痛点，能够将多源的知识内容进行聚合，方便检索查询和使用。</p><p>我需要的知识库系统能够具备以下能力：</p><ul><li>多源内容聚合的能力：能够将我的博客网站、飞书、语雀、离线的文档等都能导入到知识库中。</li><li>方便快捷的搜索能力：AI辅助搜索，能够随时快速找到我想要的东西，AI辅助问答，能够基于已有的知识快速给出比较靠谱的答案。</li><li>便捷强大的编辑能力：能够通过富文本、Markdown随时记录文本，通过AI来辅助创作。</li></ul><p>几番比较找到了PandaWiki，这款开源AI大模型驱动的知识库搭建系统，我觉得满足了目前我对知识库的要求，其安装方便、使用便捷、免费开源，零成本就能拥有自己的AI知识库，目前在github上斩获了8.4K的Star说明了受欢迎的程度。</p><h1 id="一、什么是PandaWiki"><a href="#一、什么是PandaWiki" class="headerlink" title="一、什么是PandaWiki"></a>一、什么是PandaWiki</h1><p>PandaWiki 是一款 AI 大模型驱动的开源知识库搭建系统，帮助你快速构建智能化的 产品文档、技术文档、FAQ、博客系统，借助大模型的力量为你提供 AI 创作、AI 问答、AI 搜索等能力，具备富文本编辑、第三方集成和内容导入能力，采用AGPL-3.0开源协议。</p><p>它的核心价值在于将 AI 能力与知识库深度融合，不仅解决了 “知识存哪里” 的问题，更攻克了 “知识怎么用” 的痛点。<br><img src="http://image2.ishareread.com/images/2025/20251209/1-PandaWiki.png" alt="PandaWiki"><br>PandaWiki 的功能设计围绕 “智能化” 与 “便捷性” 展开，核心可概括为三大 AI 功能与五大实用特性，覆盖知识库从搭建到使用的全场景需求：</p><table><thead><tr><th>类别</th><th>具体功能</th><th>价值说明</th></tr></thead><tbody><tr><td>AI 核心功能</td><td>AI 创作</td><td>辅助生成、优化文档内容，降低内容生产门槛，提升写作效率</td></tr><tr><td></td><td>AI 问答</td><td>支持用户以自然语言提问，AI 基于知识库内容精准作答，而非返回杂乱链接</td></tr><tr><td></td><td>AI 搜索</td><td>依托 AI 大模型实现语义化搜索，精准匹配用户需求，解决传统关键词搜索的局限性</td></tr><tr><td>实用特性</td><td>富文本编辑</td><td>支持 Markdown 与 HTML 语法，满足不同用户编辑习惯；文档可导出为 Word、PDF、Markdown 格式</td></tr><tr><td></td><td>多渠道内容导入</td><td>支持通过飞书文档、Notion、URL、Sitemap、RSS 及离线文件导入内容，省去重复复制粘贴操作</td></tr><tr><td></td><td>第三方平台集成</td><td>可接入钉钉、飞书、企业微信、Discord 等平台的聊天机器人，实现 “随处查知识”</td></tr><tr><td></td><td>高度自定义</td><td>支持配置 Wiki 网站配色、背景图、水印、页脚（企业名称、ICP 备案、品牌 Logo 等），打造专属风格</td></tr><tr><td></td><td>数据统计与反馈</td><td>管理后台可实时查看 Wiki 网站的访问次数、用户分布、问答记录及反馈信息，便于优化内容</td></tr></tbody></table><p>PandaWiki 的最大优势之一是 “低门槛”—— 无需复杂代码开发，提供了一键部署安装脚本，全程耗时不超过 5 分钟，即使是非技术人员也能轻松上手。</p><h1 id="二、PandaWiki的安装部署"><a href="#二、PandaWiki的安装部署" class="headerlink" title="二、PandaWiki的安装部署"></a>二、PandaWiki的安装部署</h1><h2 id="1、部署前的准备"><a href="#1、部署前的准备" class="headerlink" title="1、部署前的准备"></a>1、部署前的准备</h2><p>PandaWiki的官方文档见 <a href="https://pandawiki.docs.baizhi.cloud/node/01971602-bb4e-7c90-99df-6d3c38cfd6d5" target="_blank" rel="noopener">https://pandawiki.docs.baizhi.cloud/node/01971602-bb4e-7c90-99df-6d3c38cfd6d5</a></p><p>PandaWiki安装需Linux系统、x86_64架构，依赖Docker 20.10.14+和Docker Compose 2.0.0+，推荐1核2G内存10G磁盘。<br>安装 PandaWiki 系统环境要求如下：</p><ul><li>操作系统：Linux</li><li>CPU 指令架构：x86_64、aarch64</li><li>软件依赖：Docker 20.10.14 版本以上</li><li>软件依赖：Docker Compose 2.0.0 版本以上</li><li>推荐配置：2 核 CPU / 4 GB 内存 / 20 GB 磁盘</li><li>最低配置：1 核 CPU / 2 GB 内存 / 5 GB 磁盘</li></ul><p>我的配置是ubuntu系统2核CPU/4GB内存/100GB磁盘。</p><h2 id="2、安装PandaWiki"><a href="#2、安装PandaWiki" class="headerlink" title="2、安装PandaWiki"></a>2、安装PandaWiki</h2><p>官方提供了一键自动安装命令，可以非常便捷无脑的就把系统给装上。<br>使用 root 权限登录你的服务器，然后执行以下命令。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bash -c <span class="string">"<span class="variable">$(curl -fsSLk https://release.baizhi.cloud/panda-wiki/manager.sh)</span>"</span></span><br></pre></td></tr></table></figure><p><img src="http://image2.ishareread.com/images/2025/20251209/2-%E5%AE%89%E8%A3%85%E7%95%8C%E9%9D%A2.png" alt="安装界面"><br>选择“安装”，回车<br><img src="http://image2.ishareread.com/images/2025/20251209/3-%E5%AE%89%E8%A3%85docker.png" alt="安装"><br>系统检测到没有安装docker，输入“y”,系统自动安装docker<br><img src="http://image2.ishareread.com/images/2025/20251209/4-%E8%BE%93%E5%85%A5%E5%AE%89%E8%A3%85%E7%9B%AE%E5%BD%95.png" alt="自动安装docker"></p><p>默认安装路径位于 <code>/data/pandawiki</code><br>到显示所有容器安装完成并启动就会显示如下信息</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">SUCCESS  控制台信息:</span><br><span class="line">SUCCESS    访问地址(内网): https://*.*.*.*:2443</span><br><span class="line">SUCCESS    访问地址(外网): https://*.*.*.*:2443</span><br><span class="line">SUCCESS    用户名: admin</span><br><span class="line">SUCCESS    密码: **********************</span><br></pre></td></tr></table></figure><p>修改默认密码</p><blockquote><p>如果需要修改admin的密码可以修改安装目录下.env文件中的 ADMIN_PASSWORD 后，执行</p><p><code>bash docker compose up -d</code></p><p>即可生效。</p></blockquote><p>使用浏览器打开上述内容中的 “访问地址”，就可以看到 PandaWiki 的控制台登录入口。</p><p><img src="http://image2.ishareread.com/images/2025/20251209/5-PandaWiki%E7%99%BB%E5%BD%95%E7%95%8C%E9%9D%A2.png" alt="Panda登录地址"></p><h1 id="三、PandaWiki的使用"><a href="#三、PandaWiki的使用" class="headerlink" title="三、PandaWiki的使用"></a>三、PandaWiki的使用</h1><h2 id="1、配置-AI-大模型"><a href="#1、配置-AI-大模型" class="headerlink" title="1、配置 AI 大模型"></a>1、配置 AI 大模型</h2><p>由于 PandaWiki 的 AI 功能（创作、问答、搜索）均依赖 AI 大模型，首次使用需先完成模型配置，否则相关功能无法正常使用。其支持的模型类型及推荐方案如下：</p><ul><li>Chat 模型：用于对话与内容生成，如 ChatGPT-4、Deepseek-r1、Deepseek-v3 等</li><li>Embedding 模型：将文档转化为向量，支撑智能搜索与内容关联，如 BGE-M3</li><li>Reranker 模型：对搜索结果二次排序，提升检索精准度，如 BGE-Reranker-V2-M3</li></ul><p>我这里直接使用PandaWiki默认的模型“自动配置”。自动配置需要点击“获取百智云API Key”来获取API Key，注册登录百智云就可以获取5元的免费额度。当然通过手动配置用其他的模型API也可以。<br><img src="http://image2.ishareread.com/images/2025/20251209/6-%E9%85%8D%E7%BD%AE%E5%A4%A7%E6%A8%A1%E5%9E%8B%E7%95%8C%E9%9D%A2.png" alt="配置大模型"></p><h2 id="2、启用创建门户网站"><a href="#2、启用创建门户网站" class="headerlink" title="2、启用创建门户网站"></a>2、启用创建门户网站</h2><p>启用创建门户网站PandaWiki会自动帮创建一个门户网站，可以自定义门户网站的模板，“启用HTTP”输入暴露的端口80就可以开启门户网站，注意不要和2443端口重了，2443是后台admin的管理服务。<br><img src="http://image2.ishareread.com/images/2025/20251209/7-%E5%88%9B%E5%BB%BA%E9%97%A8%E6%88%B7%E7%BD%91%E7%AB%99.png" alt="创建门户网站"></p><p>通过简单的配置就可以生成一个wiki网站，如果有域名就可以通过域名访问了，没有域名就通过IP访问。<br>我这里配了域名，可以通过wiki.xiejava.dpdns.org访问。<br><img src="http://image2.ishareread.com/images/2025/20251209/8-%E8%AE%BF%E9%97%AE%E9%97%A8%E6%88%B7%E7%BD%91%E7%AB%99.png" alt="wiki门户网站"></p><h2 id="3、导入文档到PandaWiki创建知识库"><a href="#3、导入文档到PandaWiki创建知识库" class="headerlink" title="3、导入文档到PandaWiki创建知识库"></a>3、导入文档到PandaWiki创建知识库</h2><p>PandaWiki 支持从第三方文档中导入文档，目前支持以下几种方式</p><ul><li>通过离线文件导入</li><li>通过 URL 导入</li><li>通过 RSS 导入</li><li>通过 Sitemap 导入</li><li>通过 Notion 导入</li><li>通过 Epub 导入</li><li>通过 MiniDoc 导入</li><li>通过 Wiki.js 导入</li><li>通过 Confluence 导入</li><li>通过飞书文档导入</li><li>通过语雀导入</li><li>通过思源笔记导入</li></ul><p>官方都有详细的说明文档<br>我这里将我的博客文档通过离线方式进行导入。<br><img src="http://image2.ishareread.com/images/2025/20251209/9-%E9%80%89%E6%8B%A9%E5%AF%BC%E5%85%A5%E7%A6%BB%E7%BA%BF%E6%96%87%E4%BB%B6.png" alt="离线导入文件"></p><p>在离线文件导入界面选择要导入的文件，支持的格式包括<code>.txt、.md、.xlx、.xlsx、.docx、.pdf</code> 。<br>注意：每个文件的大小不能超过 20 MB。<br><img src="http://image2.ishareread.com/images/2025/20251209/10-%E5%AF%BC%E5%85%A5%E7%A6%BB%E7%BA%BF%E6%96%87%E4%BB%B6%E7%95%8C%E9%9D%A2.png" alt="导入文件"></p><p>选择要导入的文件后，会对.md文件自动进行解析。<br><img src="http://image2.ishareread.com/images/2025/20251209/11-%E5%AF%BC%E5%85%A5%E7%A6%BB%E7%BA%BF%E6%96%87%E4%BB%B6.png" alt="解析文件"></p><p>解析完了点击“批量导入”，就可以将文件导入到知识库，并且展示的是解析后的富文本形式。<br><img src="http://image2.ishareread.com/images/2025/20251209/12-%E6%89%B9%E9%87%8F%E5%AF%BC%E5%85%A5%E6%96%87%E4%BB%B6.png" alt="批量导入"></p><p>批量导入处理中<br><img src="http://image2.ishareread.com/images/2025/20251209/13-%E6%89%B9%E9%87%8F%E5%AF%BC%E5%85%A5%E4%B8%AD.png" alt="批量导入中"></p><p>新导入的文件虽然是可以被可见、被访问、被问答，但是还没有进行增强学习处理需要进一步的学习<br><img src="http://image2.ishareread.com/images/2025/20251209/14-%E5%AD%A6%E4%B9%A0%E6%96%87%E4%BB%B6.png" alt="发布和学习"></p><p>PandaWiki的文档处理状态如下图：<br><img src="http://image2.ishareread.com/images/2025/20251209/15-%E6%96%87%E6%A1%A3%E5%A4%84%E7%90%86%E7%8A%B6%E6%80%81.png" alt="文档处理状态"></p><p>选择需要学习的文档点“确认”进行学习<br><img src="http://image2.ishareread.com/images/2025/20251209/16-%E7%A1%AE%E8%AE%A4%E5%AD%A6%E4%B9%A0.png" alt="学习和发布"></p><p>当学习和发布完成后，可以在web门户网站进行AI检索和AI问答了。<br><img src="http://image2.ishareread.com/images/2025/20251209/17-%E5%90%91AI%E6%8F%90%E9%97%AE.png" alt="AI问答"></p><p><img src="http://image2.ishareread.com/images/2025/20251209/18-AI%E6%A3%80%E7%B4%A2%E7%9F%A5%E8%AF%86%E5%BA%93.png" alt="AI问答"></p><p>我们可以将pandawiki直接当一个博客网站来使用，它对markdown的解析和展示还挺好的。<br><img src="http://image2.ishareread.com/images/2025/20251209/19-AI-Wiki.png" alt="pandawiki博客站点"></p><p>欢迎访问我的wiki站点 <a href="https://wiki.xiejava.dpdns.org" target="_blank" rel="noopener">https://wiki.xiejava.dpdns.org</a> 在这里我将和你一起分享IT技术，感受AI带来的便捷。</p><hr><p>作者博客：<a href="http://xiejava.ishareread.com/">http://xiejava.ishareread.com/</a></p><center> <br><p><img src="http://image2.ishareread.com/images/fullbug%E5%BE%AE%E4%BF%A1%E5%85%AC%E4%BC%97%E5%8F%B7.jpg" alt="“fullbug”微信公众号" title="“fullbug”微信公众号"> </p><p>关注：微信公众号,一起学习成长！</center></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;一直以来都想把我的文档都集中起来建一套知识库，方便统一的搜索查询和调用。我用过很多的文档编写管理工具有在线的、离线的，包括有有道云笔记、语雀、飞书、Notion、Obsidian等。这些工具编写管理文档还可以但是要做为一个知识库还远远不够。我认为知识库不但要解决“知识存哪里
      
    
    </summary>
    
    
      <category term="技术" scheme="http://xiejava.ishareread.com/categories/%E6%8A%80%E6%9C%AF/"/>
    
      <category term="AI" scheme="http://xiejava.ishareread.com/categories/%E6%8A%80%E6%9C%AF/AI/"/>
    
    
      <category term="AI机器学习" scheme="http://xiejava.ishareread.com/tags/AI%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/"/>
    
      <category term="产品体验" scheme="http://xiejava.ishareread.com/tags/%E4%BA%A7%E5%93%81%E4%BD%93%E9%AA%8C/"/>
    
  </entry>
  
  <entry>
    <title>企业级私有docker镜像仓库Harbor的搭建和使用</title>
    <link href="http://xiejava.ishareread.com/posts/3ea90a75/"/>
    <id>http://xiejava.ishareread.com/posts/3ea90a75/</id>
    <published>2025-12-04T03:22:22.000Z</published>
    <updated>2025-12-10T07:13:20.990Z</updated>
    
    <content type="html"><![CDATA[<h1 id="一、什么是Harbor"><a href="#一、什么是Harbor" class="headerlink" title="一、什么是Harbor"></a>一、什么是Harbor</h1><p>简单来说，Harbor 是一个开源的企业级私有 Docker 镜像仓库服务。我们可以把它理解成一个 “私有的、安全的、功能强大的 Docker Hub”。</p><ul><li>私有： 它部署在你自己的基础设施（如公司的数据中心或私有云）上，你完全掌控其中的所有镜像，不对外公开。</li><li>企业级： 这意味着它不仅仅是一个简单的存储服务器。它提供了企业所需的高级功能，如权限控制、安全扫描、镜像复制、图形化操作界面等。</li><li>镜像仓库： 它是专门用来存储、管理和分发 Docker 镜像的地方。你可以向 Harbor 中推送（上传）镜像，也可以从 Harbor 中拉取（下载）镜像。</li></ul><p>目前国内的上网环境公共的Docker Hub不能直接访问了，对于公司和个人开发者来说有必要搭建私有的Docker镜像仓库，使用 Harbor 几乎是必须的。公司自己开发的应用程序镜像可能包含敏感代码和配置，绝不能放到公共仓库。Harbor 提供了一个安全的私有环境来存放这些资产。Harbor 可以配置为 Docker Hub、Google Container Registry（GCR）等公有仓库的代理缓存。当公司内第一个开发者拉取某个公有镜像（如 nginx:latest）时，Harbor 会从公网下载并缓存到本地。后续所有开发者再拉取这个镜像时，都会直接从内网的 Harbor 服务器高速获取，极大地节省了公网带宽，加快了拉取速度。</p><p>Harbor 将一个简单的镜像存储服务，升级为一个安全、高效、可靠的企业级镜像生命周期管理平台，是现代云原生应用开发和运维不可或缺的基础设施组件。</p><p>本文介绍如何通过Harbor搭建和使用自己的私有镜像仓库。</p><h1 id="二、安装Harbor"><a href="#二、安装Harbor" class="headerlink" title="二、安装Harbor"></a>二、安装Harbor</h1><p>准备一台linux的服务器，我这里是ubuntu 24.04  IP地址是192.168.0.49<br>Harbor的docker安装要求<br>On a Linux host: docker 20.10.10-ce+ and docker-compose 1.18.0+ .</p><h2 id="1、安装docker"><a href="#1、安装docker" class="headerlink" title="1、安装docker"></a>1、安装docker</h2><p>执行以下命令一键安装docker </p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo curl -fsSL https://get.docker.com | bash -s docker --mirror Aliyun</span><br><span class="line">service docker start</span><br></pre></td></tr></table></figure><p>配置国内镜像加速</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/docker/daemon.json</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="string">"registry-mirrors"</span>: [</span><br><span class="line">        <span class="string">"https://docker.1ms.run"</span></span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">service docker restart</span><br></pre></td></tr></table></figure><h2 id="2、安装Harbor"><a href="#2、安装Harbor" class="headerlink" title="2、安装Harbor"></a>2、安装Harbor</h2><p>下载harbor安装包，下载地址如下：<br><a href="https://github.com/goharbor/harbor/releases/download/v2.14.1/harbor-offline-installer-v2.14.1.tgz" target="_blank" rel="noopener">https://github.com/goharbor/harbor/releases/download/v2.14.1/harbor-offline-installer-v2.14.1.tgz</a><br>将下载的harbor安装包上传到安装harbor的目标服务器的目录下<br>如/home/app/harbor<br>解压上传的harbor安装包</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tar -zxvf harbor-offline-installer-v2.14.1.tgz</span><br></pre></td></tr></table></figure><p>备份配置文件</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cp harbor.yml.tmpl harbor.yml</span><br></pre></td></tr></table></figure><p>修改配置文件</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim harbor.yml</span><br></pre></td></tr></table></figure><p><img src="http://image2.ishareread.com/images/2025/20251204/1-%E4%BF%AE%E6%94%B9harbor%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6.png" alt="修改harbor.yml配置文件"></p><p> 执行安装脚本</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./install.sh</span><br></pre></td></tr></table></figure><p>安装完成后通过浏览器即可以访问harbor的管理界面<br><img src="http://image2.ishareread.com/images/2025/20251204/2-harbor%E7%99%BB%E5%BD%95%E7%95%8C%E9%9D%A2.png" alt="harbor登录界面"></p><p>默认的用户名和密码是<code>admin/Harbor12345</code></p><h1 id="三、使用Harbor"><a href="#三、使用Harbor" class="headerlink" title="三、使用Harbor"></a>三、使用Harbor</h1><h2 id="1、通过Harbor代理拉取镜像"><a href="#1、通过Harbor代理拉取镜像" class="headerlink" title="1、通过Harbor代理拉取镜像"></a>1、通过Harbor代理拉取镜像</h2><p>先在仓库管理中建一个目标，目标是从docker的加速镜像站点去拉取镜像，我这里配置目标URL是<code>https://docker.1ms.run</code>，点击测试链接，提示“测试连接成功”表示目标URL站点没有问题，就可以点击确定。<br><img src="http://image2.ishareread.com/images/2025/20251204/3-harbor%E6%96%B0%E5%BB%BA%E7%9B%AE%E6%A0%87.png" alt="新建目标"></p><p>这样我们就有了一个目标的加速仓库<br><img src="http://image2.ishareread.com/images/2025/20251204/4-%E6%88%90%E5%8A%9F%E5%88%9B%E5%BB%BA%E4%BB%93%E5%BA%93%E7%AE%A1%E7%90%86%E7%9B%AE%E6%A0%87.png" alt="新建目标成功"></p><p>在“项目”中点击“新建项目”，在镜像代理中<strong>开启</strong>“镜像代理”，选择我们开始在仓库管理中新建的目标仓库。<br><img src="http://image2.ishareread.com/images/2025/20251204/5-%E6%96%B0%E5%BB%BA%E9%A1%B9%E7%9B%AE%E5%BC%80%E5%90%AF%E9%95%9C%E5%83%8F%E4%BB%A3%E7%90%86.png" alt="开启镜像代理"></p><p>在配置管理生成软件物料清单中勾选“在推送镜像时自动生成软件物料清单”，这样我们在拉取镜像时harbor会自动帮我们缓存镜像到本地的harbor仓库，下次拉取时速度就非常快了。<br><img src="http://image2.ishareread.com/images/2025/20251204/6-%E5%BC%80%E5%90%AF%E6%8E%A8%E9%80%81%E7%94%9F%E6%88%90%E7%89%A9%E6%96%99%E6%B8%85%E5%8D%95.png" alt="勾选物料清单"></p><p>在另外一台需要拉取镜像的机器上配置docker的镜像仓库，将地址配置为Harbor的地址</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/docker/daemon.json</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="string">"registry-mirrors"</span>: [</span><br><span class="line">        <span class="string">"http://192.168.0.49"</span></span><br><span class="line">    ],</span><br><span class="line">    <span class="string">"insecure-registries"</span>: [<span class="string">"192.168.0.49"</span>]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>重启docker服务</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">service docker restart</span><br></pre></td></tr></table></figure><p>拉取目标镜像，这里要带上harbor中的项目名称，<code>docker1ms/nginx:1.22</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker pull docker1ms/nginx:1.22</span><br></pre></td></tr></table></figure><p><img src="http://image2.ishareread.com/images/2025/20251204/7-docker%E6%8B%89%E5%8F%96%E9%95%9C%E5%83%8F.png" alt="拉取镜像"></p><p>在harbor的管理界面可以看到，通过拉取镜像，harbor通过代理镜像源对镜像进行了拉取并缓存到harbor仓库，下次拉取速度更快了。<br><img src="http://image2.ishareread.com/images/2025/20251204/8-harbor%E6%8B%89%E5%8F%96%E9%95%9C%E5%83%8F%E6%88%90%E5%8A%9F.png" alt="harbor镜像缓存"></p><h2 id="2、上传镜像到Harbor仓库"><a href="#2、上传镜像到Harbor仓库" class="headerlink" title="2、上传镜像到Harbor仓库"></a>2、上传镜像到Harbor仓库</h2><p>另一个在工作中最常用的场景就是将自己的镜像上传到镜像仓库，以便其他人拉取使用。<br>下面就以在本地已经存在的docker1ms/busybox:latest为例，上传到自己的harbor仓库。<br>我的harbor仓库的地址是192.168.0.49,上传到默认的library项目中<br>为镜像打上带仓库地址和项目名的tag</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker tag docker1ms/busybox:latest 192.168.0.49/library/busybox:latest</span><br></pre></td></tr></table></figure><p><img src="http://image2.ishareread.com/images/2025/20251204/9-%E7%BB%99%E9%95%9C%E5%83%8F%E6%89%93%E6%A0%87%E7%AD%BE.png" alt="为镜像打标签"></p><p>客户端登录到harbor</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker login 192.168.0.49</span><br></pre></td></tr></table></figure><p>输入harbor的用户名和口令进行登录<br><img src="http://image2.ishareread.com/images/2025/20251204/10-%E7%99%BB%E5%BD%95%E5%88%B0harbor.png" alt="登录到harbor仓"></p><p>登录成功后，通过push命令上传镜像到本地harbor仓库</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker push 192.168.0.49/library/busybox:latest</span><br></pre></td></tr></table></figure><p><img src="http://image2.ishareread.com/images/2025/20251204/11-push%E9%95%9C%E5%83%8F.png" alt="push镜像"></p><p>到harbor管理界面查看push到仓库中的镜像<br><img src="http://image2.ishareread.com/images/2025/20251204/12-%E6%9F%A5%E7%9C%8Bpush%E7%9A%84%E9%A1%B9%E7%9B%AE.png" alt="push到仓库中的镜像"></p><p>可以看到busybox镜像已经成功push到harbor的library项目中了。<br><img src="http://image2.ishareread.com/images/2025/20251204/13-%E6%9F%A5%E7%9C%8Bpush%E7%9A%84%E9%A1%B9%E7%9B%AE%E7%9A%84%E9%95%9C%E5%83%8F%E4%BB%93%E5%BA%93.png" alt="成功push"></p><p>在Artifacts中可以看到push上来的镜像物料详情，可看到这个busybox镜像的大小是2.1MB<br><img src="http://image2.ishareread.com/images/2025/20251204/14-%E6%9F%A5%E7%9C%8Bpush%E9%95%9C%E5%83%8F%E7%9A%84%E7%89%A9%E6%96%99.png" alt="物料清单"></p><p>我们可以直接拉取harbor中我们刚push上去的镜像<br>可以看到如果是默认仓库library项目直接可以docker pull 镜像名就可以拉取</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker pull busybox:latest</span><br></pre></td></tr></table></figure><p><img src="http://image2.ishareread.com/images/2025/20251204/15-%E7%9B%B4%E6%8E%A5%E6%8B%89%E5%8F%96harbor%E5%BA%93%E4%B8%AD%E7%9A%84%E9%95%9C%E5%83%8F.png" alt="拉取镜像"></p><p>至此，我们通过安装自己私有的镜像仓库Harbor，实现了docker镜像代理下载和上传自己的镜像到Harbor仓库，覆盖了我们平时工作中的大部分场景。</p><hr><p>作者博客：<a href="http://xiejava.ishareread.com/">http://xiejava.ishareread.com/</a></p><center> <br><p><img src="http://image2.ishareread.com/images/fullbug%E5%BE%AE%E4%BF%A1%E5%85%AC%E4%BC%97%E5%8F%B7.jpg" alt="“fullbug”微信公众号" title="“fullbug”微信公众号"> </p><p>关注：微信公众号,一起学习成长！</center></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;一、什么是Harbor&quot;&gt;&lt;a href=&quot;#一、什么是Harbor&quot; class=&quot;headerlink&quot; title=&quot;一、什么是Harbor&quot;&gt;&lt;/a&gt;一、什么是Harbor&lt;/h1&gt;&lt;p&gt;简单来说，Harbor 是一个开源的企业级私有 Docker 镜像仓
      
    
    </summary>
    
    
      <category term="技术" scheme="http://xiejava.ishareread.com/categories/%E6%8A%80%E6%9C%AF/"/>
    
      <category term="架构" scheme="http://xiejava.ishareread.com/categories/%E6%8A%80%E6%9C%AF/%E6%9E%B6%E6%9E%84/"/>
    
    
      <category term="运维" scheme="http://xiejava.ishareread.com/tags/%E8%BF%90%E7%BB%B4/"/>
    
      <category term="架构" scheme="http://xiejava.ishareread.com/tags/%E6%9E%B6%E6%9E%84/"/>
    
  </entry>
  
  <entry>
    <title>开源安全管理平台wazuh-检测SQL注入攻击</title>
    <link href="http://xiejava.ishareread.com/posts/52b3e2de/"/>
    <id>http://xiejava.ishareread.com/posts/52b3e2de/</id>
    <published>2025-10-22T08:33:12.000Z</published>
    <updated>2025-12-10T07:13:20.960Z</updated>
    
    <content type="html"><![CDATA[<p>Wazuh是一个功能强大的开源安全平台，它集成了安全信息与事件管理（SIEM）和扩展检测与响应（XDR）的能力，旨在为本地、虚拟化、容器化及云环境中的工作负载提供统一的威胁预防、检测和响应解决方案。</p><p>SQL 注入是一种攻击，在这种攻击中，威胁行为者将恶意代码插入传输到数据库服务器的字符串中进行解析和执行。成功的 SQL 注入攻击可以未经授权访问数据库中包含的机密信息。</p><p>我们可以使用 Wazuh 从 Web 服务器日志中检测 SQL 注入攻击，这些日志包含 select、union 和其他常见 SQL 注入模式等模式。本文通过POC来验证wazuh检测SQL注入攻击。</p><h1 id="一、环境准备"><a href="#一、环境准备" class="headerlink" title="一、环境准备"></a>一、环境准备</h1><p>POC测试环境拓扑如下图所示：</p><p><img src="http://image2.ishareread.com/images/2025/20251022/1-POC%E6%B5%8B%E8%AF%95%E7%8E%AF%E5%A2%83%E6%8B%93%E6%89%91.png" alt="POC测试环境拓扑"></p><table><thead><tr><th>主机</th><th>说明</th></tr></thead><tbody><tr><td>安全管理平台wazuh-server<br>(192.168.0.40)</td><td>All in one安装wazuh，监控wazuh-agent上报的告警信息进行威胁检测</td></tr><tr><td>DVWA靶机<br>（192.168.0.43）</td><td>被监控主机安装wazuh-agent，安装DVWA靶机，模拟被攻击</td></tr></tbody></table><p>DVWA靶机安装参考《<a href="https://blog.csdn.net/fullbug/article/details/129879670" target="_blank" rel="noopener">CentOS7+LAMP+DVWA靶机搭建</a>》<br>首先安装LAMP环境</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">apt update</span><br><span class="line">apt install -y apache2 mariadb-server mariadb-client php php-mysqli php-gd libapache2-mod-php</span><br></pre></td></tr></table></figure><p>下载DVWA的软件包<br>进入到默认的web发布目录</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /var/www/html</span><br><span class="line">git <span class="built_in">clone</span> https://github.com/digininja/DVWA.git</span><br></pre></td></tr></table></figure><p>将config/config.inc.php.dist复制成config/config.inc.php并配置环境</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cp config.inc.php.dist config.inc.php</span><br></pre></td></tr></table></figure><p>用root用户登录数据库，然后执行以下命令创建dvwa数据库:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; create database dvwa;</span><br><span class="line">Query OK, 1 row affected (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; create user dvwa@localhost identified by <span class="string">'p@ssw0rd'</span>;</span><br><span class="line">Query OK, 0 rows affected (0.01 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; grant all on dvwa.* to dvwa@localhost;</span><br><span class="line">Query OK, 0 rows affected (0.01 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; flush privileges;</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br></pre></td></tr></table></figure><p>默认用户 = <code>admin</code><br>默认密码 = <code>password</code><br>将安全级别设为 Low（最易注入）</p><h1 id="二、wazuh配置"><a href="#二、wazuh配置" class="headerlink" title="二、wazuh配置"></a>二、wazuh配置</h1><p>将以下行添加到 Wazuh 代理 <code>/var/ossec/etc/ossec.conf</code> 文件中。允许 Wazuh-agent 代理监控 Apache 服务器的访问日志：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;ossec_config&gt;</span><br><span class="line">  &lt;localfile&gt;</span><br><span class="line">    &lt;log_format&gt;apache&lt;/log_format&gt;</span><br><span class="line">    &lt;location&gt;/var/<span class="built_in">log</span>/apache2/access.log&lt;/location&gt;</span><br><span class="line">  &lt;/localfile&gt;</span><br><span class="line">&lt;/ossec_config&gt;</span><br></pre></td></tr></table></figure><p>重新启动 Wazuh 代理以使应用配置更改生效：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo systemctl restart wazuh-agent</span><br></pre></td></tr></table></figure><h1 id="三、模拟攻击"><a href="#三、模拟攻击" class="headerlink" title="三、模拟攻击"></a>三、模拟攻击</h1><p>访问DVWA的靶机地址<a href="http://192.168.0.43/DVWA/login.php" target="_blank" rel="noopener">http://192.168.0.43/DVWA/login.php</a><br>默认用户 = admin<br>默认密码 = password<br>登录后找到SQL Injection 输入例如”<code>1&#39; UNION SELECT database(), version()</code>“ 等SQL注入Payload</p><p><img src="http://image2.ishareread.com/images/2025/20251022/2-dvwaSQL%E6%B3%A8%E5%85%A5.png" alt="DVWA-SQL注入"></p><h1 id="四、效果验证"><a href="#四、效果验证" class="headerlink" title="四、效果验证"></a>四、效果验证</h1><p>在wazuh此处的预期结果是规则 ID 为 31164  <code>SQL injection attempt</code> 的告警，但成功的 SQL 注入尝试会生成规则 ID 为 31106  <code>A web attack returned code 200 (success)</code>的告警。</p><p><img src="http://image2.ishareread.com/images/2025/20251022/3-wazuhSQL%E6%B3%A8%E5%85%A5%E5%91%8A%E8%AD%A6.png" alt="sql注入检测"></p><p>我们可以点击详情看到具体的SQL注入攻击日志</p><p><img src="http://image2.ishareread.com/images/2025/20251022/4-wazuhSQL%E6%B3%A8%E5%85%A5%E5%91%8A%E8%AD%A6%E8%AF%A6%E6%83%85.png" alt="SQL注入检测日志详情"></p><p>至此，我们通过POC验证了wazuh检测SQL注入攻击场景。</p><hr><p>作者博客：<a href="http://xiejava.ishareread.com/">http://xiejava.ishareread.com/</a></p><center> <br><p><img src="http://image2.ishareread.com/images/fullbug%E5%BE%AE%E4%BF%A1%E5%85%AC%E4%BC%97%E5%8F%B7.jpg" alt="“fullbug”微信公众号" title="“fullbug”微信公众号"> </p><p>关注：微信公众号,一起学习成长！</center></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;Wazuh是一个功能强大的开源安全平台，它集成了安全信息与事件管理（SIEM）和扩展检测与响应（XDR）的能力，旨在为本地、虚拟化、容器化及云环境中的工作负载提供统一的威胁预防、检测和响应解决方案。&lt;/p&gt;
&lt;p&gt;SQL 注入是一种攻击，在这种攻击中，威胁行为者将恶意代码插
      
    
    </summary>
    
    
      <category term="技术" scheme="http://xiejava.ishareread.com/categories/%E6%8A%80%E6%9C%AF/"/>
    
      <category term="网络安全" scheme="http://xiejava.ishareread.com/categories/%E6%8A%80%E6%9C%AF/%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8/"/>
    
    
      <category term="网络安全" scheme="http://xiejava.ishareread.com/tags/%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8/"/>
    
  </entry>
  
  <entry>
    <title>开源安全管理平台wazuh-非法可疑进程检测</title>
    <link href="http://xiejava.ishareread.com/posts/e0557478/"/>
    <id>http://xiejava.ishareread.com/posts/e0557478/</id>
    <published>2025-10-15T11:50:52.000Z</published>
    <updated>2025-12-10T07:13:20.924Z</updated>
    
    <content type="html"><![CDATA[<p>Wazuh是一个功能强大的开源安全平台，它集成了安全信息与事件管理（SIEM）和扩展检测与响应（XDR）的能力，旨在为本地、虚拟化、容器化及云环境中的工作负载提供统一的威胁预防、检测和响应解决方案。</p><p>Wazuh命令监控功能在端点上运行命令并监控命令的输出。通过监控命令来检测是否有非法可疑进程。</p><p>本文通过POC展示Wazuh如何通过配置来实现对非法可疑进行的检测及时预警威胁攻击行为。</p><h1 id="一、环境准备"><a href="#一、环境准备" class="headerlink" title="一、环境准备"></a>一、环境准备</h1><p>POC测试环境拓扑如下图所示：<br><img src="http://image2.ishareread.com/images/2025/20251015/1-wazuh%E9%9D%9E%E6%B3%95%E5%8F%AF%E7%96%91%E8%BF%9B%E7%A8%8B%E6%A3%80%E6%B5%8B.png" alt="POC测试环境拓扑"></p><table><thead><tr><th>主机</th><th>描述</th></tr></thead><tbody><tr><td>安全管理平台wazuh-server<br>(192.168.0.40)</td><td>All in one安装wazuh，监控wazuh-agent上报的告警信息进行威胁检测</td></tr><tr><td>被监控Kali主机<br>（192.168.0.65）</td><td>被监控kali主机安装wazuh-agent，运行非法可疑进程。</td></tr></tbody></table><h1 id="二、wazuh配置"><a href="#二、wazuh配置" class="headerlink" title="二、wazuh配置"></a>二、wazuh配置</h1><h2 id="1、kali检测端点配置"><a href="#1、kali检测端点配置" class="headerlink" title="1、kali检测端点配置"></a>1、kali检测端点配置</h2><p>1）按照以下步骤配置命令监控并查询被监控kali主机端点上的所有运行进程。<br>将以下配置块添加到wazuh-agent的<code>/var/ossec/etc/ossec.conf</code>文件，允许wazuh-agent定期获取运行进程列表：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">ossec_config</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">localfile</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">log_format</span>&gt;</span>full_command<span class="tag">&lt;/<span class="name">log_format</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">alias</span>&gt;</span>process list<span class="tag">&lt;/<span class="name">alias</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">command</span>&gt;</span>ps -e -o pid,uname,command<span class="tag">&lt;/<span class="name">command</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">frequency</span>&gt;</span>30<span class="tag">&lt;/<span class="name">frequency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">localfile</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">ossec_config</span>&gt;</span></span><br></pre></td></tr></table></figure><p>这段配置告诉 Wazuh 代理：</p><ol><li>做什么：​ 每 30 秒执行一次命令 <code>ps -e -o pid,uname,command</code>。</li><li>捕获什么：​ 捕获该命令的完整输出。</li><li>如何标记：​ 在输出的每一行前面添加一个标准化的头部 <code>ossec: output: &#39;process list: &#39;</code>。</li><li>发送给谁：​ 将处理后的日志行（即带有前缀的进程列表）发送给配置的 Wazuh 服务器。</li></ol><p>这个配置让 Wazuh 代理定期（每 30 秒）抓取一次完整的系统进程快照，并格式化后发送给服务器，为基于进程行为的入侵检测提供基础数据。</p><p>2）重新启动Wazuh代理以使配置生效：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo systemctl restart wazuh-agent</span><br></pre></td></tr></table></figure><p>3）在kali上安装Netcat等工具：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt install ncat nmap -y</span><br></pre></td></tr></table></figure><h2 id="2、wazuh-server配置"><a href="#2、wazuh-server配置" class="headerlink" title="2、wazuh server配置"></a>2、wazuh server配置</h2><p>1）将以下规则添加到Wazuh服务器上的 /var/ossec/etc/rules/local_rules.xml 文件中：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">group</span> <span class="attr">name</span>=<span class="string">"ossec,"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">rule</span> <span class="attr">id</span>=<span class="string">"100050"</span> <span class="attr">level</span>=<span class="string">"0"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">if_sid</span>&gt;</span>530<span class="tag">&lt;/<span class="name">if_sid</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">match</span>&gt;</span>^ossec: output: 'process list'<span class="tag">&lt;/<span class="name">match</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">description</span>&gt;</span>List of running processes.<span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">group</span>&gt;</span>process_monitor,<span class="tag">&lt;/<span class="name">group</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">rule</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">rule</span> <span class="attr">id</span>=<span class="string">"100051"</span> <span class="attr">level</span>=<span class="string">"7"</span> <span class="attr">ignore</span>=<span class="string">"900"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">if_sid</span>&gt;</span>100050<span class="tag">&lt;/<span class="name">if_sid</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">match</span>&gt;</span>nc -l<span class="tag">&lt;/<span class="name">match</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">description</span>&gt;</span>netcat listening for incoming connections.<span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">group</span>&gt;</span>process_monitor,<span class="tag">&lt;/<span class="name">group</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">rule</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">group</span>&gt;</span></span><br></pre></td></tr></table></figure><p>这个配置片段定义了一个监控逻辑，专门用于在系统进程列表中检测监听模式的 netcat(<code>nc -l</code>)，一旦发现就产生高优先级告警。规则 100050 负责捕获进程列表数据，规则 100051 负责在其中搜索特定的威胁指标 (<code>nc -l</code>)。</p><p>2）重新启动Wazuh管理器以使配置生效：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo systemctl restart wazuh-manager</span><br></pre></td></tr></table></figure><h1 id="三、模拟攻击"><a href="#三、模拟攻击" class="headerlink" title="三、模拟攻击"></a>三、模拟攻击</h1><p>在被监控的Kali主机（192.168.0.65）端点上，运行<code>nc -l 8000</code> 30秒。</p><p>netcat​（网络工具中的“瑞士军刀”）的命令，它的核心作用是：​在你的计算机上启动一个临时的 TCP 服务端，监听端口 8000，等待其他计算机连接并与之通信。</p><p>监听模式的 netcat常被用作后门、端口监听器或进行未经授权的文件传输，是攻击者建立持久访问或进行横向移动的常见工具。</p><h1 id="四、效果验证"><a href="#四、效果验证" class="headerlink" title="四、效果验证"></a>四、效果验证</h1><p>我们可以在Wazuh威胁狩猎模块仪表板中可看到检测到kali主机上有netcat 进行正在监听的告警并可视化展示出来。<br><img src="http://image2.ishareread.com/images/2025/20251015/2-%E9%9D%9E%E6%B3%95%E5%8F%AF%E7%96%91%E8%BF%9B%E7%A8%8B%E6%A3%80%E6%B5%8B%E5%91%8A%E8%AD%A6.png" alt="非法可疑进程检测告警"></p><p>我们点开告警详情可以看到日志中显示通过<code>ps -e -o pid,uname,command</code>，检测到有<code>nc -l 8000</code>的非法进程在运行，进行了<code>netcat listening for incoming connections.</code>告警输出。<br><img src="http://image2.ishareread.com/images/2025/20251015/3-%E9%9D%9E%E6%B3%95%E5%8F%AF%E7%96%91%E8%BF%9B%E7%A8%8B%E6%A3%80%E6%B5%8B%E5%91%8A%E8%AD%A6%E8%AF%A6%E6%83%85.png" alt="非法可疑进程检测告警详情"></p><p>至此，我们通过一个完整的POC实例验证了wuzuh对非法可疑进程的检测，能够有效发现潜在的威胁。</p><hr><p>作者博客：<a href="http://xiejava.ishareread.com/">http://xiejava.ishareread.com/</a></p><center> <br><p><img src="http://image2.ishareread.com/images/fullbug%E5%BE%AE%E4%BF%A1%E5%85%AC%E4%BC%97%E5%8F%B7.jpg" alt="“fullbug”微信公众号" title="“fullbug”微信公众号"> </p><p>关注：微信公众号,一起学习成长！</center></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;Wazuh是一个功能强大的开源安全平台，它集成了安全信息与事件管理（SIEM）和扩展检测与响应（XDR）的能力，旨在为本地、虚拟化、容器化及云环境中的工作负载提供统一的威胁预防、检测和响应解决方案。&lt;/p&gt;
&lt;p&gt;Wazuh命令监控功能在端点上运行命令并监控命令的输出。通过
      
    
    </summary>
    
    
      <category term="技术" scheme="http://xiejava.ishareread.com/categories/%E6%8A%80%E6%9C%AF/"/>
    
      <category term="网络安全" scheme="http://xiejava.ishareread.com/categories/%E6%8A%80%E6%9C%AF/%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8/"/>
    
    
      <category term="网络安全" scheme="http://xiejava.ishareread.com/tags/%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8/"/>
    
  </entry>
  
  <entry>
    <title>开源安全管理平台wazuh-与网络入侵检测系统集成增强威胁检测能力</title>
    <link href="http://xiejava.ishareread.com/posts/b9af79aa/"/>
    <id>http://xiejava.ishareread.com/posts/b9af79aa/</id>
    <published>2025-10-12T08:19:42.000Z</published>
    <updated>2025-12-10T07:13:20.889Z</updated>
    
    <content type="html"><![CDATA[<p>Wazuh是一个功能强大的开源安全平台，它集成了安全信息与事件管理（SIEM）和扩展检测与响应（XDR）的能力，旨在为本地、虚拟化、容器化及云环境中的工作负载提供统一的威胁预防、检测和响应解决方案。</p><p>Wazuh可以与基于网络的入侵检测系统（NIDS）集成，通过监控和分析网络流量来增强威胁检测。Suricata 是一个开源的高性能网络安全监控工具，由开放信息安全基金会（OISF）开发维护。它被广泛用于实时网络流量分析、威胁检测和防护。Suricata 是现代网络安全架构中的重要组件，特别适合需要高性能实时流量分析的场景，是构建深度防御体系的关键工具。</p><p>本文通过POC展示如何将Suricata与Wazuh集成，并模拟对目标主机进行端口扫描，通过Suricata监控和分析网络流量进行威胁检测与Wazuh集成后在Wazuh的威胁狩猎中及时预警威胁攻击行为。</p><h1 id="一、环境准备"><a href="#一、环境准备" class="headerlink" title="一、环境准备"></a>一、环境准备</h1><p>POC环境拓扑如下图所示：<br><img src="http://image2.ishareread.com/images/2025/20251012/1-POC%E6%8B%93%E6%89%91%E5%9B%BE.png" alt="POC环境拓扑图"></p><table><thead><tr><th>主机</th><th>描述</th></tr></thead><tbody><tr><td>安全管理平台wazuh-server<br>(192.168.0.40)</td><td>All in one安装wazuh，监控wazuh-agent、suricata上报的告警信息进行威胁检测</td></tr><tr><td>ubuntu应用服务器<br>（192.168.0.30）</td><td>ubuntu应用服务器安装wazuh-agent并与Suricata集成 ,模拟被攻击的服务器</td></tr><tr><td>Kali Linux模拟攻击机器<br>（192.168.0.65）</td><td>Kali linux ,模拟攻击机器，模拟发起恶意端口扫描攻击</td></tr></tbody></table><h1 id="二、安装Suricata"><a href="#二、安装Suricata" class="headerlink" title="二、安装Suricata"></a>二、安装Suricata</h1><h2 id="1、安装Suricata"><a href="#1、安装Suricata" class="headerlink" title="1、安装Suricata"></a>1、安装Suricata</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo add-apt-repository ppa:oisf/suricata-stable</span><br><span class="line">sudo apt-get update</span><br><span class="line">sudo apt-get install suricata -y</span><br></pre></td></tr></table></figure><h2 id="2、下载Suricata的扩展检测规则集"><a href="#2、下载Suricata的扩展检测规则集" class="headerlink" title="2、下载Suricata的扩展检测规则集"></a>2、下载Suricata的扩展检测规则集</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /tmp/ &amp;&amp; curl -LO https://rules.emergingthreats.net/open/suricata-6.0.8/emerging.rules.tar.gz</span><br><span class="line">sudo tar -xvzf emerging.rules.tar.gz &amp;&amp; sudo mkdir /etc/suricata/rules &amp;&amp; sudo mv rules/*.rules /etc/suricata/rules/</span><br><span class="line">sudo chmod 777 /etc/suricata/rules/*.rules</span><br></pre></td></tr></table></figure><h2 id="3、配置Surcata"><a href="#3、配置Surcata" class="headerlink" title="3、配置Surcata"></a>3、配置Surcata</h2><p>在 <code>/etc/suricata/suricata.yaml</code> 文件中修改 Suricata 设置并设置以下变量</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">HOME_NET: <span class="string">"&lt;UBUNTU_IP&gt;"</span></span><br><span class="line">EXTERNAL_NET: <span class="string">"any"</span></span><br><span class="line"></span><br><span class="line">default-rule-path: /etc/suricata/rules</span><br><span class="line">rule-files:</span><br><span class="line">- <span class="string">"*.rules"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Global stats configuration</span></span><br><span class="line">stats:</span><br><span class="line">enabled: yes</span><br><span class="line"></span><br><span class="line"><span class="comment"># Linux high speed capture support</span></span><br><span class="line">af-packet:</span><br><span class="line">  - interface: ens2</span><br></pre></td></tr></table></figure><p>接口表示您想要监控的网络接口。将值替换为 Ubuntu 端点的接口名称。</p><p><img src="http://image2.ishareread.com/images/2025/20251012/2-%E8%AE%BE%E7%BD%AE%E4%B8%BA%E6%B5%81%E9%87%8F%E6%A3%80%E6%B5%8B%E7%9A%84%E7%BD%91%E5%8D%A1.png" alt="设置为流量检测的网卡"></p><p>可以通过ifconfig查看Ubuntu的网络接口，例如，我这里是ens2。<br><img src="http://image2.ishareread.com/images/2025/20251012/3-ifconfig%E6%9F%A5%E7%9C%8B%E7%BD%91%E5%8D%A1.png" alt="查看网络接口"></p><h2 id="4、重启Suricata服务"><a href="#4、重启Suricata服务" class="headerlink" title="4、重启Suricata服务"></a>4、重启Suricata服务</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo systemctl restart suricata</span><br></pre></td></tr></table></figure><h1 id="三、wazuh与Suricata集成"><a href="#三、wazuh与Suricata集成" class="headerlink" title="三、wazuh与Suricata集成"></a>三、wazuh与Suricata集成</h1><p>将以下配置添加到Wazuh代理的<code>/var/ossec/etc/ossec.conf</code>文件中。这允许Wazuh代理读取Suricata日志文件：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;ossec_config&gt;</span><br><span class="line">  &lt;localfile&gt;</span><br><span class="line">    &lt;log_format&gt;json&lt;/log_format&gt;</span><br><span class="line">    &lt;location&gt;/var/<span class="built_in">log</span>/suricata/eve.json&lt;/location&gt;</span><br><span class="line">  &lt;/localfile&gt;</span><br><span class="line">&lt;/ossec_config&gt;</span><br></pre></td></tr></table></figure><p><img src="http://image2.ishareread.com/images/2025/20251012/4-%E9%85%8D%E7%BD%AEwazuh%E6%8E%A5%E6%94%B6suricata%E6%95%B0%E6%8D%AE.png" alt="配置wazuh接受suricata数据"></p><p>重新启动Wazuh代理以使配置生效</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo systemctl restart wazuh-agent</span><br></pre></td></tr></table></figure><h1 id="四、模拟攻击"><a href="#四、模拟攻击" class="headerlink" title="四、模拟攻击"></a>四、模拟攻击</h1><blockquote><p>请注意：本文介绍的模拟攻击仅限于自己搭建测试环境进行POC验证。请不要使用这些工具和方法对其它目标主机进行测试，使用这些工具前，务必获得目标系统的明确书面授权，未经授权的测试属违法行为。</p></blockquote><p>端口扫描是渗透测试的第一步，通过端口扫描可以快速发现目标主机的攻击面。使用 nmap进行端口扫描是网络安全中最基础且关键的操作之一。我们在Kali Linux主机上通过nmap对目标靶机192.168.0.30进行端口扫描看开放有哪些端口。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nmap -p- -sV -O -A -T4 -Pn -oX full_scan.xml 192.168.0.30</span><br></pre></td></tr></table></figure><h1 id="五、效果验证"><a href="#五、效果验证" class="headerlink" title="五、效果验证"></a>五、效果验证</h1><p>在Kali Linux主机上通过nmap对目标靶机192.168.0.30进行端口扫描的过程中，我们在192.168.0.40的wazuh server的威胁狩猎界面可以看到suricata通过流量检测识别到端口扫描的攻击行为，并通过wazuh的可视化界面进行告警的展示。</p><p><img src="http://image2.ishareread.com/images/2025/20251012/5-suricata%E5%91%8A%E8%AD%A6.png" alt="surcata告警"></p><p>点击可以查看告警的详情，可以看到是通过suricata发现的来自源IP192.168.0.65的nmap扫描行为。</p><p><img src="http://image2.ishareread.com/images/2025/20251012/6-suricata%E5%91%8A%E8%AD%A6%E8%AF%A6%E6%83%85.png" alt="suricata告警详情"></p><p>至此，我们通过wasuh与网络入侵检测系统（suricata）进行集成，并模拟对目标主机进行端口扫描，验证了通过Suricata监控和分析网络流量进行威胁检测与Wazuh集成后在Wazuh的威胁狩猎中及时预警威胁攻击行为。</p><hr><p>作者博客：<a href="http://xiejava.ishareread.com/">http://xiejava.ishareread.com/</a></p><center> <br><p><img src="http://image2.ishareread.com/images/fullbug%E5%BE%AE%E4%BF%A1%E5%85%AC%E4%BC%97%E5%8F%B7.jpg" alt="“fullbug”微信公众号" title="“fullbug”微信公众号"> </p><p>关注：微信公众号,一起学习成长！</center></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;Wazuh是一个功能强大的开源安全平台，它集成了安全信息与事件管理（SIEM）和扩展检测与响应（XDR）的能力，旨在为本地、虚拟化、容器化及云环境中的工作负载提供统一的威胁预防、检测和响应解决方案。&lt;/p&gt;
&lt;p&gt;Wazuh可以与基于网络的入侵检测系统（NIDS）集成，通过
      
    
    </summary>
    
    
      <category term="技术" scheme="http://xiejava.ishareread.com/categories/%E6%8A%80%E6%9C%AF/"/>
    
      <category term="网络安全" scheme="http://xiejava.ishareread.com/categories/%E6%8A%80%E6%9C%AF/%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8/"/>
    
    
      <category term="网络安全" scheme="http://xiejava.ishareread.com/tags/%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8/"/>
    
  </entry>
  
  <entry>
    <title>开源安全管理平台wazuh-暴力破解检测与响应</title>
    <link href="http://xiejava.ishareread.com/posts/c76cd9e6/"/>
    <id>http://xiejava.ishareread.com/posts/c76cd9e6/</id>
    <published>2025-10-11T06:25:00.000Z</published>
    <updated>2025-12-10T07:13:20.846Z</updated>
    
    <content type="html"><![CDATA[<p>Wazuh是一个功能强大的开源安全平台，它集成了安全信息与事件管理（SIEM）和扩展检测与响应（XDR）的能力，旨在为本地、虚拟化、容器化及云环境中的工作负载提供统一的威胁预防、检测和响应解决方案。</p><p>暴力破解是网络安全领域一种常见且顽固的威胁，像Linux端点的SSH这样的服务通常容易受到暴力破解攻击，攻击者利用它来非法访问端点和服务。有效应对暴力破解需要“侦测”和“防护”双管齐下。Wazuh通过关联多个认证失败事件来识别暴力破解攻击并可以配置主动响应以阻止攻击者的IP地址。</p><p>本文通过POC来验证wazuh对暴力破解检测与响应能力</p><h1 id="一、环境准备"><a href="#一、环境准备" class="headerlink" title="一、环境准备"></a>一、环境准备</h1><p>POC环境如下图所示：</p><p><img src="http://image2.ishareread.com/images/2025/20251011/1-POC%E6%8B%93%E6%89%91%E5%9B%BE.png" alt="POC拓扑图"></p><table><thead><tr><th>主机</th><th>描述</th></tr></thead><tbody><tr><td>安全管理平台wazuh-server<br>(192.168.0.40)</td><td>All in one安装wazuh，监控wazuh-agent上报的告警信息进行暴力破解检测并联动wazuh-agent进行封堵响应</td></tr><tr><td>ubuntu应用服务器<br>（192.168.0.30）</td><td>ubuntu应用服务器ssh服务，安装wazuh-agent ,模拟被攻击的服务器</td></tr><tr><td>Kali Linux模拟攻击机器<br>（192.168.0.65）</td><td>Kali linux ,模拟攻击机器</td></tr></tbody></table><h1 id="二、wazuh-配置"><a href="#二、wazuh-配置" class="headerlink" title="二、wazuh 配置"></a>二、wazuh 配置</h1><p>Wazuh使用主动响应模块在受监控端点上运行脚本或可执行文件，对某些触发器采取行动。在本用例中，我们模拟对ubuntu应用服务器端点的SSH暴力破解攻击，并配置主动响应模块以阻止攻击端点的IP地址。目标是防止SSH暴力破解攻击。</p><p>Wazuh附带一套用于主动响应的默认脚本。这些脚本位于Linux/Unix端点的<code>/var/ossec/active-response/bin/</code>目录中。firewall-drop主动响应脚本与Linux/Unix操作系统兼容。它使用iptables来阻止恶意IP地址。</p><h2 id="Wazuh-server配置"><a href="#Wazuh-server配置" class="headerlink" title="Wazuh server配置"></a>Wazuh server配置</h2><p>1、打开Wazuh服务器<code>/var/ossec/etc/ossec.conf</code>文件，并验证在<code>&lt;ossec_config&gt;</code>块中存在名为firewall-drop的<code>&lt;command&gt;</code>块，其配置如下：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">command</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">name</span>&gt;</span>firewall-drop<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">executable</span>&gt;</span>firewall-drop<span class="tag">&lt;/<span class="name">executable</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">timeout_allowed</span>&gt;</span>yes<span class="tag">&lt;/<span class="name">timeout_allowed</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">command</span>&gt;</span></span><br></pre></td></tr></table></figure><p><code>&lt;command&gt;</code>块包含有关在Wazuh代理上执行的操作的信息：</p><ul><li><code>&lt;name&gt;</code>：为命令设置名称。在本例中，为firewall-drop。</li><li><code>&lt;executable&gt;</code>：指定在触发时必须运行的响应脚本或可执行文件。在本例中，是firewall-drop可执行文件。</li><li><code>&lt;timeout_allowed&gt;</code>：允许在一段时间后超时。在此处，此标签设置为yes，表示状态性主动响应。</li></ul><p>2、将以下 <code>&lt;active-response&gt;</code> 块添加到 Wazuh 服务器 <code>/var/ossec/etc/ossec.conf</code> 配置文件中：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">ossec_config</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">active-response</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">disabled</span>&gt;</span>no<span class="tag">&lt;/<span class="name">disabled</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">command</span>&gt;</span>firewall-drop<span class="tag">&lt;/<span class="name">command</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">location</span>&gt;</span>local<span class="tag">&lt;/<span class="name">location</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">rules_id</span>&gt;</span>5763<span class="tag">&lt;/<span class="name">rules_id</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">timeout</span>&gt;</span>180<span class="tag">&lt;/<span class="name">timeout</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">active-response</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">ossec_config</span>&gt;</span></span><br></pre></td></tr></table></figure><ul><li><code>&lt;comand&gt;</code>：指定要配置的命令。这是在上一步骤中定义的防火墙丢弃命令 firewall-drop。</li><li><code>&lt;location&gt;</code>：指定命令执行的位置。使用本地值表示命令在触发事件发生的监控端点处执行。</li><li><code>&lt;rules_id&gt;</code>：如果规则ID 5763 - SSHD暴力破解尝试访问系统触发，则活动响应模块将执行该命令。</li><li><code>&lt;timeout&gt;</code>：指定活动响应操作必须持续的时间。在本用例中，模块将阻止执行暴力破解攻击的端点IP地址180秒。</li></ul><p>3、重新启动Wazuh管理器服务以应用更改：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo systemctl restart wazuh-manager</span><br></pre></td></tr></table></figure><h1 id="三、模拟攻击"><a href="#三、模拟攻击" class="headerlink" title="三、模拟攻击"></a>三、模拟攻击</h1><p>我们通过Kali Linux自带的Hydra进行模拟攻击。</p><blockquote><p>请注意：本文介绍的模拟攻击仅限于自己搭建测试环境进行POC验证。请不要使用这些工具和方法对其它目标主机进行测试，使用这些工具前，务必获得目标系统的明确书面授权，未经授权的测试属违法行为。</p></blockquote><p>Hydra 配合 SecLists 工具包，可以显著提升密码破解测试的效率和成功率。<br>SecLists 是一款在安全测试中非常受欢迎的开源集合项目，提供了各种类型的字典列表，包括但不限于用户名、密码、目录路径、子域名等。Hydra 则是一款强大的网络登录破解工具，支持多种协议。将两者结合，可以针对各种网络服务进行高效的密码暴力破解测试。<br>在 Kali Linux 中，SecLists 通常位于 <code>/usr/share/seclists</code>目录。如果系统未安装，可以使用以下命令安装：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt update &amp;&amp; sudo apt install seclists</span><br></pre></td></tr></table></figure><p>在Kali Linux（192.168.0.65）上执行hydra 对 192.168.0.30 进行模拟攻击</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hydra -L /usr/share/seclists/Usernames/top-usernames-shortlist.txt -P /usr/share/seclists/Passwords/Common-Credentials/top-20-common-SSH-passwords.txt 192.168.0.30 ssh -t 4 -vV</span><br></pre></td></tr></table></figure><h1 id="四、效果验证"><a href="#四、效果验证" class="headerlink" title="四、效果验证"></a>四、效果验证</h1><p>可以看到触发了wazuh的告警规则，在Wazuh仪表板中看到多次的登录失败的告警数据，并生成了试图暴力破解的攻击告警。<br><img src="http://image2.ishareread.com/images/2025/20251011/2-%E6%9A%B4%E5%8A%9B%E7%A0%B4%E8%A7%A3%E6%A3%80%E6%B5%8B%E4%B8%8E%E5%93%8D%E5%BA%94%E5%91%8A%E8%AD%A6.png" alt="告警"></p><p>在详情中可以清楚的看到多次尝试暴力破解ssh登录<br><img src="http://image2.ishareread.com/images/2025/20251011/3-%E6%9A%B4%E5%8A%9B%E7%A0%B4%E8%A7%A3%E5%91%8A%E8%AD%A6%E8%AF%A6%E6%83%85.png" alt="告警详情"></p><p>可以看到wazuh检测到有ssh暴力破解的行为并自动调用防火墙对攻击IP进行封堵，封堵180秒。<br><img src="http://image2.ishareread.com/images/2025/20251011/4-%E6%9A%B4%E5%8A%9B%E7%A0%B4%E8%A7%A3%E5%91%8A%E8%AD%A6%E5%B0%81%E5%A0%B5.png" alt="封堵"></p><p>在Hydra的攻击日志可以看到，被wazuh进行响应封堵后ssh超时报错，说明已经成功阻断阻止了攻击行为。<br><img src="http://image2.ishareread.com/images/2025/20251011/5-%E6%9A%B4%E5%8A%9B%E7%A0%B4%E8%A7%A3%E5%B0%81%E5%A0%B5%E6%95%88%E6%9E%9C.png" alt="阻止效果"></p><p>至此，我们通过一个实际的POC实例验证了wazuh对ssh暴力破解攻击行为的检测和响应，通过“侦测”和“防护”双管齐下能有效减轻ssh暴力破解威胁攻击风险。</p><hr><p>作者博客：<a href="http://xiejava.ishareread.com/">http://xiejava.ishareread.com/</a></p><center> <br><p><img src="http://image2.ishareread.com/images/fullbug%E5%BE%AE%E4%BF%A1%E5%85%AC%E4%BC%97%E5%8F%B7.jpg" alt="“fullbug”微信公众号" title="“fullbug”微信公众号"> </p><p>关注：微信公众号,一起学习成长！</center></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;Wazuh是一个功能强大的开源安全平台，它集成了安全信息与事件管理（SIEM）和扩展检测与响应（XDR）的能力，旨在为本地、虚拟化、容器化及云环境中的工作负载提供统一的威胁预防、检测和响应解决方案。&lt;/p&gt;
&lt;p&gt;暴力破解是网络安全领域一种常见且顽固的威胁，像Linux端点
      
    
    </summary>
    
    
      <category term="技术" scheme="http://xiejava.ishareread.com/categories/%E6%8A%80%E6%9C%AF/"/>
    
      <category term="网络安全" scheme="http://xiejava.ishareread.com/categories/%E6%8A%80%E6%9C%AF/%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8/"/>
    
    
      <category term="网络安全" scheme="http://xiejava.ishareread.com/tags/%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8/"/>
    
  </entry>
  
  <entry>
    <title>开源安全管理平台wazuh-文件完整性监控FIM</title>
    <link href="http://xiejava.ishareread.com/posts/8d366bb0/"/>
    <id>http://xiejava.ishareread.com/posts/8d366bb0/</id>
    <published>2025-10-08T12:26:53.000Z</published>
    <updated>2025-12-10T07:13:20.776Z</updated>
    
    <content type="html"><![CDATA[<p>Wazuh是一个功能强大的开源安全平台，它集成了安全信息与事件管理（SIEM）和扩展检测与响应（XDR）的能力，旨在为本地、虚拟化、容器化及云环境中的工作负载提供统一的威胁预防、检测和响应解决方案。<br>文件完整性监控（File integrity monitoring FIM）有助于审计敏感文件和满足合规性要求。Wazuh内置了一个FIM模块，用于监控文件系统变化，以检测文件的创建、修改和删除。<br>本文通过POC来验证Wazuh的FIM功能，使用Wazuh FIM模块来检测Ubuntu和Windows端点上监控目录的变化。Wazuh FIM模块通过使用who-data审计获取有关更改用户和进程的信息来丰富告警数据。</p><h1 id="一、环境准备"><a href="#一、环境准备" class="headerlink" title="一、环境准备"></a>一、环境准备</h1><p>POC环境如下图所示：<br><img src="http://image2.ishareread.com/images/2025/20251008/1-FIMPOC%E6%8B%93%E6%89%91%E5%9B%BE.png" alt="POC环境拓扑图"></p><table><thead><tr><th>主机</th><th>描述</th></tr></thead><tbody><tr><td>安全管理平台wazuh-server<br>(192.168.0.40)</td><td>All in one安装wazuh，监控wazuh-agent上报的告警信息进行文件完整性监控(FIM)</td></tr><tr><td>被监控Windows 11机器<br>(192.168.0.16)</td><td>安装wazuh-agent，通过Wazuh FIM模块在此端点监控一个目录，以检测文件创建、更改和删除。</td></tr><tr><td>被监控Ubuntu主机<br>(192.168.0.41)</td><td>安装wazuh-agent，通过Wazuh FIM模块在此端点监控一个目录，以检测文件创建、更改和删除。</td></tr></tbody></table><h1 id="二、wazuh配置"><a href="#二、wazuh配置" class="headerlink" title="二、wazuh配置"></a>二、wazuh配置</h1><h2 id="1、window机器安装wazuh并配置"><a href="#1、window机器安装wazuh并配置" class="headerlink" title="1、window机器安装wazuh并配置"></a>1、window机器安装wazuh并配置</h2><h3 id="1）安装wazuh-agent"><a href="#1）安装wazuh-agent" class="headerlink" title="1）安装wazuh-agent"></a>1）安装wazuh-agent</h3><p>在wazuh的管理端找到部署agent界面，选择window的agent安装包</p><p><img src="http://image2.ishareread.com/images/2025/20251008/2-wazuh%E9%83%A8%E7%BD%B2agent%E7%95%8C%E9%9D%A2.png" alt="wazuh部署agent界面"></p><p>wazuh会自动生成部署agent的脚本</p><p><img src="http://image2.ishareread.com/images/2025/20251008/3-%E8%87%AA%E5%8A%A8%E7%94%9F%E6%88%90%E9%83%A8%E7%BD%B2agent%E7%9A%84%E8%84%9A%E6%9C%AC.png" alt="自动生成部署agent的脚本"></p><p>在window11（192.168.0.16）机器上以管理员权限运行powershell,在powershell中运行agent安装脚本</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Invoke-WebRequest -Uri https://packages.wazuh.com/4.x/windows/wazuh-agent-4.13.0-1.msi -OutFile <span class="variable">$env</span>:tmp\wazuh-agent; msiexec.exe /i <span class="variable">$env</span>:tmp\wazuh-agent /q WAZUH_MANAGER=<span class="string">'192.168.0.40'</span> WAZUH_AGENT_NAME=<span class="string">'Lenovo-L13-agent'</span></span><br></pre></td></tr></table></figure><p><img src="http://image2.ishareread.com/images/2025/20251008/4-%E8%BF%90%E8%A1%8Cagent%E5%AE%89%E8%A3%85%E8%84%9A%E6%9C%AC.png" alt="运行agent安装脚本"></p><p>运行<code>NET START Wazuh</code>启动wazuh-agent，过一会就可以在wazuh服务端的dashboard中看到window 11的wazuh-agent注册上来了。</p><p><img src="http://image2.ishareread.com/images/2025/20251008/5-%E6%B3%A8%E5%86%8Cagent.png" alt="注册agent"></p><h3 id="2）-配置window端点的wazuh-agent"><a href="#2）-配置window端点的wazuh-agent" class="headerlink" title="2） 配置window端点的wazuh-agent"></a>2） 配置window端点的wazuh-agent</h3><p>按照以下步骤配置Wazuh代理以监控以下目录的文件系统更改。如监控<code>C:\Users\xiejava\Desktop</code>的文件更改。<br>在受监控的Windows端点上编辑<code>C:\Program Files (x86)\ossec-agent\ossec.conf</code>配置文件。在<code>&lt;syscheck&gt;</code>块内添加监控目录。配置Wazuh监控<code>C:\Users\xiejava\Desktop</code>目录。</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">directories</span> <span class="attr">check_all</span>=<span class="string">"yes"</span> <span class="attr">report_changes</span>=<span class="string">"yes"</span> <span class="attr">realtime</span>=<span class="string">"yes"</span>&gt;</span>C:\Users\xiejava\Desktop<span class="tag">&lt;/<span class="name">directories</span>&gt;</span></span><br></pre></td></tr></table></figure><p><img src="http://image2.ishareread.com/images/2025/20251008/6-%E9%85%8D%E7%BD%AEwindow%E7%AB%AF%E7%82%B9%E7%9A%84FIM%E7%9B%91%E6%8E%A7.png" alt="配置FIM监控"></p><p>使用具有管理员权限的PowerShell重新启动Wazuh代理以使配置更改生效。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Restart-Service -Name wazuh</span><br></pre></td></tr></table></figure><h2 id="2、ubuntu主机的wazuh-agent配置"><a href="#2、ubuntu主机的wazuh-agent配置" class="headerlink" title="2、ubuntu主机的wazuh-agent配置"></a>2、ubuntu主机的wazuh-agent配置</h2><p>由于ubuntu主机（192.168.0.41）已经安装了wazuh-agent，只需要对wazuh-agent进行配置就可以了。<br>执行以下步骤以配置Wazuh代理以监控<code>/root</code>目录中的文件系统更改。<br>编辑Wazuh代理的<code>/var/ossec/etc/ossec.conf</code>配置文件。在<code>&lt;syscheck&gt;</code>块中添加监控的目录。配置Wazuh监控<code>/root</code>目录。</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">directories</span> <span class="attr">check_all</span>=<span class="string">"yes"</span> <span class="attr">report_changes</span>=<span class="string">"yes"</span> <span class="attr">realtime</span>=<span class="string">"yes"</span>&gt;</span>/root<span class="tag">&lt;/<span class="name">directories</span>&gt;</span></span><br></pre></td></tr></table></figure><p><img src="http://image2.ishareread.com/images/2025/20251008/7-%E9%85%8D%E7%BD%AEubuntu%E7%AB%AF%E7%82%B9%E7%9A%84FIM%E7%9B%91%E6%8E%A7.png" alt="配置ubuntu端点的FIM监控"></p><p>重新启动Wazuh代理以使配置生效</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo systemctl restart wazuh-agent</span><br></pre></td></tr></table></figure><h1 id="三、效果验证"><a href="#三、效果验证" class="headerlink" title="三、效果验证"></a>三、效果验证</h1><h2 id="1、windows端点文件完整性监控"><a href="#1、windows端点文件完整性监控" class="headerlink" title="1、windows端点文件完整性监控"></a>1、windows端点文件完整性监控</h2><h3 id="1）文件增、删、改"><a href="#1）文件增、删、改" class="headerlink" title="1）文件增、删、改"></a>1）文件增、删、改</h3><p>在window 11(192.168.0.16)的机器的桌面上新建一个.txt文件，然后重命名为test-win11.txt，再修改test-win11.txt的内容。</p><h3 id="2）可视化告警监控"><a href="#2）可视化告警监控" class="headerlink" title="2）可视化告警监控"></a>2）可视化告警监控</h3><p>在wazuh的dashboard中可以看到window 11机器的完整性监控告警。<br><img src="http://image2.ishareread.com/images/2025/20251008/8-win11%E7%9A%84FIM%E5%91%8A%E8%AD%A6.png" alt="win11的FIM告警"></p><p>在详情中可以看到window11机器c:\users\xiejava\desktop\下文件变更的详情。<br><img src="http://image2.ishareread.com/images/2025/20251008/9-win11%E7%9A%84FIM%E5%91%8A%E8%AD%A6%E8%AF%A6%E6%83%85.png" alt="win11的FIM告警详情"></p><h2 id="2、ubuntu主机文件完整性监控"><a href="#2、ubuntu主机文件完整性监控" class="headerlink" title="2、ubuntu主机文件完整性监控"></a>2、ubuntu主机文件完整性监控</h2><h3 id="1）文件增、删、改-1"><a href="#1）文件增、删、改-1" class="headerlink" title="1）文件增、删、改"></a>1）文件增、删、改</h3><p>  在ubuntu(192.168.0.41)的机器的/root新建一个test.txt文件，然后重命名为test-ubuntu.txt，再修改test-ubuntu.txt的内容。</p><h3 id="2）可视化告警监控-1"><a href="#2）可视化告警监控-1" class="headerlink" title="2）可视化告警监控"></a>2）可视化告警监控</h3><p>在wazuh的dashboard中可以看到ubuntu(192.168.0.41)主机的文件完整性监控告警。<br><img src="http://image2.ishareread.com/images/2025/20251008/10-ubuntu%E7%AB%AF%E7%82%B9%E7%9A%84FIM%E5%91%8A%E8%AD%A6%E4%BA%8B%E4%BB%B6.png" alt="ubuntu端点的FIM告警事件"></p><p>在Dashboard中可以看到FIM的统计信息包括对文件的新增、删除、修改等。<br><img src="http://image2.ishareread.com/images/2025/20251008/11-ubuntu%E7%AB%AF%E7%82%B9%E7%9A%84FIMDashboard.png" alt="ubuntu端点的FIMDashboard"></p><p>在Events中可以看到文件被修改触发的事件<br><img src="http://image2.ishareread.com/images/2025/20251008/12-ubuntu%E7%AB%AF%E7%82%B9%E7%9A%84FIM%E5%91%8A%E8%AD%A6%E5%88%97%E8%A1%A8.png" alt="ubuntu端点的FIM告警列表"></p><p>可以查看具体的事件详情<br><img src="http://image2.ishareread.com/images/2025/20251008/13-ubuntu%E7%AB%AF%E7%82%B9%E7%9A%84FIM%E5%91%8A%E8%AD%A6%E8%AF%A6%E6%83%85.png" alt="ubuntu端点的FIM告警详情"></p><p>至此，我们通过POC实例来验证了Wazuh的文件完整性监控FIM功能，使用Wazuh FIM模块来检测Ubuntu和Windows端点上监控目录的变化。</p><hr><p>作者博客：<a href="http://xiejava.ishareread.com/">http://xiejava.ishareread.com/</a></p><center> <br><p><img src="http://image2.ishareread.com/images/fullbug%E5%BE%AE%E4%BF%A1%E5%85%AC%E4%BC%97%E5%8F%B7.jpg" alt="“fullbug”微信公众号" title="“fullbug”微信公众号"> </p><p>关注：微信公众号,一起学习成长！</center></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;Wazuh是一个功能强大的开源安全平台，它集成了安全信息与事件管理（SIEM）和扩展检测与响应（XDR）的能力，旨在为本地、虚拟化、容器化及云环境中的工作负载提供统一的威胁预防、检测和响应解决方案。&lt;br&gt;文件完整性监控（File integrity monitoring 
      
    
    </summary>
    
    
      <category term="技术" scheme="http://xiejava.ishareread.com/categories/%E6%8A%80%E6%9C%AF/"/>
    
      <category term="网络安全" scheme="http://xiejava.ishareread.com/categories/%E6%8A%80%E6%9C%AF/%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8/"/>
    
    
      <category term="网络安全" scheme="http://xiejava.ishareread.com/tags/%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8/"/>
    
  </entry>
  
  <entry>
    <title>开源安全管理平台wazuh-阻止恶意IP访问</title>
    <link href="http://xiejava.ishareread.com/posts/8d7a03ba/"/>
    <id>http://xiejava.ishareread.com/posts/8d7a03ba/</id>
    <published>2025-10-07T11:46:43.000Z</published>
    <updated>2025-12-10T07:13:20.701Z</updated>
    
    <content type="html"><![CDATA[<p>Wazuh是一个功能强大的开源安全平台，它集成了安全信息与事件管理（SIEM）和扩展检测与响应（XDR）的能力，旨在为本地、虚拟化、容器化及云环境中的工作负载提供统一的威胁预防、检测和响应解决方案。<br>《<a href="https://blog.csdn.net/fullbug/article/details/152279929" target="_blank" rel="noopener">开源安全管理平台wazuh-安装与配置</a>》介绍了wazuh的安装和配置，本文基于已经完成的wazuh安装配置基础上通过POC来验证wazuh的功能，通过wazuh来阻止已知的恶意IP的访问。</p><h2 id="一、环境准备"><a href="#一、环境准备" class="headerlink" title="一、环境准备"></a>一、环境准备</h2><p>POC环境如下图所示：</p><p><img src="http://image2.ishareread.com/images/2025/20251007/1-wazuhPOC%E7%8E%AF%E5%A2%83%E6%8B%93%E6%89%91%E5%9B%BE.png" alt="POC拓扑图"></p><table><thead><tr><th>主机</th><th>描述</th></tr></thead><tbody><tr><td>安全管理平台wazuh-server<br>(192.168.0.40)</td><td>All in one安装wazuh，监控wazuh-agent上报的告警信息进行可视化展示，并联动wazuh-agent进行主动的拦截阻止</td></tr><tr><td>Nginx服务器<br>（192.168.0.41）</td><td>安装Nginx服务及wazuh-agent</td></tr><tr><td>Apache2服务器<br>（192.168.0.43）</td><td>安装Apache2服务及wazuh-agent</td></tr><tr><td>kali<br>（192.168.0.65）</td><td>Kali (模拟恶意IP主机)</td></tr></tbody></table><p>以上除192.168.0.65是kali linux外，其他主机都是ubuntu。</p><h2 id="二、wazuh配置"><a href="#二、wazuh配置" class="headerlink" title="二、wazuh配置"></a>二、wazuh配置</h2><h3 id="1、wazuh-agent配置"><a href="#1、wazuh-agent配置" class="headerlink" title="1、wazuh-agent配置"></a>1、wazuh-agent配置</h3><h4 id="1）安装nginx服务并配置wazuh-agent"><a href="#1）安装nginx服务并配置wazuh-agent" class="headerlink" title="1）安装nginx服务并配置wazuh-agent"></a>1）安装nginx服务并配置wazuh-agent</h4><p>在192.168.0.41上安装nginx</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo apt updat</span><br><span class="line">sudo apt install nginx</span><br></pre></td></tr></table></figure><p>允许防火墙访问</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo ufw allow <span class="string">'Nginx Full'</span></span><br><span class="line">sudo ufw status</span><br><span class="line">sudo ufw app list</span><br></pre></td></tr></table></figure><p>验证nginx服务状态</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo systemctl status nginx</span><br></pre></td></tr></table></figure><p>用浏览器访问<a href="http://192.168.0.41" target="_blank" rel="noopener">http://192.168.0.41</a> 验证nginx服务是否正常访问<br><img src="http://image2.ishareread.com/images/2025/20251007/2-%E8%AE%BF%E9%97%AEnginx.png" alt="nginx"></p><p>将以下内容添加到 <code>/var/ossec/etc/ossec.conf</code> 文件中，以配置 Wazuh 代理并监控 nginx访问日志</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">localfile</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">log_format</span>&gt;</span>syslog<span class="tag">&lt;/<span class="name">log_format</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">location</span>&gt;</span>/var/log/nginx/access.log<span class="tag">&lt;/<span class="name">location</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">localfile</span>&gt;</span></span><br></pre></td></tr></table></figure><p>如下图所示：</p><p><img src="http://image2.ishareread.com/images/2025/20251007/3-nginx%E8%AE%BF%E9%97%AE%E6%97%A5%E5%BF%97%E8%B7%AF%E5%BE%84.png" alt="nginx访问日志路径"></p><p>重启wazuh-agent使配置生效</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo systemctl restart wazuh-agent</span><br></pre></td></tr></table></figure><h4 id="2-安装apach2并配置wazuh-agent"><a href="#2-安装apach2并配置wazuh-agent" class="headerlink" title="2)  安装apach2并配置wazuh-agent"></a>2)  安装apach2并配置wazuh-agent</h4><p>在192.168.0.43上安装apach2</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo apt update</span><br><span class="line">sudo apt install apache2</span><br></pre></td></tr></table></figure><p>允许防火墙访问</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo ufw allow <span class="string">'Apache'</span></span><br><span class="line">sudo ufw status</span><br><span class="line">sudo ufw app list</span><br></pre></td></tr></table></figure><p>验证nginx服务状态</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo systemctl status apache2</span><br></pre></td></tr></table></figure><p>用浏览器访问<a href="http://192.168.0.43" target="_blank" rel="noopener">http://192.168.0.43</a> 验证apache2服务是否正常访问</p><p><img src="http://image2.ishareread.com/images/2025/20251007/4-%E8%AE%BF%E9%97%AEapache2.png" alt="apache2"></p><p>将以下内容添加到 <code>/var/ossec/etc/ossec.conf</code> 文件中，以配置 Wazuh 代理并监控 apache2访问日志</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">localfile</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">log_format</span>&gt;</span>syslog<span class="tag">&lt;/<span class="name">log_format</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">location</span>&gt;</span>/var/log/apache2/access.log<span class="tag">&lt;/<span class="name">location</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">localfile</span>&gt;</span></span><br></pre></td></tr></table></figure><p>如下图所示：</p><p><img src="http://image2.ishareread.com/images/2025/20251007/5-apache%E8%AE%BF%E9%97%AE%E6%97%A5%E5%BF%97%E8%B7%AF%E5%BE%84.png" alt="apache访问日志路径"></p><p>重启wazuh-agent使配置生效</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo systemctl restart wazuh-agent</span><br></pre></td></tr></table></figure><h3 id="2、wazuh-server配置"><a href="#2、wazuh-server配置" class="headerlink" title="2、wazuh-server配置"></a>2、wazuh-server配置</h3><h4 id="1）配置IP信息黑名单"><a href="#1）配置IP信息黑名单" class="headerlink" title="1）配置IP信息黑名单"></a>1）配置IP信息黑名单</h4><p>下载Alienvault IP信誉数据库：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo wget https://iplists.firehol.org/files/alienvault_reputation.ipset -O /var/ossec/etc/lists/alienvault_reputation.ipset</span><br></pre></td></tr></table></figure><p>将攻击端点的IP地址（kali的IP地址192.168.0.65）添加到IP信誉数据库中：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo <span class="built_in">echo</span> <span class="string">"192.168.0.65"</span> &gt;&gt; /var/ossec/etc/lists/alienvault_reputation.ipset</span><br></pre></td></tr></table></figure><p>下载一个将 .ipset 格式转换为 .cdb 列表格式的脚本：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo wget https://wazuh.com/resources/iplist-to-cdblist.py -O /tmp/iplist-to-cdblist.py</span><br></pre></td></tr></table></figure><p>通过运行iplist-to-cdblist.py将ipset转换成.cdb 列表格式blacklist-alienvault</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo python3 /tmp/iplist-to-cdblist.py /var/ossec/etc/lists/alienvault_reputation.ipset /var/ossec/etc/lists/blacklist-alienvault</span><br></pre></td></tr></table></figure><p>为生成的文件分配正确的权限：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo chown wazuh:wazuh /var/ossec/etc/lists/blacklist-alienvault</span><br></pre></td></tr></table></figure><p>确认一下恶意IP192.168.0.65是否在黑名单里</p><p><img src="http://image2.ishareread.com/images/2025/20251007/6-%E6%81%B6%E6%84%8FIP%E9%BB%91%E5%90%8D%E5%8D%95.png" alt="恶意IP在信誉库的黑名单中"></p><h4 id="2）配置响应模块以阻止恶意IP地址"><a href="#2）配置响应模块以阻止恶意IP地址" class="headerlink" title="2）配置响应模块以阻止恶意IP地址"></a>2）配置响应模块以阻止恶意IP地址</h4><p>在Wazuh服务器上的 <code>/var/ossec/etc/rules/local_rules.xml</code> 自定义规则集文件中添加一个自定义规则以触发Wazuh主动响应脚本。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;group name=<span class="string">"attack,"</span>&gt;</span><br><span class="line">  &lt;rule id=<span class="string">"100100"</span> level=<span class="string">"10"</span>&gt;</span><br><span class="line">    &lt;if_group&gt;web|attack|attacks&lt;/if_group&gt;</span><br><span class="line">    &lt;list field=<span class="string">"srcip"</span> lookup=<span class="string">"address_match_key"</span>&gt;etc/lists/blacklist-alienvault&lt;/list&gt;</span><br><span class="line">    &lt;description&gt;IP address found <span class="keyword">in</span> AlienVault reputation database.&lt;/description&gt;</span><br><span class="line">  &lt;/rule&gt;</span><br><span class="line">&lt;/group&gt;</span><br></pre></td></tr></table></figure><p>将自定义规则集加入到Wazuh server <code>/var/ossec/etc/ossec.conf</code> 的配置文件中</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">ossec_config</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">ruleset</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- Default ruleset --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">decoder_dir</span>&gt;</span>ruleset/decoders<span class="tag">&lt;/<span class="name">decoder_dir</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">rule_dir</span>&gt;</span>ruleset/rules<span class="tag">&lt;/<span class="name">rule_dir</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">rule_exclude</span>&gt;</span>0215-policy_rules.xml<span class="tag">&lt;/<span class="name">rule_exclude</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">list</span>&gt;</span>etc/lists/audit-keys<span class="tag">&lt;/<span class="name">list</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">list</span>&gt;</span>etc/lists/amazon/aws-eventnames<span class="tag">&lt;/<span class="name">list</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">list</span>&gt;</span>etc/lists/security-eventchannel<span class="tag">&lt;/<span class="name">list</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">list</span>&gt;</span>etc/lists/blacklist-alienvault<span class="tag">&lt;/<span class="name">list</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- User-defined ruleset --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">decoder_dir</span>&gt;</span>etc/decoders<span class="tag">&lt;/<span class="name">decoder_dir</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">rule_dir</span>&gt;</span>etc/rules<span class="tag">&lt;/<span class="name">rule_dir</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">ruleset</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">ossec_config</span>&gt;</span></span><br></pre></td></tr></table></figure><p>将活动响应块添加到Wazuh服务器<code>/var/ossec/etc/ossec.conf</code> 文件:<br>防火墙丢弃命令与Ubuntu本地iptables防火墙集成，并丢弃来自攻击端点的网络连接60秒</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">ossec_config</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">active-response</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">disabled</span>&gt;</span>no<span class="tag">&lt;/<span class="name">disabled</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">command</span>&gt;</span>firewall-drop<span class="tag">&lt;/<span class="name">command</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">location</span>&gt;</span>local<span class="tag">&lt;/<span class="name">location</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">rules_id</span>&gt;</span>100100<span class="tag">&lt;/<span class="name">rules_id</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">timeout</span>&gt;</span>60<span class="tag">&lt;/<span class="name">timeout</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">active-response</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">ossec_config</span>&gt;</span></span><br></pre></td></tr></table></figure><p>重新启动Wazuh管理器以应用更改生效：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo systemctl restart wazuh-manager</span><br></pre></td></tr></table></figure><h2 id="三、效果验证"><a href="#三、效果验证" class="headerlink" title="三、效果验证"></a>三、效果验证</h2><h3 id="1、模拟攻击"><a href="#1、模拟攻击" class="headerlink" title="1、模拟攻击"></a>1、模拟攻击</h3><p>用kali(192.168.0.65)访问 <a href="http://192.168.0.41和http://192.168.0.43" target="_blank" rel="noopener">http://192.168.0.41和http://192.168.0.43</a><br>攻击端点首次连接到受害者的Web服务器。首次连接后，Wazuh主动响应模块临时阻止对Web服务器的任何后续连接60秒。</p><p><img src="http://image2.ishareread.com/images/2025/20251007/7-%E6%A8%A1%E6%8B%9F%E6%94%BB%E5%87%BB%E8%AE%BF%E9%97%AEWeb%E6%9C%8D%E5%8A%A1%E5%99%A8.png" alt="模拟攻击"></p><p>通过浏览器访问可以看到首次访问后每次都会被阻止60秒才能继续访问。</p><p>通过<code>curl  http://192.168.0.41</code>和<code>curl http://192.168.0.43</code> 首次可以返回信息，每次过60秒才能再次返回信息。</p><h3 id="2、可视化效果验证"><a href="#2、可视化效果验证" class="headerlink" title="2、可视化效果验证"></a>2、可视化效果验证</h3><p>可以在Wazuh仪表板中可视化警报数据。在威胁狩猎模块，添加过滤器以查询警报。</p><p><img src="http://image2.ishareread.com/images/2025/20251007/8-%E5%A8%81%E8%83%81%E7%8B%A9%E7%8C%8E%E6%A8%A1%E5%9D%97%E6%9F%A5%E8%AF%A2%E5%91%8A%E8%AD%A6.png" alt="告警信息"></p><p>在威胁狩猎模块可以看到有恶意IP地址在信誉库中被匹配到的告警，被防火墙自动阻断响应的告警以及60秒以后自动解除阻断的处置信息。</p><p>在详情信息中可以看到攻击阻止的详细信息，通过攻击源IP匹配到了信誉库的黑名单，触发了防火墙封堵规则进行了自动封堵。</p><p><img src="http://image2.ishareread.com/images/2025/20251007/9-%E6%8B%A6%E6%88%AA%E9%98%BB%E6%96%AD%E5%A4%84%E7%BD%AE%E8%AF%A6%E6%83%85.png" alt="告警详情"></p><p>至此，我们通过一个完整的POC验证了wazuh发现恶意IP攻击到自动封堵阻止攻击的全过程。</p><hr><p>作者博客：<a href="http://xiejava.ishareread.com/">http://xiejava.ishareread.com/</a></p><center> <br><p><img src="http://image2.ishareread.com/images/fullbug%E5%BE%AE%E4%BF%A1%E5%85%AC%E4%BC%97%E5%8F%B7.jpg" alt="“fullbug”微信公众号" title="“fullbug”微信公众号"> </p><p>关注：微信公众号,一起学习成长！</center></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;Wazuh是一个功能强大的开源安全平台，它集成了安全信息与事件管理（SIEM）和扩展检测与响应（XDR）的能力，旨在为本地、虚拟化、容器化及云环境中的工作负载提供统一的威胁预防、检测和响应解决方案。&lt;br&gt;《&lt;a href=&quot;https://blog.csdn.net/fu
      
    
    </summary>
    
    
      <category term="技术" scheme="http://xiejava.ishareread.com/categories/%E6%8A%80%E6%9C%AF/"/>
    
      <category term="网络安全" scheme="http://xiejava.ishareread.com/categories/%E6%8A%80%E6%9C%AF/%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8/"/>
    
    
      <category term="网络安全" scheme="http://xiejava.ishareread.com/tags/%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8/"/>
    
  </entry>
  
  <entry>
    <title>开源安全管理平台wazuh-安装与配置</title>
    <link href="http://xiejava.ishareread.com/posts/1ef039a/"/>
    <id>http://xiejava.ishareread.com/posts/1ef039a/</id>
    <published>2025-09-29T11:49:14.000Z</published>
    <updated>2025-12-10T07:13:20.657Z</updated>
    
    <content type="html"><![CDATA[<p>Wazuh是一个功能强大的开源安全平台，它集成了安全信息与事件管理（SIEM）和扩展检测与响应（XDR）的能力，旨在为本地、虚拟化、容器化及云环境中的工作负载提供统一的威胁预防、检测和响应解决方案。</p><p>Wazuh的核心能力如下：</p><table><thead><tr><th>核心功能</th><th>核心功能说明</th></tr></thead><tbody><tr><td>威胁检测与响应</td><td>提供入侵检测（如恶意软件、Rootkit检测）、日志数据分析、文件完整性监控以及主动响应（如自动封禁IP）等能力。</td></tr><tr><td>资产与漏洞管理</td><td>自动进行资产盘点（端口、进程、应用等），并关联CVE数据库实现漏洞检测，帮助识别系统弱点。</td></tr><tr><td>合规性与配置评估​</td><td>支持PCI DSS、GDPR、HIPAA等多种合规标准，提供预定义的检查策略和自动化报告生成功能。</td></tr><tr><td>云与容器安全​</td><td>支持通过API监控AWS、Azure、Google Cloud等云环境，并能与Docker引擎集成，监控容器镜像、配置和运行时行为。</td></tr><tr><td>架构与可扩展性</td><td>采用代理/服务器架构，支持Windows、Linux、macOS等多种操作系统，并拥有灵活的规则引擎，允许用户自定义检测规则。</td></tr></tbody></table><h2 id="核心组件与工作方式"><a href="#核心组件与工作方式" class="headerlink" title="核心组件与工作方式"></a>核心组件与工作方式</h2><p>Wazuh的典型架构主要包含三个组件，它们协同工作以提供完整的安全防护闭环：<br><img src="http://image2.ishareread.com/images/2025/20250929/1-wazuh%E6%9E%B6%E6%9E%84.png" alt="核心组件"></p><ol><li>Wazuh代理（Agent）​​：这是安装在需要保护的端点（如服务器、笔记本电脑、云实例）上的轻量级软件。它负责收集日志、监控文件完整性、扫描系统配置和漏洞，并将这些数据安全地发送给中央管理器。</li><li>Wazuh服务器（Server）​​：作为大脑，服务器接收来自所有代理的数据，并通过内置的解码器和规则引擎进行分析，以识别潜在的安全威胁和异常活动。它还可以管理代理的配置和升级。</li><li>Wazuh索引器（Index）​​：Wazuh索引器是一个高度可扩展的全文本搜索和分析引擎。这个中央组件索引并存储由Wazuh服务器生成的警报。</li><li>Wazuh仪表盘（dashboard）：Wazuh仪表盘是数据可视化和分析的网络用户界面。它包括用于威胁狩猎、合规性（例如，PCI DSS、GDPR、CIS、HIPAA、NIST 800-53）的现成仪表盘，检测到的易受攻击的应用程序，文件完整性监控数据，配置评估结果，云基础设施监控事件以及其他内容。它还用于管理Wazuh配置并监控其状态。</li></ol><h2 id="主要应用场景"><a href="#主要应用场景" class="headerlink" title="主要应用场景"></a>主要应用场景</h2><p>基于上述特点，Wazuh可以在多种环境中发挥重要作用：</p><ul><li>企业网络安全​：保护企业内网中的服务器和终端设备，检测和响应来自内部和外部的安全威胁，如SSH暴力破解、Web应用攻击等。</li><li>满足合规性要求​：对于需要遵守PCI DSS、GDPR（通用数据保护条例）等法规的组织，Wazuh的自动化合规检查和报告功能可以显著降低审计复杂度。</li><li>云原生环境防护​：在混合云或多云环境中，Wazuh能提供统一的安全视图，监控云基础设施的配置风险（如公开的S3存储桶）和容器化应用的安全。</li></ul><h2 id="安装与配置"><a href="#安装与配置" class="headerlink" title="安装与配置"></a>安装与配置</h2><h3 id="1、资源要求"><a href="#1、资源要求" class="headerlink" title="1、资源要求"></a>1、资源要求</h3><p>wazuh安装的硬件需求高度依赖于受保护端点数量和云工作负载。<br>以下配置在同一主机上all in one部署Wazuh服务器、Wazuh索引器和Wazuh仪表板。这通常足以监控多达100个端点，并存储90天的可查询/索引警报数据。下表显示了all in one部署的推荐硬件：</p><table><thead><tr><th>Agents</th><th>CPU</th><th>RAM</th><th>Storage (90 days)</th></tr></thead><tbody><tr><td>1-25</td><td>4 vCPU</td><td>8 GiB</td><td>50 GB</td></tr><tr><td>25–50</td><td>8 vCPU</td><td>8 GiB</td><td>100 GB</td></tr><tr><td>50–100</td><td>8 vCPU</td><td>8 GiB</td><td>200 GB</td></tr></tbody></table><p>Wazuh 的中心组件需要 64 位 Intel、AMD 或 ARM Linux 处理器（x86_64/AMD64 或 AARCH64/ARM64 架构）来运行。Wazuh 推荐以下任何一种操作系统版本：</p><ul><li>Amazon Linux 2，Amazon Linux 2023</li><li>CentOS 7，8</li><li>CentOS Stream 10</li><li>Red Hat Enterprise Linux 7，8，9，10</li><li>Ubuntu 16.04，18.04，20.04，22.04，24.04</li></ul><h3 id="2、快速安装"><a href="#2、快速安装" class="headerlink" title="2、快速安装"></a>2、快速安装</h3><p>Wazuh的安装很简单，直接执行以下命令即可。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -sO https://packages.wazuh.com/4.13/wazuh-install.sh &amp;&amp; sudo bash ./wazuh-install.sh -a</span><br></pre></td></tr></table></figure><p>命令执行完成，输出将显示访问用户名密码，并显示确认安装成功的消息。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">INFO: --- Summary ---</span><br><span class="line">INFO: You can access the web interface https://&lt;WAZUH_DASHBOARD_IP_ADDRESS&gt;</span><br><span class="line">    User: admin</span><br><span class="line">    Password: &lt;ADMIN_PASSWORD&gt;</span><br><span class="line">INFO: Installation finished.</span><br></pre></td></tr></table></figure><p>通过web界面就可以访问安装好的wazuh<br><img src="http://image2.ishareread.com/images/2025/20250929/2-wazuh%E7%99%BB%E5%BD%95%E7%95%8C%E9%9D%A2.png" alt="wazuh登录界面"></p><p>输入用户名和密码就可以登录到wazuh<br><img src="http://image2.ishareread.com/images/2025/20250929/3-wazuh%E7%9A%84dashboard.png" alt="wazuh的dashboard"></p><h3 id="3、修改密码"><a href="#3、修改密码" class="headerlink" title="3、修改密码"></a>3、修改密码</h3><p>wazuh安装后会默认给个admin的密码，这个密码比较长也不好记忆。可以通过以下命令对admin的默认密码进行修改。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bash wazuh-passwords-tool.sh -u admin -p Secr3tP4ssw*rd</span><br></pre></td></tr></table></figure><h3 id="4、安装EDR的agent"><a href="#4、安装EDR的agent" class="headerlink" title="4、安装EDR的agent"></a>4、安装EDR的agent</h3><p>Wazuh代理是一种单一且轻量级的监控软件。它是一个多平台组件，可以部署到笔记本电脑、台式机、服务器、云实例、容器或虚拟机。它通过收集关键系统和应用记录、库存数据以及检测异常，为端点的安全性提供可见性。<br>在wazuh的dashboard界面，找到Agents summary 点击进去后，点击“Deploy new agent” 安装新的agent代理<br><img src="http://image2.ishareread.com/images/2025/20250929/4-wazuh%E7%9A%84endpoints.png" alt="\[图片\]"></p><p>将显示agent安装的向导界面。<br><img src="http://image2.ishareread.com/images/2025/20250929/5-wazuh%E7%9A%84%E6%96%B0%E5%A2%9Eagent.png" alt="\[图片\]"></p><p>选择目标主机的操作系统，填写wazuh的服务的IP后，将自动生成安装agent的脚本命令。<br><img src="http://image2.ishareread.com/images/2025/20250929/6-wazuh%E8%87%AA%E5%8A%A8%E7%94%9F%E6%88%90agent%E5%AE%89%E8%A3%85%E8%84%9A%E6%9C%AC.png" alt="\[图片\]"></p><p>在目标主机上直接执行命令就可以成功将agent安装。<br><img src="http://image2.ishareread.com/images/2025/20250929/7-wazuh%E5%AE%89%E8%A3%85.png" alt="\[图片\]"></p><p>通过以下命令启动wazuh-agent</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo systemctl daemon-reload</span><br><span class="line">sudo systemctl <span class="built_in">enable</span> wazuh-agent</span><br><span class="line">sudo systemctl start wazuh-agent</span><br></pre></td></tr></table></figure><p>再通过 <code>sudo systemctl status wazuh-agent</code> 查看wazuh-agent的运行状态。<br><img src="http://image2.ishareread.com/images/2025/20250929/8-wazuh%E5%AE%89%E8%A3%85agent%E5%90%AF%E5%8A%A8%E7%8A%B6%E6%80%81.png" alt="\[图片\]"></p><h3 id="5、验证EDR的效果"><a href="#5、验证EDR的效果" class="headerlink" title="5、验证EDR的效果"></a>5、验证EDR的效果</h3><p>wazuh-agent安装完后，就可以在wazuh的dashbord中看到agent采集到的相应的安全风险概览数据了。<br><img src="http://image2.ishareread.com/images/2025/20250929/9-wazuh%E5%AE%89%E5%85%A8%E9%A3%8E%E9%99%A9%E6%A6%82%E8%A7%88.png" alt="\[图片\]"></p><h2 id="总结与建议"><a href="#总结与建议" class="headerlink" title="总结与建议"></a>总结与建议</h2><p>总的来说，Wazuh是一个功能全面、可扩展性强的开源安全平台，特别适合那些希望构建统一、高效且成本可控的安全运营体系的企业或技术团队。后续我将通过一系列POC来验证wazuh的能力。</p><hr><p>作者博客：<a href="http://xiejava.ishareread.com/">http://xiejava.ishareread.com/</a></p><center> <br><p><img src="http://image2.ishareread.com/images/fullbug%E5%BE%AE%E4%BF%A1%E5%85%AC%E4%BC%97%E5%8F%B7.jpg" alt="“fullbug”微信公众号" title="“fullbug”微信公众号"> </p><p>关注：微信公众号,一起学习成长！</center></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;Wazuh是一个功能强大的开源安全平台，它集成了安全信息与事件管理（SIEM）和扩展检测与响应（XDR）的能力，旨在为本地、虚拟化、容器化及云环境中的工作负载提供统一的威胁预防、检测和响应解决方案。&lt;/p&gt;
&lt;p&gt;Wazuh的核心能力如下：&lt;/p&gt;
&lt;table&gt;
&lt;the
      
    
    </summary>
    
    
      <category term="技术" scheme="http://xiejava.ishareread.com/categories/%E6%8A%80%E6%9C%AF/"/>
    
      <category term="网络安全" scheme="http://xiejava.ishareread.com/categories/%E6%8A%80%E6%9C%AF/%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8/"/>
    
    
      <category term="网络安全" scheme="http://xiejava.ishareread.com/tags/%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8/"/>
    
  </entry>
  
  <entry>
    <title>Easytier快速实现异地组网</title>
    <link href="http://xiejava.ishareread.com/posts/d2b2ee39/"/>
    <id>http://xiejava.ishareread.com/posts/d2b2ee39/</id>
    <published>2025-08-30T07:51:04.000Z</published>
    <updated>2025-12-10T07:13:20.610Z</updated>
    
    <content type="html"><![CDATA[<p>玩NAS的小伙伴在安装完NAS系统后都在折腾“回家”，NAS是放在家里的设备，如何在外面方便的访问家里的主机设备是很多小伙伴面临的课题。“回家”的办法有很多，今天主要介绍我个人觉得很方便的Easytier来快速实现异地组网在外面访问家里的设备。</p><h2 id="一、什么是Easytier"><a href="#一、什么是Easytier" class="headerlink" title="一、什么是Easytier"></a>一、什么是Easytier</h2><p>EasyTier 是一款简单、安全、去中心化的内网穿透和异地组网工具，适合远程办公、异地访问、游戏加速等多种场景。无需公网 IP，无需复杂配置，轻松实现不同地点设备间的安全互联。</p><h2 id="二、飞牛NAS安装Easytier"><a href="#二、飞牛NAS安装Easytier" class="headerlink" title="二、飞牛NAS安装Easytier"></a>二、飞牛NAS安装Easytier</h2><p>在飞牛NAS的镜像仓库中找到下载量最大的easytier斤镜像进行安装<br><img src="http://image2.ishareread.com/images/2025/20250830/1-%E9%A3%9E%E7%89%9Bnas-docker.png" alt="\[图片\]"></p><p>在启动容器时设置使用高权限执行容器<br><img src="http://image2.ishareread.com/images/2025/20250830/2-easytier-docker%E9%AB%98%E6%9D%83%E9%99%90%E9%85%8D%E7%BD%AE.png" alt="\[图片\]"></p><p>在“命令”输入框中输入</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">--network-name &lt;你的虚拟网络名称&gt;</span><br><span class="line">--network-secret &lt;你的网络密码，随便输入，后面加入网络的要用到&gt;</span><br><span class="line">-p tcp://public.easytier.top:11010</span><br><span class="line">--ipv4 10.10.10.3</span><br><span class="line">-n 192.168.0.0/24(这里换成自己的内网的网段)</span><br></pre></td></tr></table></figure><p>这是一个用于连接到一个现有 EasyTier 网络的客户端节点的典型配置。<br><img src="http://image2.ishareread.com/images/2025/20250830/3-easytier-docker%E5%91%BD%E4%BB%A4%E9%85%8D%E7%BD%AE.png" alt="\[图片\]"></p><h3 id="参数详解"><a href="#参数详解" class="headerlink" title="参数详解"></a>参数详解</h3><ol><li><code>--network-name 你的虚拟网络名称</code> <ul><li>含义： 指定要加入的虚拟网络的名称。</li><li>解释： 所有要组成同一个虚拟局域网（VLAN）的节点（客户端和超级节点）必须使用完全相同的网络名称。如网络名为 xiejava。这相当于一个共享的“房间号”或“频道号”，只有名称相同的节点才能互相发现和通信。</li></ul></li><li><code>--network-secret 你的网络密码</code><ul><li>含义： 用于验证和加密网络通信的密钥（密码）。</li><li>解释： 所有加入同一网络的节点必须使用完全相同的密钥。它有两个主要作用：<ul><li>身份认证： 防止未经授权的节点随意加入你的私有网络。</li><li>通信加密： 对节点之间传输的数据进行加密，保障通信安全。因此，一个强密码非常重要。</li></ul></li></ul></li><li><code>-p tcp://public.easytier.top:11010</code><ul><li>含义： 指定要连接的上层节点（Super Node）的地址。</li><li>解释：<ul><li>-p 是 –peer 的简写形式。</li><li>tcp:// 表示使用 TCP 协议进行连接。</li><li>public.easytier.top:11010 是超级节点的地址和端口。这是一个部署在公网上的服务器，它的作用是帮助位于不同内网中的客户端节点（比如你的这台机器）进行“打洞”和中转连接。</li></ul></li><li>简单来说，这个参数告诉你的客户端：“请去这个地址找中介服务器，它会帮你联系网络里的其他伙伴。”</li></ul></li><li><code>--ipv4 10.10.10.3</code><ul><li>含义： 指定本节点在虚拟网络中使用的静态 IPv4 地址。</li><li>解释： 加入虚拟网络后，你的机器会拥有两个IP地址：一个是物理网卡的真实地址（如 192.168.1.100），另一个就是这个虚拟地址 10.10.10.3。网络中的其他设备将通过这个 10.10.10.3 的地址来访问你的机器。使用静态IP可以方便地管理和访问特定的设备。</li></ul></li><li><code>-n 192.168.0.0/24</code><ul><li>含义： 为虚拟网络添加一条静态路由规则。</li><li>解释：<ul><li>-n 是 –route 的简写形式，用于添加路由。</li><li>192.168.0.0/24 是一个网段。这条命令的意思是：“所有发往 192.168.0.0/24 这个网段的数据包，都请通过本机的 EasyTier 虚拟网卡发送（即通过 EasyTier 虚拟网络来路由）。”</li></ul></li><li>用途： 假设你家里的本地局域网网段是 192.168.0.0/24，你在这台机器上添加了这条路由。那么，当网络中的其他节点（如 10.10.10.2）想访问你内网的服务器（如 192.168.0.100）时，它们的数据包会发到你这台机器（10.10.10.3），然后由你这台机器利用本地物理网络转发到 192.168.0.100。这样就实现了从异地访问公司内网资源的功能。这通常是在作为“网关”或提供路由服务的节点上配置的。</li></ul></li></ol><h3 id="配置总结"><a href="#配置总结" class="headerlink" title="配置总结"></a>配置总结</h3><p>这条完整的命令配置了一个 EasyTier 客户端，其作用是：</p><ol><li>加入一个名为 “虚拟网络名”、密码为 “你的虚拟网络密码” 的私有虚拟网络。</li><li>通过连接公网上的超级节点 public.easytier.top:11010 来与其他节点建立联系。</li><li>它在本虚拟网络中的固定IP地址是 10.10.10.3。</li><li>它同时宣布了自己可以为整个虚拟网络提供到 192.168.0.0/24 网段的路由服务，其他节点要访问这个网段的数据都会经过它。</li></ol><p>简单来说，将这台NAS机器作为家里网络内部的节点，它既加入了虚拟网络（地址 10.10.10.3），又扮演了让外部能够访问内部 192.168.0.x 服务器的“网关”角色。</p><h2 id="三、Easytier快速组网异地访问"><a href="#三、Easytier快速组网异地访问" class="headerlink" title="三、Easytier快速组网异地访问"></a>三、Easytier快速组网异地访问</h2><p>Easytier提供了多种符合各类操作系统的工具包括linux、window、MacOS、Android 等，下面以window为例，到官网<a href="https://easytier.rs/guide/download.html下载window的Easytier" target="_blank" rel="noopener">https://easytier.rs/guide/download.html下载window的Easytier</a> GUI。<br>在window机器上进行安装后打开Easytier GUI界面进行设置<br>在网络名称和网络密码中分别设置成在飞牛NAS中Easytier docker容器中命令中指定的网络名称和网络密码。<br><img src="http://image2.ishareread.com/images/2025/20250830/4-easytier-window%E7%BB%84%E7%BD%91.png" alt="\[图片\]"></p><p>设置完成后点击“运行网络”，稍等一会就发现节点信息中本机和飞牛NAS中的easytier都连上来了。<br><img src="http://image2.ishareread.com/images/2025/20250830/5-easytier-window%E7%BB%84%E7%BD%91%E6%88%90%E5%8A%9F.png" alt="\[图片\]"></p><p>可以看到运行window的Easytier GUI的机器在外面连的是手机热点的网络，可以ping通家里内网的IP，可以畅快的访问家里的网络了。<br><img src="http://image2.ishareread.com/images/2025/20250830/6-easytier%E7%BB%84%E7%BD%91%E6%95%88%E6%9E%9C.png" alt="\[图片\]"></p><h2 id="四、Easytier的适用场景"><a href="#四、Easytier的适用场景" class="headerlink" title="四、Easytier的适用场景"></a>四、Easytier的适用场景</h2><ul><li>远程办公：让公司、家中和外地的电脑像在同一局域网一样互通。</li><li>异地访问：随时随地安全访问家中 NAS、服务器或其他设备。</li><li>游戏加速：组建虚拟局域网，畅玩联机游戏。</li><li>物联网组网：让分布在不同地点的设备安全互联。</li></ul><hr><p>作者博客：<a href="http://xiejava.ishareread.com/">http://xiejava.ishareread.com/</a></p><center> <br><p><img src="http://image2.ishareread.com/images/fullbug%E5%BE%AE%E4%BF%A1%E5%85%AC%E4%BC%97%E5%8F%B7.jpg" alt="“fullbug”微信公众号" title="“fullbug”微信公众号"> </p><p>关注：微信公众号,一起学习成长！</center></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;玩NAS的小伙伴在安装完NAS系统后都在折腾“回家”，NAS是放在家里的设备，如何在外面方便的访问家里的主机设备是很多小伙伴面临的课题。“回家”的办法有很多，今天主要介绍我个人觉得很方便的Easytier来快速实现异地组网在外面访问家里的设备。&lt;/p&gt;
&lt;h2 id=&quot;一、
      
    
    </summary>
    
    
      <category term="技术" scheme="http://xiejava.ishareread.com/categories/%E6%8A%80%E6%9C%AF/"/>
    
    
      <category term="NAS" scheme="http://xiejava.ishareread.com/tags/NAS/"/>
    
  </entry>
  
  <entry>
    <title>为搞清楚凌晨上网都在干啥，我建了一套AI上网行为分析系统</title>
    <link href="http://xiejava.ishareread.com/posts/80e87a29/"/>
    <id>http://xiejava.ishareread.com/posts/80e87a29/</id>
    <published>2025-08-10T10:57:20.000Z</published>
    <updated>2025-12-10T07:13:20.558Z</updated>
    
    <content type="html"><![CDATA[<p>近期小孩放假在家，发现晚上还抱着平板不放，每天搞到凌晨。这得要劝说有正常的作息时间，少拿平板做与学习无关的事情，但又不能强制拿平板检查看在哪些时间段都在干啥。于是为了搞清楚其凌晨上网都在干啥，我建了一套AI上网行为分析系统，随时收到上网行为的分析报告。</p><p>原理很简单，通过Alloy采集路由器的上网行为日志，用Loki进行日志存储，然后通过n8n建立AI分析工作流，通过Loki的API接口定期获取上网行为日志，给AI大模型进行分析整理然后自动将上网行为分析结果整理发邮件出来。</p><p>原理图如下：</p><p><img src="http://image2.ishareread.com/images/2025/2025081002/1-%E7%94%A8%E6%88%B7%E4%B8%8A%E7%BD%91%E8%A1%8C%E4%B8%BA%E5%88%86%E6%9E%90%E5%8E%9F%E7%90%86%E5%9B%BE.png" alt="上网行为分析系统"></p><p>接下来看如何实现的完整过程。</p><h2 id="一、上网行为的日志采集"><a href="#一、上网行为的日志采集" class="headerlink" title="一、上网行为的日志采集"></a>一、上网行为的日志采集</h2><p>要采集上网行为的日志，需要在路由器上进行配置，将上网行为的日志通过syslog的方式外发出来。这里可以参考《<a href="https://xiejava.blog.csdn.net/article/details/149515943" target="_blank" rel="noopener">通过TPLink路由器进行用户行为审计实战</a>》<br>另外需要有一套日志分析系统进行采集、存储。这里可以参考《<a href="https://xiejava.blog.csdn.net/article/details/150145269" target="_blank" rel="noopener">Loki+Alloy+Grafana构建轻量级的日志分析系统</a>》</p><h2 id="二、上网行为的自动分析"><a href="#二、上网行为的自动分析" class="headerlink" title="二、上网行为的自动分析"></a>二、上网行为的自动分析</h2><p>基于前面介绍的采集到的上网行为数据，我们基于n8n来构建利用LLM大模型的分析能力实现上网行为的分析和整理。<br>关于如何搭建本地的n8n平台可以参考《<a href="https://blog.csdn.net/fullbug/article/details/149696653" target="_blank" rel="noopener">飞牛NAS本地化部署n8n打造个人AI工作流中心</a>》<br>整个n8n的工作流如下图所示：</p><p><img src="http://image2.ishareread.com/images/2025/2025081002/2-n8n%E5%B7%A5%E4%BD%9C%E6%B5%81%E6%B5%81%E7%A8%8B%E5%9B%BE.png" alt="n8n工作流"></p><h3 id="1、获取上网行为的数据-HTTP-Request"><a href="#1、获取上网行为的数据-HTTP-Request" class="headerlink" title="1、获取上网行为的数据(HTTP Request)"></a>1、获取上网行为的数据(HTTP Request)</h3><p>n8n提供了Http Request节点，可以很方便的调用Http的API接口获取数据。而Loki也是很贴心的提供Http的API接口进行数据的查询。<br>n8n的Http Request节点配置如下，通过Get方法调用loki的查询接口地址<code>http://192.168.0.30:3100/loki/api/v1/query_range</code>，查询条件设置<code>{exporter=&quot;OTLP&quot;} != &quot;apptype:网络基础协议&quot;</code> 意思是排除掉apptype:网络基础协议，因为这部分不是用户的上网行为信息。设置查近2个小时的2000条日志信息。因为用的是开源LLM大模型，一次性处理token的数量有限。如果模型能力强可以设置查更多的数据。</p><p><img src="http://image2.ishareread.com/images/2025/2025081002/3-httpRequst%E9%85%8D%E7%BD%AE.png" alt="HTTP Request"></p><p>点击“Execute step”就可以看到通过loki的API接口查到的上网行为的结果数据。</p><p><img src="http://image2.ishareread.com/images/2025/2025081002/4-httpRequst%E6%89%A7%E8%A1%8C%E7%BB%93%E6%9E%9C%E5%9B%BE.png" alt="API接口查到的上网行为的结果数据"></p><h3 id="2、通过AI智能体进行行为分析-AI-Agent"><a href="#2、通过AI智能体进行行为分析-AI-Agent" class="headerlink" title="2、通过AI智能体进行行为分析(AI Agent)"></a>2、通过AI智能体进行行为分析(AI Agent)</h3><p>我们要将上网行为的数据交给LLM大模型来进行分析，所以要引入AI智能体的节点。在AI Agent接口，把HTTP Request的结果给AI Agent，然后给出提示词。提示词就是告诉AI大模型要做什么。<br>我的提示词如下：</p><blockquote><p>“你是一个安全分析专家，根据日志信息能够分析用户的异常行为，请根据得到信息进行用户行为分析，分析发现是否有异常的行为。请特别注意分析凌晨0点至5点时间段，如有用户在此时间段有上网行为，请详细分析在该时间段用了多少时间做了什么。”</p></blockquote><p><img src="http://image2.ishareread.com/images/2025/2025081002/5-AIAgent%E9%85%8D%E7%BD%AE.png" alt="AI Agent配置"></p><p>在这里我用的大模型是google的Gemini2.5flash。 </p><p><img src="http://image2.ishareread.com/images/2025/2025081002/6-LLM%E5%A4%A7%E6%A8%A1%E5%9E%8B%E9%85%8D%E7%BD%AE.png" alt="大模型配置"></p><p>配置Gemini2.5flash的API key就可以使用了Gemini2.5了。如何白嫖Gemini可以参考《<a href="https://xiejava.blog.csdn.net/article/details/149178997" target="_blank" rel="noopener">国内免代理免费使用Gemini大模型实战</a>》和《<a href="https://xiejava.blog.csdn.net/article/details/149257107" target="_blank" rel="noopener">使用Gemini Balance让Gemini免费到底</a>》</p><p><img src="http://image2.ishareread.com/images/2025/2025081002/7-Gemini%E7%9A%84APIKey%E9%85%8D%E7%BD%AE.png" alt="API key配置"></p><p>当然也可以配置成其他的大模型。</p><h3 id="3、整理分析结果-Markdown"><a href="#3、整理分析结果-Markdown" class="headerlink" title="3、整理分析结果(Markdown)"></a>3、整理分析结果(Markdown)</h3><p>通过Markdown节点将大模型分析出来的结果进行美化整理成HTML的格式</p><p><img src="http://image2.ishareread.com/images/2025/2025081002/8-markdown%E8%BD%AChtml.png" alt="Markdown节点"></p><h3 id="4、自动发邮件报告-Send-Mail"><a href="#4、自动发邮件报告-Send-Mail" class="headerlink" title="4、自动发邮件报告(Send Mail)"></a>4、自动发邮件报告(Send Mail)</h3><p>加入自动发邮件的节点，将用户上网行为的分析报告通过邮件的方式发送出来。<br>配置SMTP account信息。<br>关于如何配置SMTP 信息可以参考以前的博文《<a href="https://xiejava.blog.csdn.net/article/details/128495415" target="_blank" rel="noopener">通过Django发送邮件</a>》里面有详细的介绍。</p><p><img src="http://image2.ishareread.com/images/2025/2025081002/9-SMTPaccount%E9%85%8D%E7%BD%AE.png" alt="SMTP配置"></p><p>配置邮件的发送者和接收者，邮件主题等信息。</p><p><img src="http://image2.ishareread.com/images/2025/2025081002/10-sendmail%E9%85%8D%E7%BD%AE.png" alt="配置sendmail"></p><h3 id="5、配置AI工作流定时启动-Schedule-Trigger"><a href="#5、配置AI工作流定时启动-Schedule-Trigger" class="headerlink" title="5、配置AI工作流定时启动(Schedule Trigger)"></a>5、配置AI工作流定时启动(Schedule Trigger)</h3><p>将n8n的工作流配置为Schedule Trigger根据周期定时触发，我这里设置的是每两个小时触发一次。</p><p><img src="http://image2.ishareread.com/images/2025/2025081002/11-ScheduleTrigger%E9%85%8D%E7%BD%AE.png" alt="Schedule Trigger"></p><h2 id="三、上网行为分析报告及效果"><a href="#三、上网行为分析报告及效果" class="headerlink" title="三、上网行为分析报告及效果"></a>三、上网行为分析报告及效果</h2><p>将n8n的工作流激活后，AI用户上网行为分析系统就开始勤勤恳恳的工作了。</p><p><img src="http://image2.ishareread.com/images/2025/2025081002/12-%E6%BF%80%E6%B4%BBn8n%E5%B7%A5%E4%BD%9C%E6%B5%81.png" alt="activate工作流"></p><p>每两个小时从路由器获取上网行为的日志，通过大模型进行上网行为的分析，整理后自动发邮件进行报告了。</p><p><img src="http://image2.ishareread.com/images/2025/2025081002/13-n8n%E5%B7%A5%E4%BD%9C%E6%B5%81%E8%BF%90%E8%A1%8C%E6%83%85%E5%86%B5.png" alt="执行情况"></p><p>最后看一下经过大模型分析的上网行为分析报告</p><p><img src="http://image2.ishareread.com/images/2025/2025081002/14-AI%E4%B8%8A%E7%BD%91%E8%A1%8C%E4%B8%BA%E5%88%86%E6%9E%90%E6%8A%A5%E5%91%8A.png" alt="上网行为分析报告"></p><p>也可以配置到网易邮箱大师通过手机收到上网行为分析报告的邮件通知了。</p><p><img src="http://image2.ishareread.com/images/2025/2025081002/14-%E6%89%8B%E6%9C%BA%E7%AB%AF%E7%9A%84%E4%B8%8A%E7%BD%91%E8%A1%8C%E4%B8%BA%E5%88%86%E6%9E%90%E6%8A%A5%E5%91%8A.png" alt="手机端报告"></p><p>至此，我们通过综合运用alloy+loki构建了日志采集系统采集路由器的用户行为日志，通过n8n构建AI工作流调用Gemini大模型进行用户行为的分析自动发送上网行为的分析报告，构建了自动化的上网行为分析系统。</p><hr><p>作者博客：<a href="http://xiejava.ishareread.com/">http://xiejava.ishareread.com/</a></p><center> <br><p><img src="http://image2.ishareread.com/images/fullbug%E5%BE%AE%E4%BF%A1%E5%85%AC%E4%BC%97%E5%8F%B7.jpg" alt="“fullbug”微信公众号" title="“fullbug”微信公众号"> </p><p>关注：微信公众号,一起学习成长！</center></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;近期小孩放假在家，发现晚上还抱着平板不放，每天搞到凌晨。这得要劝说有正常的作息时间，少拿平板做与学习无关的事情，但又不能强制拿平板检查看在哪些时间段都在干啥。于是为了搞清楚其凌晨上网都在干啥，我建了一套AI上网行为分析系统，随时收到上网行为的分析报告。&lt;/p&gt;
&lt;p&gt;原理很
      
    
    </summary>
    
    
      <category term="技术" scheme="http://xiejava.ishareread.com/categories/%E6%8A%80%E6%9C%AF/"/>
    
      <category term="网络安全" scheme="http://xiejava.ishareread.com/categories/%E6%8A%80%E6%9C%AF/%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8/"/>
    
    
      <category term="网络安全" scheme="http://xiejava.ishareread.com/tags/%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8/"/>
    
      <category term="AI机器学习" scheme="http://xiejava.ishareread.com/tags/AI%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/"/>
    
  </entry>
  
  <entry>
    <title>Loki+Alloy+Grafana构建轻量级的日志分析系统</title>
    <link href="http://xiejava.ishareread.com/posts/9804ee9f/"/>
    <id>http://xiejava.ishareread.com/posts/9804ee9f/</id>
    <published>2025-08-10T04:50:25.000Z</published>
    <updated>2025-12-10T07:13:20.509Z</updated>
    
    <content type="html"><![CDATA[<p>在现代运维和开发流程中，日志分析是故障排查、性能优化的核心环节。传统的日志系统（如 ELK Stack）虽功能强大，但资源消耗高、配置复杂，对中小规模环境或边缘设备不够友好。Loki+Alloy+Grafana组合则以 “轻量级、低成本、易部署” 为核心优势，成为替代方案的理想选择。</p><p>典型的基于 Loki 的日志记录技术栈由 3 个组件组成：</p><p><img src="http://image2.ishareread.com/images/2025/20250810/1-LAG%E6%9E%B6%E6%9E%84.png" alt="Loki"></p><ul><li>Loki：Grafana Labs 开源的日志聚合系统，借鉴 Prometheus 设计理念，仅索引日志元数据（标签）而非全文，大幅降低存储和计算开销。</li><li>Alloy：代理或客户端，Grafana 官方推荐的新一代数据采集器Alloy（替代 Promtail），支持日志、指标、追踪多信号采集，配置灵活且资源占用低。</li><li>Grafana：强大的可视化平台，原生支持 Loki 数据源，提供丰富的日志查询、过滤和仪表盘功能。</li></ul><p>对网络设备、安全设备等的告警日志进行分析是在网络运维和安全运营中经常遇到的场景，我们可以通过Loki+Alloy+Grafana来搭建一套轻量级的日志分析系统来收集各类网络设备、安全设备的日志进行分析。现在就以采集TP-Link路由器的上网行为日志为例来构建这套日志分析系统。</p><p><img src="http://image2.ishareread.com/images/2025/20250810/2-%E6%97%A5%E5%BF%97%E9%87%87%E9%9B%86%E5%AD%98%E5%82%A8%E5%88%86%E6%9E%90.png" alt="日志采集分析"></p><p>本文将详细介绍在Ubuntu 24.04 LTS环境中，从零搭建这套日志分析系统的全过程，确保每个步骤可操作、可复现。</p><p>环境准备：Ubuntu 24.04 系统配置<br>系统要求</p><ul><li>硬件：2 核 CPU、4GB 内存、20GB 磁盘（日志存储根据需求调整）</li><li>系统：Ubuntu 24.04 LTS（已更新至最新版本）</li><li>权限：sudo 权限（用于安装软件和配置服务）</li></ul><p>根据Grafana官网的建议步骤，先安装Loki，再部署采集代理Alloy,再部署Grafana，通过Grafana来分析日志。</p><p><img src="http://image2.ishareread.com/images/2025/20250810/3-LAG%E6%97%A5%E5%BF%97%E7%B3%BB%E7%BB%9F%E5%AE%89%E8%A3%85%E6%AD%A5%E9%AA%A4.png" alt="日志采集步骤"></p><h2 id="部署Loki日志存储系统"><a href="#部署Loki日志存储系统" class="headerlink" title="部署Loki日志存储系统"></a>部署Loki日志存储系统</h2><p>Loki 是日志的 “后端存储”，负责接收、存储日志并响应查询请求。采用二进制方式部署，步骤如下：</p><h3 id="1-下载Loki二进制文件"><a href="#1-下载Loki二进制文件" class="headerlink" title="1. 下载Loki二进制文件"></a>1. 下载Loki二进制文件</h3><p>通过 GitHub API 获取Loki的二进制安装包：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 创建Loki安装目录并下载二进制包  这里安装的是3.5.1 </span></span><br><span class="line">sudo mkdir -p /opt/loki /etc/loki</span><br><span class="line">wget -qO /opt/loki/loki-linux-amd64.zip <span class="string">"https://github.com/grafana/loki/releases/download/v3.5.1/loki-linux-amd64.zip"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 解压并设置可执行权限</span></span><br><span class="line">sudo unzip -d /opt/loki /opt/loki/loki-linux-amd64.zip &amp;&amp; rm /opt/loki/loki-linux-amd64.zip</span><br><span class="line">sudo chmod a+x /opt/loki/loki-linux-amd64</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建软链接，方便全局调用</span></span><br><span class="line">sudo ln -s /opt/loki/loki-linux-amd64 /usr/<span class="built_in">local</span>/bin/loki</span><br></pre></td></tr></table></figure><p>查看Loki版本 <code>loki --version</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">loki --version</span><br><span class="line">loki, version 3.5.1 (branch: release-3.5.x, revision: d4e637ce)</span><br><span class="line">  build user:       root@ceaea196ea87</span><br><span class="line">  build date:       2025-05-19T17:06:03Z</span><br><span class="line">  go version:       go1.24.1</span><br><span class="line">  platform:         linux/amd64</span><br><span class="line">  tags:             netgo</span><br></pre></td></tr></table></figure><h3 id="2-配置-Loki"><a href="#2-配置-Loki" class="headerlink" title="2. 配置 Loki"></a>2. 配置 Loki</h3><p>使用官方提供的本地存储配置文件，创建 Loki 配置目录并下载默认配置文件：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo mkdir -p /etc/loki</span><br><span class="line">sudo wget https://raw.githubusercontent.com/grafana/loki/v3.5.1/cmd/loki/loki-local-config.yaml -O /etc/loki/config.yaml</span><br></pre></td></tr></table></figure><h3 id="3-创建-Systemd-服务"><a href="#3-创建-Systemd-服务" class="headerlink" title="3. 创建 Systemd 服务"></a>3. 创建 Systemd 服务</h3><p>为 Loki 创建系统服务，确保开机自启和进程管理：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">sudo tee /etc/systemd/system/loki.service &lt;&lt;EOF</span><br><span class="line">Description=Grafana Loki Log Aggregation System</span><br><span class="line">After=network.target </span><br><span class="line"></span><br><span class="line">[Service]</span><br><span class="line">Type=simple</span><br><span class="line">ExecStart=/usr/<span class="built_in">local</span>/bin/loki -config.file=/etc/loki/config.yaml</span><br><span class="line">Restart=on-failure </span><br><span class="line">User=root </span><br><span class="line"></span><br><span class="line">[Install]</span><br><span class="line">WantedBy=multi-user.target </span><br><span class="line">EOF<span class="comment"># 重载systemd配置并启动Loki</span></span><br><span class="line"></span><br><span class="line">sudo systemctl daemon-reload</span><br><span class="line">sudo systemctl start loki</span><br><span class="line">sudo systemctl <span class="built_in">enable</span> loki</span><br><span class="line"><span class="comment"># 验证服务状态（应显示active (running)）</span></span><br><span class="line">sudo systemctl status loki</span><br></pre></td></tr></table></figure><p>可以使用 <code>journalctl -u loki -f</code> 查看 Loki 日志以进行故障排除</p><h3 id="4-验证-Loki-运行"><a href="#4-验证-Loki-运行" class="headerlink" title="4.  验证 Loki 运行"></a>4.  验证 Loki 运行</h3><p>通过 HTTP 接口检查 Loki 状态：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl http://127.0.0.1:3100/ready</span><br></pre></td></tr></table></figure><p>预期输出：ready（表示 Loki 已就绪）</p><p><img src="http://image2.ishareread.com/images/2025/20250810/4-loki-ready.png" alt="loki ready"></p><h2 id="部署配置Alloy"><a href="#部署配置Alloy" class="headerlink" title="部署配置Alloy"></a>部署配置Alloy</h2><p>Alloy 是连接日志源与 Loki 的 “桥梁”，负责采集服务器本地日志并发送到 Loki。作为 Grafana Agent 的替代者，Alloy 配置更灵活，支持多信号采集。</p><h3 id="1-安装-Alloy"><a href="#1-安装-Alloy" class="headerlink" title="1. 安装 Alloy"></a>1. 安装 Alloy</h3><p>通过 Grafana 官方仓库安装 Alloy（与 Grafana 使用同一仓库，无需重复添加）：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 安装Alloy包</span></span><br><span class="line">sudo apt install -y alloy</span><br><span class="line"></span><br><span class="line"><span class="comment"># 验证安装</span></span><br><span class="line">alloy --version</span><br></pre></td></tr></table></figure><p><img src="http://image2.ishareread.com/images/2025/20250810/5-alloy-version.png" alt="alloy --version"></p><h3 id="2-配置-Alloy-收集日志"><a href="#2-配置-Alloy-收集日志" class="headerlink" title="2. 配置 Alloy 收集日志"></a>2. 配置 Alloy 收集日志</h3><p>Alloy 使用声明式配置文件定义采集规则，默认路径为<code>/etc/alloy/config.alloy</code>。我们需配置：<br>1、 通过syslog采集；2、对日志中的IP进行提取；3、 将日志转发到 Loki。<br>创建配置文件：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">otelcol.receiver.syslog <span class="string">"local"</span> &#123;</span><br><span class="line">  udp &#123;</span><br><span class="line">    listen_address = <span class="string">"0.0.0.0:514"</span></span><br><span class="line">    encoding = <span class="string">"GBK"</span></span><br><span class="line">  &#125;</span><br><span class="line">  output &#123;</span><br><span class="line">    logs = [otelcol.exporter.loki.local.input]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">otelcol.exporter.loki <span class="string">"local"</span> &#123;</span><br><span class="line">  forward_to = [loki.process.extract_ip.receiver]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">loki.process <span class="string">"extract_ip"</span> &#123;</span><br><span class="line">  stage.regex &#123;</span><br><span class="line">    expression = <span class="string">"a:(?P&lt;ip&gt;\\d&#123;1,3&#125;\\.\\d&#123;1,3&#125;\\.\\d&#123;1,3&#125;\\.\\d&#123;1,3&#125;)"</span></span><br><span class="line">  &#125;</span><br><span class="line">  stage.labels &#123;</span><br><span class="line">    values = &#123;</span><br><span class="line">      ip = <span class="string">"ip"</span>,</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  forward_to = [loki.write.local.receiver]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">loki.write <span class="string">"local"</span> &#123;</span><br><span class="line">  endpoint &#123;</span><br><span class="line">    url = <span class="string">"http://localhost:3100/loki/api/v1/push"</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>配置说明：</p><blockquote><p>alloy目前对syslog支持并不是特别好，经过多次尝试，用alloy的syslog组件不能支持中文编码，所以改用通过otelcol的syslog来采集日志。<br>listen_address = “0.0.0.0:514” 表示监听所有源的514端口来的upd数据。</p></blockquote><h3 id="3-启动-Alloy-服务"><a href="#3-启动-Alloy-服务" class="headerlink" title="3. 启动 Alloy 服务"></a>3. 启动 Alloy 服务</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 启动Alloy并设置开机自启</span></span><br><span class="line">sudo systemctl <span class="built_in">enable</span> --now alloy</span><br><span class="line"></span><br><span class="line"><span class="comment"># 验证服务状态（应显示active (running)）</span></span><br><span class="line">sudo systemctl status alloy</span><br></pre></td></tr></table></figure><blockquote><p>排查提示若启动失败，通过sudo journalctl -u alloy -f查看日志，常见问题：配置文件语法错误、Loki未启动导致连接失败</p></blockquote><h2 id="部署Grafana"><a href="#部署Grafana" class="headerlink" title="部署Grafana"></a>部署Grafana</h2><p>Grafana 是整个系统的 “前端”，用于日志查询和可视化。通过官方仓库安装可确保自动更新。</p><h3 id="1-添加-Grafana-官方仓库"><a href="#1-添加-Grafana-官方仓库" class="headerlink" title="1. 添加 Grafana 官方仓库"></a>1. 添加 Grafana 官方仓库</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 导入Grafana GPG密钥（用于验证包完整性）</span></span><br><span class="line">wget -q -O - https://apt.grafana.com/gpg.key | gpg --dearmor | sudo tee /etc/apt/keyrings/grafana.gpg &gt; /dev/null</span><br><span class="line"></span><br><span class="line"><span class="comment"># 添加Grafana OSS仓库（稳定版）</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">'deb [signed-by=/etc/apt/keyrings/grafana.gpg] https://packages.grafana.com/oss/deb stable main'</span> | sudo tee /etc/apt/sources.list.d/grafana.list</span><br></pre></td></tr></table></figure><h3 id="2-安装并启动-Grafana"><a href="#2-安装并启动-Grafana" class="headerlink" title="2. 安装并启动 Grafana"></a>2. 安装并启动 Grafana</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 更新包索引并安装Grafana</span></span><br><span class="line">sudo apt update &amp;&amp; sudo apt install -y grafana</span><br><span class="line"></span><br><span class="line"><span class="comment"># 启动Grafana服务并设置开机自启</span></span><br><span class="line">sudo systemctl <span class="built_in">enable</span> --now grafana-server</span><br><span class="line"></span><br><span class="line"><span class="comment"># 验证服务状态（应显示active (running)）</span></span><br><span class="line">sudo systemctl status grafana-server</span><br></pre></td></tr></table></figure><h3 id="3-验证-Grafana-安装"><a href="#3-验证-Grafana-安装" class="headerlink" title="3.  验证 Grafana 安装"></a>3.  验证 Grafana 安装</h3><p>打开浏览器访问 <code>http://&lt;服务器IP&gt;:3000</code>，首次登录使用默认凭据：</p><ul><li>用户名：admin</li><li>密码：admin</li></ul><p>首次登录会要求修改密码，按提示设置新密码即可。</p><h2 id="接入数据源"><a href="#接入数据源" class="headerlink" title="接入数据源"></a>接入数据源</h2><h3 id="1-在发送端配置采集器的地址"><a href="#1-在发送端配置采集器的地址" class="headerlink" title="1. 在发送端配置采集器的地址"></a>1. 在发送端配置采集器的地址</h3><p>这里我们要接入和分析TP-Link路由器的上网行为日志。所以要在路由器上配置将日志发送到alloy采集节点的服务器。具体的TP-Link路由器的上网行为分析审计的配置参考《<a href="http://xiejava.ishareread.com/posts/e87ac72d/">通过TPLink路由器进行用户行为审计实战</a>》</p><p><img src="http://image2.ishareread.com/images/2025/20250810/6-TPLINK%E9%85%8D%E7%BD%AE.png" alt="行为审计"></p><h3 id="2-在采集端看是否收到数据"><a href="#2-在采集端看是否收到数据" class="headerlink" title="2. 在采集端看是否收到数据"></a>2. 在采集端看是否收到数据</h3><p>通过tcpdump命令查看采集节点是否有日志数据进来</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tcpdump -i ens2 -A port 514</span><br></pre></td></tr></table></figure><p><img src="http://image2.ishareread.com/images/2025/20250810/7-tcpdump.png" alt="tcpdump"></p><p>这里可以看到有日志数据通过ens2网卡的514端口进来了。</p><h2 id="用Grafana查询和分析数据"><a href="#用Grafana查询和分析数据" class="headerlink" title="用Grafana查询和分析数据"></a>用Grafana查询和分析数据</h2><p>在用Grafana进行查询之前先要配置Grafana的数据源添加loki的数据源</p><p><img src="http://image2.ishareread.com/images/2025/20250810/8-new-data-source.png" alt="添加数据源"></p><p>在loki的数据源中设置loki的连接地址</p><p><img src="http://image2.ishareread.com/images/2025/20250810/9-%E9%85%8D%E7%BD%AEloki%E8%BF%9E%E6%8E%A5%E5%9C%B0%E5%9D%80.png" alt="loki连接"></p><p>设置完成后就可以用Grafana强大的分析查询和可视化来对日志进行分析了。</p><p><img src="http://image2.ishareread.com/images/2025/20250810/10-grafana%E5%88%86%E6%9E%90%E5%B1%95%E7%A4%BA.png" alt="日志分析"></p><p>通过本文步骤，我们在 Ubuntu 24.04 上构建了 Loki+Alloy+Grafana 日志分析系统：</p><p>Loki 负责高效存储日志，仅索引元数据降低开销；<br>Alloy 轻量采集系统日志，配置灵活易扩展；<br>Grafana 提供强大的日志查询与可视化能力（支持 LogQL、仪表盘、告警）。</p><p>该架构资源占用低（单节点最低 2 核 4GB 内存即可运行），适合中小规模环境、边缘设备或开发测试场景。后续可扩展至多节点 Loki 集群、添加日志告警规则，或集成 Prometheus 监控指标，构建完整的可观测性平台。</p><hr><p>博客地址：<a href="http://xiejava.ishareread.com/">http://xiejava.ishareread.com/</a></p><center> <br><p><img src="http://image2.ishareread.com/images/fullbug%E5%BE%AE%E4%BF%A1%E5%85%AC%E4%BC%97%E5%8F%B7.jpg" alt="“fullbug”微信公众号" title="“fullbug”微信公众号"> </p><p>关注：微信公众号,一起学习成长！</center></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;在现代运维和开发流程中，日志分析是故障排查、性能优化的核心环节。传统的日志系统（如 ELK Stack）虽功能强大，但资源消耗高、配置复杂，对中小规模环境或边缘设备不够友好。Loki+Alloy+Grafana组合则以 “轻量级、低成本、易部署” 为核心优势，成为替代方案的
      
    
    </summary>
    
    
      <category term="技术" scheme="http://xiejava.ishareread.com/categories/%E6%8A%80%E6%9C%AF/"/>
    
      <category term="网络安全" scheme="http://xiejava.ishareread.com/categories/%E6%8A%80%E6%9C%AF/%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8/"/>
    
    
      <category term="日志分析" scheme="http://xiejava.ishareread.com/tags/%E6%97%A5%E5%BF%97%E5%88%86%E6%9E%90/"/>
    
  </entry>
  
  <entry>
    <title>VScode对Ubuntu用root账号进行SSH远程连接开发</title>
    <link href="http://xiejava.ishareread.com/posts/9880bf27/"/>
    <id>http://xiejava.ishareread.com/posts/9880bf27/</id>
    <published>2025-08-02T13:19:42.000Z</published>
    <updated>2025-12-10T07:13:20.469Z</updated>
    
    <content type="html"><![CDATA[<p>由于linux服务器大部分都是基于命令行的操作，缺乏比较方便好用的编辑工具，对于经常在linux服务器上做开发的同学来说直接在服务器上进行开发或配置文件的修改还不是特别的方便。虽然linux上有vi或vim比起图形化的编辑工具体验感还是不是很好。作为程序员常用的宇宙第一的VScode就提供了相应的插件可以通过ssh远程连接到服务器上直接编辑服务器上相应的文件，极大提高了在服务器上开发或修改配置文件的效率和体验感。本文就来介绍通过VScode对Ubuntu用root账号进行SSH远程连接直接在服务器上进行开发。</p><h2 id="一、安装VScode的ssh扩展插件"><a href="#一、安装VScode的ssh扩展插件" class="headerlink" title="一、安装VScode的ssh扩展插件"></a>一、安装VScode的ssh扩展插件</h2><p>Remote-SSH 扩展 允许你将任何带有 SSH 服务器的远程机器用作你的开发环境。这可以在多种情况下极大地简化开发和故障排除：</p><ul><li>在部署目标操作系统上开发​，或者使用比本地机器更大、更快或更专业化的硬件进行开发。</li><li>轻松切换不同的远程开发环境，并安全地进行更新​，而无需担心影响本地机器。</li><li>从多台机器或不同位置访问现有的开发环境。</li><li>调试运行在其他地方（例如客户现场或云端​）的应用程序。</li></ul><p>在VScode的编辑器界面在Extension中搜索ssh排名前三的Remote-SSH、Remote - SSH: Editing Configuration Files、Remote Explorer是微软官方的ssh扩展插件，都安装一下。</p><p><img src="http://image2.ishareread.com/images/2025/20250802/1-ssh-remote.png" alt="ssh扩展插件"></p><p>安装好了后就会在左侧的导航看到Remote Exploer</p><p><img src="http://image2.ishareread.com/images/2025/20250802/2-remoteExplorer.png" alt="Remote Exploer"></p><p>在SSH中点“+” 后就可以在上面的导航输入框中输入要ssh连接服务器的命令。如:<code>ssh xiejava@192.168.0.30</code> 意思就是通过xiejava的用户名ssh登录到192.168.0.30的服务器。</p><p><img src="http://image2.ishareread.com/images/2025/20250802/3-NewRemote.png" alt="New Remote"></p><p>输入正确的口令后，表示服务器的图标变亮就意味着已经通过SSH连上了服务器了。</p><p><img src="http://image2.ishareread.com/images/2025/20250802/4-SSH%E8%BF%9E%E4%B8%8A%E4%BA%86%E6%9C%8D%E5%8A%A1%E5%99%A8.png" alt="SSH连上了服务器"></p><p>连上服务器后就可以通过命令来对服务器进行操作，也可以直接打开服务器上的文件进行操作了。</p><p><img src="http://image2.ishareread.com/images/2025/20250802/5-%E7%9B%B4%E6%8E%A5%E6%89%93%E5%BC%80%E6%9C%8D%E5%8A%A1%E5%99%A8%E4%B8%8A%E7%9A%84%E6%96%87%E4%BB%B6%E8%BF%9B%E8%A1%8C%E6%93%8D%E4%BD%9C.png" alt="直接打开服务器上的文件进行操作"></p><p>这样就可以直接在服务器上直接编辑文件，直接在命令行中输入命令执行，直接看到执行结果，简直不要太爽。</p><p><img src="http://image2.ishareread.com/images/2025/20250802/6-%E7%9B%B4%E6%8E%A5%E7%BC%96%E8%BE%91%E6%96%87%E4%BB%B6.png" alt="直接编辑文件"></p><p>一般的教程到这里就结束了。但是有些Linux是默认不能使用root用户登录的如Ubuntu，如果不用root用户登录只能访问到登录用户的文件夹，如我是用xiejava登录的就只能访问到/home/xiejava的目录，只能在这个目录下新建和编辑相应的文件，而且每次打开编辑操作文件都要输入登录密码，作为服务器上的开发来说这显然是不可接受的。所以我们要用root账号进行ssh进行远程连接。</p><h2 id="二、开启Ubuntu的root账号免密登录"><a href="#二、开启Ubuntu的root账号免密登录" class="headerlink" title="二、开启Ubuntu的root账号免密登录"></a>二、开启Ubuntu的root账号免密登录</h2><h3 id="1、生成SSH密钥对，并部署到服务器"><a href="#1、生成SSH密钥对，并部署到服务器" class="headerlink" title="1、生成SSH密钥对，并部署到服务器"></a>1、生成SSH密钥对，并部署到服务器</h3><p>要使 root 用户成功登录，需先在客户端生成 SSH 密钥对，并将公钥部署到服务器：</p><ol><li>客户端生成密钥 (在本地PC执行)：</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh-keygen -t ed25519 -C <span class="string">"root_ssh_key"</span></span><br></pre></td></tr></table></figure><ul><li>按提示选择保存路径（默认 C:\Users\你的用户名.ssh\id_ed25519）。</li><li>连续按 3 次回车​，不设密码（实现完全免密）<br>最后在文件夹中生成SSH密钥对<br><img src="http://image2.ishareread.com/images/2025/20250802/7-%E7%94%9F%E6%88%90%E5%AF%86%E9%92%A5%E5%AF%B9.png" alt="生成SSH密钥对"></li></ul><ol start="2"><li>部署公钥到服务器​：<br>登录 Ubuntu<br>创建 .ssh 目录并写入公钥</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">mkdir -p ~/.ssh</span><br><span class="line"><span class="built_in">echo</span> <span class="string">"粘贴复制的公钥内容，也就是id_ed25519.pub文件里面的内容"</span> &gt;&gt; ~/.ssh/authorized_keys</span><br><span class="line">chmod 700 ~/.ssh</span><br><span class="line">chmod 600 ~/.ssh/authorized_keys</span><br></pre></td></tr></table></figure><h3 id="2、测试免密登录"><a href="#2、测试免密登录" class="headerlink" title="2、测试免密登录"></a>2、测试免密登录</h3><p>在 Windows PowerShell 执行：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh 用户名@Ubuntu_IP</span><br></pre></td></tr></table></figure><ul><li>成功标志​：直接登录 Ubuntu，无需输入密码。</li><li>失败表现​：提示输入密码或返回 Permission denied。</li></ul><h3 id="3、启用root用户"><a href="#3、启用root用户" class="headerlink" title="3、启用root用户"></a>3、启用root用户</h3><p>使用当前具有 sudo 权限的用户登录系统。执行密码修改命令</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo passwd root</span><br></pre></td></tr></table></figure><ul><li>输入当前用户的密码​（用于 sudo 提权）。</li><li>输入新的 root 密码​（输入时不会显示字符）。</li><li>再次确认新密码。<br>禁用root密码登录（增强安全）​</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo vim /etc/ssh/sshd_config</span><br></pre></td></tr></table></figure><p>设置<code>PermitRootLogin prohibit-password</code><br><img src="http://image2.ishareread.com/images/2025/20250802/8-PermitRootLogin.png" alt="PermitRootLogin prohibit-password"></p><p>重启<code>systemctl restart ssh</code></p><h3 id="4、找到本地的ssh配置文件并配置密钥登录"><a href="#4、找到本地的ssh配置文件并配置密钥登录" class="headerlink" title="4、找到本地的ssh配置文件并配置密钥登录"></a>4、找到本地的ssh配置文件并配置密钥登录</h3><p>在vscode中点击SSH旁边的配置按钮就会出现ssh本地的配置文件，一般是<code>C:\Users\你的用户名\.ssh\config</code></p><p><img src="http://image2.ishareread.com/images/2025/20250802/9-ssh%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6.png" alt="找到本地的ssh配置文件"></p><p>在config文件中配置User root 和IdentityFile 密钥文件的路径。</p><p><img src="http://image2.ishareread.com/images/2025/20250802/10-config%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6.png" alt="配置"></p><p>这样就可以通过root进入到任何目录操作编辑任何文件了。</p><p><img src="http://image2.ishareread.com/images/2025/20250802/11-%E8%BF%9B%E5%85%A5%E4%BB%BB%E4%BD%95%E7%9B%AE%E5%BD%95%E7%BC%96%E8%BE%91.png" alt="root免密登录"></p><p>最后要提醒大家的是大家在修改任何配置文件的时候要注意备份和确认，因为获得了root权限可以操作编辑任何文件了。</p><hr><p>博客地址：<a href="http://xiejava.ishareread.com/">http://xiejava.ishareread.com/</a></p><center> <br><p><img src="http://image2.ishareread.com/images/fullbug%E5%BE%AE%E4%BF%A1%E5%85%AC%E4%BC%97%E5%8F%B7.jpg" alt="“fullbug”微信公众号" title="“fullbug”微信公众号"> </p><p>关注：微信公众号,一起学习成长！</center></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;由于linux服务器大部分都是基于命令行的操作，缺乏比较方便好用的编辑工具，对于经常在linux服务器上做开发的同学来说直接在服务器上进行开发或配置文件的修改还不是特别的方便。虽然linux上有vi或vim比起图形化的编辑工具体验感还是不是很好。作为程序员常用的宇宙第一的V
      
    
    </summary>
    
    
      <category term="技术" scheme="http://xiejava.ishareread.com/categories/%E6%8A%80%E6%9C%AF/"/>
    
      <category term="开发" scheme="http://xiejava.ishareread.com/categories/%E6%8A%80%E6%9C%AF/%E5%BC%80%E5%8F%91/"/>
    
    
      <category term="运维" scheme="http://xiejava.ishareread.com/tags/%E8%BF%90%E7%BB%B4/"/>
    
  </entry>
  
  <entry>
    <title>飞牛NAS本地化部署n8n打造个人AI工作流中心</title>
    <link href="http://xiejava.ishareread.com/posts/e20e4b6a/"/>
    <id>http://xiejava.ishareread.com/posts/e20e4b6a/</id>
    <published>2025-07-27T14:31:38.000Z</published>
    <updated>2025-12-10T07:13:20.421Z</updated>
    
    <content type="html"><![CDATA[<p>n8n是一个开源的工作流自动化工具，类似于Zapier和IFTTT，但它更加灵活和强大 。它允许用户通过图形化界面，以拖拽的形式构建自动化工作流，将不同的应用程序和服务连接起来，实现各种自动化任务 。<br>n8n最初的用途是自动化日常工作流，帮助用户节省时间，提高工作效率。在AI技术出现后，n8n更是成为了连接AI与数字世界的桥梁，因为它能够让AI与超过1000种不同的服务进行交互，几乎使AI能与赛博世界中的任何其他主体畅通无阻。</p><p>n8n的主要优势包括：</p><ul><li><strong>部署简单</strong>：支持Docker一键私有化部署，也提供云服务选项。</li><li><strong>可接入服务强</strong>：集成了超过1000种第三方服务，且自部署版本具备丰富的本地调用能力，可以对本地数据库、文件等进行操作，甚至作为寄生系统为现有业务增添自动化和AI功能。</li><li><strong>对大模型友好</strong>：内置图形可视化的LangChain节点，能够方便地集成各种AI模型、记忆、工具和解析器，支持BYOK（Bring Your Own Key）模式，即用户可以自备API Key来调用AI服务。</li><li><strong>支持半封装模式</strong>：在低代码和代码之间实现了平衡。对于已有的节点，可以拖拽完成接入；对于没有现成节点的功能，支持通过HTTP Request接入几乎任何开放API的第三方服务。同时，其Code节点支持运行JavaScript和Python代码，非常适合与ChatGPT进行结对编程。</li></ul><p>对于个人用户来说，在NAS（网络附加存储）上部署n8n具有多方面的优势：</p><ul><li><strong>完全掌控数据和流程</strong>：n8n是开源的，可以选择将其部署在自己的NAS服务器上，从而完全掌控您的数据和自动化流程，无需担心数据泄露或被供应商锁定。</li><li><strong>部署简单</strong>：n8n的部署过程相对简单，可以通过Docker一键私有化部署，即使是不懂代码的用户也能通过可视化的界面快速上手。</li><li><strong>常态化运行</strong>：NAS通常是7x24小时开机的设备，结合n8n的AI工作流能力，可以帮助个人用户完成日常工作中大量的重复性劳动，例如自动生成日报、周报等，从而释放更多时间用于其他活动。</li><li><strong>随时随地访问</strong>：NAS虽然部署在家里，但是一般都通过ddns或其他方式打通了与外网的连接，可以随时随地方便的构建和调试自己AI工作流应用。</li></ul><p>本文就以我的飞牛NAS为例来部署n8n打造人工的AI工作流中心。</p><h2 id="一、下载n8n的镜像"><a href="#一、下载n8n的镜像" class="headerlink" title="一、下载n8n的镜像"></a>一、下载n8n的镜像</h2><p>在飞牛NAS的Docker镜像仓库中找到n8n的镜像，下载这个下载量和标星最多的n8nio/n8n的镜像。</p><p><img src="http://image2.ishareread.com/images/2025/20250727/1-%E4%B8%8B%E8%BD%BDn8n%E9%95%9C%E5%83%8F.png" alt="下载n8n镜像"></p><p>下载后就可以在飞牛NAS的本地镜像库中看到这个n8nio/n8n镜像。</p><p><img src="http://image2.ishareread.com/images/2025/20250727/2-%E6%9C%AC%E5%9C%B0n8n%E9%95%9C%E5%83%8F.png" alt="本地镜像"></p><h2 id="二、启动镜像创建n8n容器"><a href="#二、启动镜像创建n8n容器" class="headerlink" title="二、启动镜像创建n8n容器"></a>二、启动镜像创建n8n容器</h2><p>点击本地n8nio/n8n镜像的启动按钮，弹出创建容器的配置界面，在配置界面中输入容器的名称n8n勾选开机自启动。 </p><p><img src="http://image2.ishareread.com/images/2025/20250727/3-%E5%88%9B%E5%BB%BAn8n%E5%AE%B9%E5%99%A8.png" alt="创建容器"></p><p>在进行存储位置配置之前，在NAS的文件管理中创建用于存储n8n数据文件的文件夹。</p><p><img src="http://image2.ishareread.com/images/2025/20250727/4-%E5%88%9B%E5%BB%BANAS%E7%9A%84n8n%E5%AD%98%E5%82%A8%E6%96%87%E4%BB%B6%E5%A4%B9.png" alt="创建存储位置"></p><p>在创建容器详情的配置界面其他的配置项都可以默认，在存储位置的配置项中一定要配置将容器的存储空间映射到NAS上的文件夹，这个文件夹就是刚在NAS文件管理中建的文件夹（也就是将docker容器中的/home/node/.n8n映射到NAS中的n8n/n8n_data）。否则docker重启n8n的配置数据会丢失。</p><p><img src="http://image2.ishareread.com/images/2025/20250727/5-%E6%98%A0%E5%B0%84docker%E6%96%87%E4%BB%B6%E5%A4%B9.png" alt="存储空间映射"></p><p>配置完成后，勾选创建后启动容器，点击“创建”。容器创建启动后就可以通过本地的5678端口访问n8n的应用了。</p><p><img src="http://image2.ishareread.com/images/2025/20250727/6-%E5%88%9B%E5%BB%BA%E5%B9%B6%E5%90%AF%E5%8A%A8%E5%AE%B9%E5%99%A8.png" alt="启动容器"></p><h2 id="三、访问使用n8n"><a href="#三、访问使用n8n" class="headerlink" title="三、访问使用n8n"></a>三、访问使用n8n</h2><p>在浏览器中输入你的主机和端口就可以访问n8n，我这里是 <a href="http://192.168.0.18:5678/" target="_blank" rel="noopener">http://192.168.0.18:5678/</a><br>第一次访问有可能会出现如下图所示的提示，n8n用到了安全的cookie，要不就要配置HTTPS，要不就在环境变量中配置<code>N8N_SECURE_COOKIE</code>为<code>false</code></p><p><img src="http://image2.ishareread.com/images/2025/20250727/7-%E8%AE%BF%E9%97%AEn8n%E5%91%8A%E8%AD%A6%E6%8F%90%E7%A4%BA.png" alt="警告"></p><p>这里，我们在容器设置里添加变量，设置N8N_SECURE_COOKIE为false</p><p><img src="http://image2.ishareread.com/images/2025/20250727/8-%E9%85%8D%E7%BD%AE%E5%AE%B9%E5%99%A8%E8%AF%A6%E6%83%85.png" alt="设置N8N_SECURE_COOKIE为false"></p><p>这样再次访问 <a href="http://192.168.0.18:5678/" target="_blank" rel="noopener">http://192.168.0.18:5678/</a> 就可以正常访问了。第一次用n8n要设置自己的用户名和密码。</p><p><img src="http://image2.ishareread.com/images/2025/20250727/9-%E6%B3%A8%E5%86%8C%E8%B4%A6%E5%8F%B7%E5%90%8D.png" alt="设置自己的用户名和密码"></p><p>设置完用户名密码就可以使用n8n了。</p><p><img src="http://image2.ishareread.com/images/2025/20250727/10-n8n%E4%B8%BB%E7%95%8C%E9%9D%A2.png" alt="使用n8n"></p><p>我们可以导入一个已经配置好的n8n工作流实例。</p><p><img src="http://image2.ishareread.com/images/2025/20250727/11-%E5%AF%BC%E5%85%A5n8n%E5%B7%A5%E4%BD%9C%E6%B5%81%E5%AE%9E%E4%BE%8B.png" alt="导入n8n工作流实例"></p><p>可以看到正常导入，将配置修改为自己的配置就可以直接使用别人已经配置好的工作流了。</p><p><img src="http://image2.ishareread.com/images/2025/20250727/12-%E4%BD%BF%E7%94%A8n8n%E5%B7%A5%E4%BD%9C%E6%B5%81%E5%AE%9E%E4%BE%8B.png" alt="使用效果"></p><p>至此我们在飞牛NAS上成功部署了n8n，可以方便的随时随地构建自己的AI工作流应用了。</p><hr><p>作者博客：<a href="http://xiejava.ishareread.com/">http://xiejava.ishareread.com/</a></p><center> <br><p><img src="http://image2.ishareread.com/images/fullbug%E5%BE%AE%E4%BF%A1%E5%85%AC%E4%BC%97%E5%8F%B7.jpg" alt="“fullbug”微信公众号" title="“fullbug”微信公众号"> </p><p>关注：微信公众号,一起学习成长！</center></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;n8n是一个开源的工作流自动化工具，类似于Zapier和IFTTT，但它更加灵活和强大 。它允许用户通过图形化界面，以拖拽的形式构建自动化工作流，将不同的应用程序和服务连接起来，实现各种自动化任务 。&lt;br&gt;n8n最初的用途是自动化日常工作流，帮助用户节省时间，提高工作效率
      
    
    </summary>
    
    
      <category term="技术" scheme="http://xiejava.ishareread.com/categories/%E6%8A%80%E6%9C%AF/"/>
    
    
      <category term="AI机器学习" scheme="http://xiejava.ishareread.com/tags/AI%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/"/>
    
      <category term="NAS" scheme="http://xiejava.ishareread.com/tags/NAS/"/>
    
  </entry>
  
  <entry>
    <title>通过TPLink路由器进行用户行为审计实战</title>
    <link href="http://xiejava.ishareread.com/posts/e87ac72d/"/>
    <id>http://xiejava.ishareread.com/posts/e87ac72d/</id>
    <published>2025-07-21T14:08:26.000Z</published>
    <updated>2025-12-10T07:13:20.386Z</updated>
    
    <content type="html"><![CDATA[<p>用户行为审计是指对用户在网络平台上的行为进行监控和记录，以便对其行为进行分析和评估的过程。随着互联网的普及和发展，用户行为审计在网络安全和数据隐私保护方面起到了重要的作用。 用户行为审计可以帮助发现和预防网络安全威助。通过对用户的行为进行监控和记录，可以及时发现并阳止恶意攻击、病毒传播等网络安全威胁。例如，当用户的行为异常时，系统可以自动发出警报并采取相应的措施，保护网络平台的安全。<br>本文以家用的TP-Link 路由器为例，来实战一下用户行为审计，看看能发现一些什么异常。<br>TP-Link路由器是家用比较常见的路由器，通过简单的配置就可以实现用户行为管控。</p><h2 id="一、路由器的行为管控配置"><a href="#一、路由器的行为管控配置" class="headerlink" title="一、路由器的行为管控配置"></a>一、路由器的行为管控配置</h2><p>一般的路由器都带有简单行为管控功能，以我的TL-R479GP-AC为例，可以对网站访问、应用控制等进行相应的管控。<br><img src="http://image2.ishareread.com/images/2025/20250721/1-tplink%E8%A1%8C%E4%B8%BA%E7%AE%A1%E6%8E%A7.png" alt="路由器行为管控配置"></p><p>这里我们现对网站和应用进行监控记录，对用户的行为进行审计和管控。</p><h3 id="1、网站访问控制"><a href="#1、网站访问控制" class="headerlink" title="1、网站访问控制"></a>1、网站访问控制</h3><p> 网站访问控制可以实现对某些IP，在什么时间段、访问什么网站进行记录和监控。<br>如我们对bilibil网站进行监控，将B站的域名配置到网站分组中，组名为“娱乐视频”。当然还可以加入跟多的需要记录和管控的网站。<br><img src="http://image2.ishareread.com/images/2025/20250721/2-%E7%BD%91%E7%AB%99%E5%88%86%E7%BB%84.png" alt="网站分组"></p><p>在网站访问的规则中进行配置，为IP地址组选择受管理的网站，在相应时间段中，与IP地址相匹配的设备在访问“娱乐视频”等类型的网站时受到管理。我这里是配置的是所有的地址段、所有时间段、将“娱乐视频”记录到系统日志。方便我们后续进行上网行为的审计分析。<br><img src="http://image2.ishareread.com/images/2025/20250721/3-%E7%BD%91%E7%AB%99%E8%AE%BF%E9%97%AE%E6%8E%A7%E5%88%B6.png" alt="网站访问控制"></p><h3 id="2、应用控制"><a href="#2、应用控制" class="headerlink" title="2、应用控制"></a>2、应用控制</h3><p>同样可以对应用进行控制，对应用控制就是对APP的移动应用的访问进行监控和控制。在这里我们选择对所有的应用进行监控。<br><img src="http://image2.ishareread.com/images/2025/20250721/4-%E5%BA%94%E7%94%A8%E6%8E%A7%E5%88%B6%E9%80%89%E6%8B%A9.png" alt="应用控制选择"></p><p>配置监控的规则，如所有的IP所有的时间段，多访问所有的应用进行记录<br><img src="http://image2.ishareread.com/images/2025/20250721/5-%E5%BA%94%E7%94%A8%E7%AE%A1%E7%90%86%E9%85%8D%E7%BD%AE.png" alt="记录应用访问"></p><p>通过上面的配置，路由器就会根据上面配置的规则来记录相应的日志。但是要进行行为审计还要借助其他的工具如安全审计系统。</p><h2 id="二、用户行为审计"><a href="#二、用户行为审计" class="headerlink" title="二、用户行为审计"></a>二、用户行为审计</h2><h3 id="1、安装安全审计系统"><a href="#1、安装安全审计系统" class="headerlink" title="1、安装安全审计系统"></a>1、安装安全审计系统</h3><p>TP-Link提供了免费的TP-LINK安全审计系统。从官网上下载既可以进行部署和设置。TP-link提供的安全审计系统是以虚拟机镜像方式进行安装的。下载安装包后安装包附有一个比较详细的安装教程。<br>TP-Link官网 <a href="https://www.tp-link.com.cn/" target="_blank" rel="noopener">https://www.tp-link.com.cn/</a><br><img src="http://image2.ishareread.com/images/2025/20250721/6-TPLINK%E5%AE%98%E7%BD%91%E4%B8%8B%E8%BD%BD.png" alt="TPLINK官网下载安全审计系统"></p><p>下载安装包解压后除了有一个虚拟机镜像文件外安装包还附有一个比较详细的安装教程。<br><img src="http://image2.ishareread.com/images/2025/20250721/7-SAS%E5%AE%89%E8%A3%85%E5%8C%85%E8%A7%A3%E5%8E%8B.png" alt="解压安装包"></p><p>在正式安装之前需要安装Oracle VirtualBox的虚拟机管理软件，然后根据这个安装手册将虚拟机注册到管理软件进行启动。<br>虚拟机配置如下图所示：<br><img src="http://image2.ishareread.com/images/2025/20250721/8-%E8%99%9A%E6%8B%9F%E6%9C%BA%E9%85%8D%E7%BD%AE.png" alt="虚拟机配置"></p><p>启动虚拟机后，就可以访问安全审计平台了。<br><img src="http://image2.ishareread.com/images/2025/20250721/9-%E5%AE%89%E5%85%A8%E5%AE%A1%E8%AE%A1%E7%B3%BB%E7%BB%9F%E7%9A%84%E7%99%BB%E5%BD%95.png" alt="安全审计系统登录界面"></p><p>安全审计系统默认用户名和密码都是admin，登录成功后会提示该默认密码。</p><h3 id="2、配置安全审计平台"><a href="#2、配置安全审计平台" class="headerlink" title="2、配置安全审计平台"></a>2、配置安全审计平台</h3><p>如果用对路由器进行安全审计，要进行简单的配置。最关键的配置还是设置IP地址。<br>安全审计系统安装后默认的IP是192.168.1.240，要采集网络中路由器的日志，必须要和路由器在同一网段网络要通。所以要将安全审计平台的IP进行修改。<br><img src="http://image2.ishareread.com/images/2025/20250721/10-%E9%85%8D%E7%BD%AE%E5%AE%89%E5%85%A8%E5%AE%A1%E8%AE%A1%E7%B3%BB%E7%BB%9F%E7%9A%84IP.png" alt="修改IP"></p><h3 id="3、配置路由器"><a href="#3、配置路由器" class="headerlink" title="3、配置路由器"></a>3、配置路由器</h3><p>配置路由器的目的是要将路由器的审计日志发送到刚安装和配置好的安全审计平台。<br>登录到TP-Link路由器的配置管理界面，开启行为审计的上传用户上网行为，输入安全审计系统平台的地址，保存配置。<br><img src="http://image2.ishareread.com/images/2025/20250721/11-%E8%B7%AF%E7%94%B1%E5%99%A8%E8%A1%8C%E4%B8%BA%E5%AE%A1%E8%AE%A1%E6%97%A5%E5%BF%97%E4%B8%8A%E6%8A%A5.png" alt="上报行为审计"></p><p>同样将系统日志也配置报送到安全审计平台。<br><img src="http://image2.ishareread.com/images/2025/20250721/12-%E8%B7%AF%E7%94%B1%E5%99%A8%E7%B3%BB%E7%BB%9F%E6%97%A5%E5%BF%97%E6%95%B0%E6%8D%AE%E4%B8%8A%E6%8A%A5.png" alt="上报系统日志"></p><p>将安全审计的日志也送到安全审计平台。<br><img src="http://image2.ishareread.com/images/2025/20250721/13-%E8%B7%AF%E7%94%B1%E5%99%A8%E5%AE%89%E5%85%A8%E5%AE%A1%E8%AE%A1%E6%97%A5%E5%BF%97%E4%B8%8A%E6%8A%A5.png" alt="上报安全审计"></p><h3 id="4、日志分析与行为分析"><a href="#4、日志分析与行为分析" class="headerlink" title="4、日志分析与行为分析"></a>4、日志分析与行为分析</h3><p>配置完成后，我们再登录到安全审计系统，就可以看到审计日志都送到系统了可以做相应的审计了。<br>可以看到那个IP什么时候访问了什么，同时也看到了前面我们在路由器的的访问控制也生效了，有效的阻止了企图访问bilibili.com的IP。<br><img src="http://image2.ishareread.com/images/2025/20250721/14-%E5%AE%89%E5%85%A8%E5%AE%A1%E8%AE%A1%E7%B3%BB%E7%BB%9F%E6%97%A5%E5%BF%97%E8%AE%B0%E5%BD%95.png" alt="访问控制效果"></p><p>在行为分析中可以看到用户受管控的排行<br><img src="http://image2.ishareread.com/images/2025/20250721/15-%E5%AE%89%E5%85%A8%E5%AE%A1%E8%AE%A1%E7%B3%BB%E7%BB%9F%E8%A1%8C%E4%B8%BA%E5%88%86%E6%9E%90.png" alt="行为分析"></p><p>也可以看到具体哪些IP受管控的次数<br><img src="http://image2.ishareread.com/images/2025/20250721/16-%E5%AE%89%E5%85%A8%E5%AE%A1%E8%AE%A1%E7%B3%BB%E7%BB%9F%E8%AE%BF%E9%97%AE%E7%94%A8%E6%88%B7%E6%95%B0%E6%8D%AE.png" alt="受管控的次数"></p><p>以及具体被管控的原因<br><img src="http://image2.ishareread.com/images/2025/20250721/17-%E5%AE%89%E5%85%A8%E5%AE%A1%E8%AE%A1%E7%B3%BB%E7%BB%9F%E5%8F%97%E7%AE%A1%E6%8E%A7%E8%AE%B0%E5%BD%95.png" alt="具体被管控的原因"></p><h3 id="5、利用AI进行审计与分析"><a href="#5、利用AI进行审计与分析" class="headerlink" title="5、利用AI进行审计与分析"></a>5、利用AI进行审计与分析</h3><p>现在AI大模型已经很强大了，我们可以将安全审计系统的日志导出来给大模型进行审计与分析。发现其他的一些人工审计发现不了的异常。如发现用户的行为特征及偏离平时访问基线的一些访问等。<br>我们将安全审计系统的审计日志导出为Excel，将Excel通过coze空间进行审计分析，可以生成比较完整的审计报告。<br><img src="http://image2.ishareread.com/images/2025/20250721/18-coze%E7%A9%BA%E9%97%B4%E5%AE%A1%E8%AE%A1%E5%88%86%E6%9E%90.png" alt="coze空间进行审计分析"></p><p>可以看到coze空间生成的审计报告还是比较全面美观。<br><img src="http://image2.ishareread.com/images/2025/20250721/19-coze%E5%AE%A1%E8%AE%A1%E6%8A%A5%E5%91%8A.jpeg" alt="完整的审计报告"></p><p>也可以用WPS自带的AI数据分析，可以看出对用户的异常行为的分析还是比较专业和详细的。<br><img src="http://image2.ishareread.com/images/2025/20250721/20-WPSAI%E5%88%86%E6%9E%90.png" alt="WPSAI分析报告"></p><hr><p>作者博客：<a href="http://xiejava.ishareread.com/">http://xiejava.ishareread.com/</a></p><center> <br><p><img src="http://image2.ishareread.com/images/fullbug%E5%BE%AE%E4%BF%A1%E5%85%AC%E4%BC%97%E5%8F%B7.jpg" alt="“fullbug”微信公众号" title="“fullbug”微信公众号"> </p><p>关注：微信公众号,一起学习成长！</center></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;用户行为审计是指对用户在网络平台上的行为进行监控和记录，以便对其行为进行分析和评估的过程。随着互联网的普及和发展，用户行为审计在网络安全和数据隐私保护方面起到了重要的作用。 用户行为审计可以帮助发现和预防网络安全威助。通过对用户的行为进行监控和记录，可以及时发现并阳止恶意攻
      
    
    </summary>
    
    
      <category term="技术" scheme="http://xiejava.ishareread.com/categories/%E6%8A%80%E6%9C%AF/"/>
    
      <category term="网络安全" scheme="http://xiejava.ishareread.com/categories/%E6%8A%80%E6%9C%AF/%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8/"/>
    
    
      <category term="网络安全" scheme="http://xiejava.ishareread.com/tags/%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8/"/>
    
  </entry>
  
  <entry>
    <title>使用GeminiBalance让Gemini免费到底</title>
    <link href="http://xiejava.ishareread.com/posts/d786604d/"/>
    <id>http://xiejava.ishareread.com/posts/d786604d/</id>
    <published>2025-07-10T15:22:18.000Z</published>
    <updated>2025-12-10T07:13:20.341Z</updated>
    
    <content type="html"><![CDATA[<p>Gemini是目前好用的免费大模型，通过在 Google AI Studio 获取 API 密钥，每位开发者可以获得慷慨的免费使用额度。这包括每天 300,000 个 Token（包括提示和响应）以及每分钟 60 个请求的速率限制 。虽然免费但有一定的额度，不过通过申请不同的账号可以申请获取多个API密钥。Gemini Balance 就是这么一款工具，允许您管理多个 Gemini API Key，这样就可以使Gemini免费额度翻N倍。</p><p>Gemini Balance 是一个基于 Python FastAPI 构建的应用程序，旨在提供 Google Gemini API 的代理和负载均衡功能。它允许您管理多个 Gemini API Key，并通过简单的配置实现 Key 的轮询、认证、模型过滤和状态监控。此外，项目还集成了图像生成和多种图床上传功能，并支持 OpenAI API 格式的代理。</p><p>要感谢snailyp大佬开发的gemini-balance 项目地址：<a href="https://github.com/snailyp/gemini-balance" target="_blank" rel="noopener">https://github.com/snailyp/gemini-balance</a><br>《<a href="http://xiejava.ishareread.com/posts/4999be0b/">国内免代理免费使用Gemini大模型实战</a>》介绍了如何将Gamini中转到国内能够使用，本文介绍如何使用免费的ClawCloud容器化部署gemini-balance配置多个Gemini API Key，不仅在国内可以使用还可以让Gemini免费到底！</p><h2 id="一、申请注册多个Gemini-API-Key"><a href="#一、申请注册多个Gemini-API-Key" class="headerlink" title="一、申请注册多个Gemini API Key"></a>一、申请注册多个Gemini API Key</h2><p>注册google账号就可以免费申请Gemini API密钥。</p><p>申请地址 <a href="https://aistudio.google.com/" target="_blank" rel="noopener">https://aistudio.google.com/</a></p><p><img src="http://image2.ishareread.com/images/2025/20250710/1-APIkey%E7%94%B3%E8%AF%B7.png" alt="申请密钥"> </p><p>有了Gemini API密钥后就可以调用API使用Gemini 大模型的能力了。</p><p>注册多个google账号就可以申请多个Gemini API 密钥。</p><h2 id="二、注册ClawCloud账号"><a href="#二、注册ClawCloud账号" class="headerlink" title="二、注册ClawCloud账号"></a>二、注册ClawCloud账号</h2><p>ClawCloud是一个成立于2024年的云计算平台，总部位于新加坡，ClawCloud旨在简化技术栈的复杂性，帮助用户从编码到生产的整个过程只需几次点击即可完成 。它提供免费的每月5美元GitHub验证赠金，无需信用卡即可开始使用，并承诺在1分钟内完成设置 。</p><p>ClawCloud 在国内可以直接访问，Github 账户注册时间超过 180天就有每个月5美元的赠送额度，足够支撑我们部署gemini-balance的应用了。</p><p><img src="http://image2.ishareread.com/images/2025/20250710/2-ClawCloud.png" alt="在这里插入图片描述"></p><p>点击 Github 登录<img src="http://image2.ishareread.com/images/2025/20250710/3-ClawCloudGithub%E7%99%BB%E5%BD%95.png" alt="选择github登录"></p><p>进入 Github 登录界面后，输入账户名、密码，随后点击 Sign in。<br><img src="http://image2.ishareread.com/images/2025/20250710/4-github%E7%99%BB%E5%BD%95.png" alt="Github登录"></p><p>登录以后就在用户中心Account Center就可以看到每个月赠送的额度，如果有使用还可以看到目前使用的额度。</p><p><img src="http://image2.ishareread.com/images/2025/20250710/5-ClowCloud%E7%94%A8%E6%88%B7%E4%B8%AD%E5%BF%83.png" alt="ClawCloud的用户中心"></p><h2 id="三、通过-ClawCloud-Run-部署gemini-balance"><a href="#三、通过-ClawCloud-Run-部署gemini-balance" class="headerlink" title="三、通过 ClawCloud Run 部署gemini-balance"></a>三、通过 ClawCloud Run 部署gemini-balance</h2><p>gemini-balance官方有详细的部署文档</p><p><a href="https://gb-docs.snaily.top/guide/setup-clawcloud-sqlite.html" target="_blank" rel="noopener">https://gb-docs.snaily.top/guide/setup-clawcloud-sqlite.html</a></p><p>大家可以按照这个文档一步步部署</p><ol><li>部署项目</li></ol><ul><li>进入主界面后，点击左上角 Region，选择服务器地址。推荐选择 Singapore。选择完成后，网页会刷新，并在服务器地址前☑️。</li></ul><p><img src="http://image2.ishareread.com/images/2025/20250710/6-ClowCloud%E9%80%89%E6%8B%A9%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%9C%B0%E5%9D%80.png" alt="选择服务器地址"></p><ul><li>点击 App Launchpad。</li></ul><p><img src="http://image2.ishareread.com/images/2025/20250710/7-ClowCloud%E7%9A%84Applaunchpad.png" alt="选择App Lannchpad"></p><ul><li>进入页面后，点击页面右上角 Create App，进入配置页面。</li></ul><p><img src="http://image2.ishareread.com/images/2025/20250710/8-ClowCloud%E5%88%9B%E5%BB%BAAPP.png" alt="Create App"></p><ul><li>进入配置页面后，按顺序填写信息（不熟悉项目名称的，请打开在线翻译）。<ul><li>Application Name：为方便识别管理，建议填写本项目名字<code>geminibalance</code></li><li>Image： <code>Public</code><ul><li>Image Name：<code>ghcr.io/snailyp/gemini-balance:latest</code></li></ul></li></ul></li></ul><p><img src="http://image2.ishareread.com/images/2025/20250710/9-ClowCloud%E9%80%89%E6%8B%A9%E9%95%9C%E5%83%8F.png" alt="在这里插入图片描述"></p><pre><code>- Usage：`Fixed`；- Replicas：`1`- CPU：`1`- Memory：`512`&gt; 说明：1. 若登录账号只选择部署 1 个项目，则推荐上述最高免费配置。2.目前免费用户每月流量为 10g，超出部分 0.05 美元/g。可根据流量使用情况选择服务器配置。</code></pre><p> <img src="http://image2.ishareread.com/images/2025/20250710/10-ClowCloud%E9%80%89%E6%8B%A9%E6%9C%8D%E5%8A%A1%E5%99%A8%E9%85%8D%E7%BD%AE.png" alt="在这里插入图片描述"></p><pre><code>- Network    - Container Port：`8000`    - Enable Internet：点选为`Access`状态</code></pre><p><img src="http://image2.ishareread.com/images/2025/20250710/11-ClowCloud%E9%80%89%E6%8B%A9%E7%BD%91%E7%BB%9C.png" alt="在这里插入图片描述"></p><ul><li>Advanced Configura<ul><li>Environment Variables：点击 Add，随后粘贴以下变量。填写完成后点击 Add 完成配置。</li></ul></li></ul><pre><code><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">DATABASE_TYPE&#x3D;sqlite</span><br><span class="line">SQLITE_DATABASE&#x3D;default_db</span><br><span class="line">API_KEYS&#x3D;[&quot;&quot;]</span><br><span class="line">ALLOWED_TOKENS&#x3D;[&quot;&quot;]</span><br><span class="line">AUTH_TOKEN&#x3D;TZ&#x3D;Asia&#x2F;Shanghai</span><br></pre></td></tr></table></figure></code></pre><p>变量说明如下：  </p><table><thead><tr><th>变量名</th><th>说明</th><th>格式及示例</th></tr></thead><tbody><tr><td>API_KEYS</td><td>Gemini API 密钥列表，用于负载均衡</td><td>[“your-gemini-api-key-1”,”your-gemini-api-key-2”]</td></tr><tr><td>ALLOWED_TOKENS</td><td>允许访问的 Token 列表</td><td>[“your-access-token-1”,”your-access-token-2”]</td></tr><tr><td>AUTH_TOKEN</td><td>【可选】超级管理员token，具有所有权限，不填默认使用 ALLOWED_TOKENS 的第一个</td><td>sk-123456</td></tr></tbody></table><p><img src="http://image2.ishareread.com/images/2025/20250710/12-ClowCloud%E9%80%89%E6%8B%A9%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F.png" alt="在这里插入图片描述"></p><ul><li>添加完环境变量后，再按照下图设置storage</li></ul><p><img src="http://image2.ishareread.com/images/2025/20250710/13-ClowCloud%E9%80%89%E6%8B%A9Storage.png" alt="在这里插入图片描述"></p><ul><li>返回页面最上方，点击 Deploy Application。弹窗提示Are you sure you want to deploy the application?选择 Yes。</li></ul><p><img src="http://image2.ishareread.com/images/2025/20250710/14-ClowCloud%E9%83%A8%E7%BD%B2%E5%BA%94%E7%94%A8.png" alt="在这里插入图片描述"></p><ul><li>等待几秒后，跳转至状态界面。此时，请确认页面左上角显示 running。若显示为其他状态，请稍后片刻；仍未显示 running，请确认你配置选项是否正确。需要修改的，可点击页面右下角 Manage Network 选项修改参数，或删除该项目重新部署。</li></ul><p><img src="http://image2.ishareread.com/images/2025/20250710/15-ClowCloud%E7%AD%89%E5%BE%85%E9%83%A8%E7%BD%B2%E7%8A%B6%E6%80%81.png" alt="在这里插入图片描述"></p><ul><li>将页面滚动到最下方，在 Network 选项卡中，查看右侧公网地址配置情况。一般情况下，显示 pending 表明还在处理当中，需要等待 2～5 分钟，直至pending 状态变为Available。 实际情况下， 2 分钟后即使公网地址前显示pending，亦可尝试在新的浏览器标签中打开该地址。若网页能正常显示本项目登录界面，则正常使用即可。若公网地址前的pending状态超过 10 分钟，且无法打开登录界面，原因可能是服务器过载，需要更长等待时间。建议换区或换服务商重新部署。</li></ul><p><img src="http://image2.ishareread.com/images/2025/20250710/16-ClowCloud%E7%8A%B6%E6%80%81%E5%8F%98%E4%B8%BAAvailable.png" alt="在这里插入图片描述"></p><ul><li>设置自定义域名</li><li>在cloudflare添加cname记录，如我希望域名为ggg.abc.xyz，cloudflare中这样设置，abc.xyz为托管在cloudflare域名</li><li>在clawcloud这样设置，这样就可以自定义域名访问</li></ul><p><img src="http://image2.ishareread.com/images/2025/20250710/17-ClowCloud%E9%85%8D%E7%BD%AE%E8%87%AA%E5%AE%9A%E4%B9%89%E5%9F%9F%E5%90%8D.png" alt="在这里插入图片描述"></p><h2 id="四、使用gemini-balance监控配置页面"><a href="#四、使用gemini-balance监控配置页面" class="headerlink" title="四、使用gemini-balance监控配置页面"></a>四、使用gemini-balance监控配置页面</h2><p>gemini-balance贴心的带了一个监控配置页面，在这个界面可以配置多个Gemimi API 也可以监控Gemini API的调用情况。</p><ol><li>gemini-balance监控页面配置<ul><li>复制项目公网访问地址后，在浏览器中打开。随后进入登录界面，输入密码即可进入。（如果没有更改配置，密码是<code>your-access-token-1</code>）</li></ul></li></ol><p><img src="http://image2.ishareread.com/images/2025/20250710/18-GeminiBalance%E9%85%8D%E7%BD%AE%E7%95%8C%E9%9D%A21.png" alt="gemini-balance监控页面登录"></p><p>登录后可以进行相应的配置如添加更多的Gemini API Key<br><img src="http://image2.ishareread.com/images/2025/20250710/19-GeminiBalance%E9%85%8D%E7%BD%AE%E7%95%8C%E9%9D%A22.png" alt="配置界面"></p><p>也可以监控Gemini API Key的调用情况</p><p><img src="http://image2.ishareread.com/images/2025/20250710/20-GeminiBalance%E9%85%8D%E7%BD%AE%E7%95%8C%E9%9D%A23.png" alt="监控Gemini API Key的调用情况"></p><h2 id="五、在-cherry-studio使用GeminiBalance"><a href="#五、在-cherry-studio使用GeminiBalance" class="headerlink" title="五、在 cherry studio使用GeminiBalance"></a>五、在 cherry studio使用GeminiBalance</h2><p> 以 cherry studio 为例<br>    1. 添加提供商。<br>        - 提供商名称：任意填写</p><p><img src="http://image2.ishareread.com/images/2025/20250710/21-Cherrystudio-geminibalance%E9%85%8D%E7%BD%AE1.png" alt="在这里插入图片描述"></p><pre><code>2. 配置    - API 密钥：填写监控面板“API 密钥”选项卡中的“允许的令牌列表”。    - API 地址：填写 ClawCloud 中的公网访问地址。注意结尾不要出现“/”。</code></pre><p>  <img src="http://image2.ishareread.com/images/2025/20250710/22-Cherrystudio-GeminiBalance%E9%85%8D%E7%BD%AEKey.png" alt="在这里插入图片描述"></p><pre><code>3. 添加模型4. 点击“管理”，添加模型。</code></pre><p>   <img src="http://image2.ishareread.com/images/2025/20250710/23-CherryStudio-GeminiBalance%E9%85%8D%E7%BD%AE%E6%A8%A1%E5%9E%8B.png" alt="在这里插入图片描述"></p><p> 至此，部署完成。</p><p>最后看调用效果<br><img src="http://image2.ishareread.com/images/2025/20250710/24-CheryStudio-GeminiBalance%E4%BD%BF%E7%94%A8%E6%95%88%E6%9E%9C.png" alt="在这里插入图片描述"></p><hr><p>作者博客：<a href="http://xiejava.ishareread.com/">http://xiejava.ishareread.com/</a></p><center> <br><p><img src="http://image2.ishareread.com/images/fullbug%E5%BE%AE%E4%BF%A1%E5%85%AC%E4%BC%97%E5%8F%B7.jpg" alt="“fullbug”微信公众号" title="“fullbug”微信公众号"> </p><p>关注：微信公众号,一起学习成长！</center></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;Gemini是目前好用的免费大模型，通过在 Google AI Studio 获取 API 密钥，每位开发者可以获得慷慨的免费使用额度。这包括每天 300,000 个 Token（包括提示和响应）以及每分钟 60 个请求的速率限制 。虽然免费但有一定的额度，不过通过申请不同
      
    
    </summary>
    
    
      <category term="技术" scheme="http://xiejava.ishareread.com/categories/%E6%8A%80%E6%9C%AF/"/>
    
    
      <category term="AI机器学习" scheme="http://xiejava.ishareread.com/tags/AI%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/"/>
    
  </entry>
  
  <entry>
    <title>国内免代理免费使用Gemini大模型实战</title>
    <link href="http://xiejava.ishareread.com/posts/4999be0b/"/>
    <id>http://xiejava.ishareread.com/posts/4999be0b/</id>
    <published>2025-07-07T11:19:01.000Z</published>
    <updated>2025-12-10T07:13:20.292Z</updated>
    
    <content type="html"><![CDATA[<p>谷歌的Gemini API 为开发者提供了具体的免费额度，允许将Gemini模型集成到自己的应用程序中。<br>模型可访问范围：开发者可以免费调用 Gemini 2.5 Pro 模型及其轻量级版本 Gemini 2.5 Flash 。<br>标准免费额度：通过在 Google AI Studio 获取 API 密钥，每位开发者可以获得慷慨的免费使用额度。这包括每天 300,000 个 Token（包括提示和响应）以及每分钟 60 个请求的速率限制 。</p><h2 id="一、免费申请Gemini-API密钥"><a href="#一、免费申请Gemini-API密钥" class="headerlink" title="一、免费申请Gemini API密钥"></a>一、免费申请Gemini API密钥</h2><p>注册google账号就可以免费申请Gemini API密钥。<br>申请地址 <a href="https://aistudio.google.com/" target="_blank" rel="noopener">https://aistudio.google.com/</a><br><img src="http://image2.ishareread.com/images/2025/20250707/1-%E7%94%B3%E8%AF%B7GeminiAPIkey.PNG" alt="申请密钥"></p><p>有了Gemini API密钥后就可以调用API使用Gemini 大模型的能力了。<br>国内上网环境无法直接使用Gemini API，本文介绍能够免代理使用Gemini的方法。</p><h2 id="二、使用openai-gemini"><a href="#二、使用openai-gemini" class="headerlink" title="二、使用openai-gemini"></a>二、使用openai-gemini</h2><h3 id="1、在github上找到openai-gemini"><a href="#1、在github上找到openai-gemini" class="headerlink" title="1、在github上找到openai-gemini"></a>1、在github上找到openai-gemini</h3><p>openai-gemini 是一个 serverless 的代理项目，用于将 Gemini API 转换为 OpenAI API 。<br>项目地址：<a href="https://github.com/PublicAffairs/openai-gemini" target="_blank" rel="noopener">https://github.com/PublicAffairs/openai-gemini</a><br>Gemini API 是免费的， 但有许多工具专门与 OpenAI API 一起使用。该项目可以将Gemini API 转换为 OpenAI API ，并且通过serverless进行调用。我们可以找个国内可以访问的免费serverless服务进行中转满足国内调用使用需求。<br>这里介绍将openai-gemini部署到Netlify<br>Netlify 是一个领先的 Web 开发平台，它专门为构建、部署和管理现代高性能网站和 Web 应用程序提供了一站式解决方案。Netlify 的核心理念是支持 Jamstack 架构（JavaScript, APIs, Markup），该架构强调将网站内容预构建为静态文件，并通过 CDN 快速分发，然后通过 API 调用动态数据和执行后端逻辑。</p><h3 id="2、将openai-gemini部署到Netlify"><a href="#2、将openai-gemini部署到Netlify" class="headerlink" title="2、将openai-gemini部署到Netlify"></a>2、将openai-gemini部署到Netlify</h3><p><img src="http://image2.ishareread.com/images/2025/20250707/2-DeployNetlify.PNG" alt="Deploy to Netlify"></p><p>找到”Deploy to Netlify” 点击就可以一键部署到Netlify,部署完成后Netlify会自动分配一个地址用于访问刚部署的openai-gemini的serverless服务。并且这个地址是在过国内可以正常访问的。<br><img src="http://image2.ishareread.com/images/2025/20250707/3-NetlifyProjectOvervier.PNG" alt="project overview"></p><h3 id="3、在Cherry-Studio中配置和使用gemini的模型"><a href="#3、在Cherry-Studio中配置和使用gemini的模型" class="headerlink" title="3、在Cherry Studio中配置和使用gemini的模型"></a>3、在Cherry Studio中配置和使用gemini的模型</h3><h4 id="1）在Cherry-Studio中配置gemini-API"><a href="#1）在Cherry-Studio中配置gemini-API" class="headerlink" title="1）在Cherry Studio中配置gemini API"></a>1）在Cherry Studio中配置gemini API</h4><p>通过Netlify中转访问gemini API，我们可以直接在Cherry Studio中配置通过Netlify中转访问gemini API<br>配置API地址为通过netlify中转的地址<br>API密钥为google gemini 的API Key<br>模型可以配置你想使用的模型 如：gemini-2.5-pro<br><img src="http://image2.ishareread.com/images/2025/20250707/4-CherryStudio%E9%85%8D%E7%BD%AEGeminiAPI.PNG" alt="Cherry Studio中配置API key"></p><h4 id="2）在Cherry-Studio中使用gemini-的模型"><a href="#2）在Cherry-Studio中使用gemini-的模型" class="headerlink" title="2）在Cherry Studio中使用gemini 的模型"></a>2）在Cherry Studio中使用gemini 的模型</h4><p>在Cherry Studio中选择刚配置的gemini-2.5-pro并和它对话，可以看到gemini-2.5-pro可以流畅的输出。<br><img src="http://image2.ishareread.com/images/2025/20250707/5-CherryStudio%E4%B8%AD%E4%BD%BF%E7%94%A8GeminiAPI.png" alt="在cherry Studio中使用gemini"></p><h3 id="4、在Dify中配置和使用gemini的模型"><a href="#4、在Dify中配置和使用gemini的模型" class="headerlink" title="4、在Dify中配置和使用gemini的模型"></a>4、在Dify中配置和使用gemini的模型</h3><h4 id="1-在Dify中配置gemini-API"><a href="#1-在Dify中配置gemini-API" class="headerlink" title="1) 在Dify中配置gemini API"></a>1) 在Dify中配置gemini API</h4><p>  通过openai-gemini将 Gemini API 转换为了 OpenAI API ，所以在dify中应该使用“OpenAI-API-compatible”的插件来配置模型。<br><img src="http://image2.ishareread.com/images/2025/20250707/6-%E5%9C%A8dify%E4%B8%AD%E9%85%8D%E7%BD%AE%E6%A8%A1%E5%9E%8B%E4%BE%9B%E5%BA%94%E5%95%86.png" alt="OpenAI插件"></p><p>如果没有安装“OpenAI-API-compatible”插件需先安装。在模型供应商中选择“OpenAI-API-compatible”,点击“添加模型”。<br>配置API地址为通过netlify中转的地址<br>API密钥为google gemini 的API Key<br>模型可以配置你想使用的模型 如：gemini 2.5 pro<br><img src="http://image2.ishareread.com/images/2025/20250707/7-%E5%9C%A8%E6%A8%A1%E5%9E%8B%E4%BE%9B%E5%BA%94%E5%95%86%E4%B8%AD%E9%85%8D%E7%BD%AEGeminiAPI.png" alt="配置API key"></p><h4 id="2）在Dify中使用gemini的模型"><a href="#2）在Dify中使用gemini的模型" class="headerlink" title="2）在Dify中使用gemini的模型"></a>2）在Dify中使用gemini的模型</h4><p>在Dify中建一个对话应用，选择刚配置好的 Gemini 2.5 Pro 模型进行对话，可以看到对话成功的调用了gemini API使用Gemini 2.5 Pro的模型进行了回复。<br><img src="http://image2.ishareread.com/images/2025/20250707/8-%E5%9C%A8Dify%E4%B8%AD%E9%85%8D%E7%BD%AEGemini%E6%A8%A1%E5%9E%8B.png" alt="在Dify中使用"></p><h3 id="5、如果自己有域名可以用自己的域名来中转netlify的地址进行访问"><a href="#5、如果自己有域名可以用自己的域名来中转netlify的地址进行访问" class="headerlink" title="5、如果自己有域名可以用自己的域名来中转netlify的地址进行访问"></a>5、如果自己有域名可以用自己的域名来中转netlify的地址进行访问</h3><h4 id="1-在自己的DNS中配置域名解析到netlify的地址"><a href="#1-在自己的DNS中配置域名解析到netlify的地址" class="headerlink" title="1) 在自己的DNS中配置域名解析到netlify的地址"></a>1) 在自己的DNS中配置域名解析到netlify的地址</h4><p>以我的cloud flare域名服务配置为例，在DNS中配置一个netlifygemini的子域名，解析到目标为开始netlify给的服务地址。<br><img src="http://image2.ishareread.com/images/2025/20250707/9-DNS%E9%85%8D%E7%BD%AE%E5%AD%90%E5%9F%9F%E5%90%8D.png" alt="配置子域名"></p><h4 id="2）在netlify中配置子域名"><a href="#2）在netlify中配置子域名" class="headerlink" title="2）在netlify中配置子域名"></a>2）在netlify中配置子域名</h4><p>在netlify中可以配置自己的域名对gemini API进行访问。在netlify的项目中找到“domain you already own”<br><img src="http://image2.ishareread.com/images/2025/20250707/10-%E5%9C%A8netlify%E4%B8%AD%E9%85%8D%E7%BD%AE%E5%AD%90%E5%9F%9F%E5%90%8D.png" alt="在netlify中配置自己的域名"></p><p>在自定义域名配置界面，输入自己的子域名，它会给出Host和Value的值，这两个值需要在自己的DNS域名服务器中配置校验。<br><img src="http://image2.ishareread.com/images/2025/20250707/11-netlify%E4%B8%AD%E7%9A%84%E9%AA%8C%E8%AF%81%E4%BF%A1%E6%81%AF.png" alt="效验信息"></p><p>接下来需要在自己的DNS服务中进行配置，我以自己的cloud flare域名服务配置为例，配置如下：</p><h4 id="3）在-Cloudflare-中添加TXT记录用于校验"><a href="#3）在-Cloudflare-中添加TXT记录用于校验" class="headerlink" title="3）在 Cloudflare 中添加TXT记录用于校验"></a>3）在 Cloudflare 中添加TXT记录用于校验</h4><ol><li>登录你的 Cloudflare 账户，选择我的域名doai8.dpdns.org。</li><li>进入左侧的 “DNS” 菜单。</li><li>点击 “Add record” (添加记录) 按钮。</li><li>根据下面的表格，准确填写每一个字段：</li></ol><table><thead><tr><th>Cloudflare 字段</th><th>你需要填写的内容 (从 Netlify 截图复制)</th></tr></thead><tbody><tr><td>Type (类型)</td><td>TXT</td></tr><tr><td>Name (名称)</td><td>netlify-challenge</td></tr><tr><td>Content (内容)</td><td>4f<strong><strong><strong>*****</strong></strong></strong>062b</td></tr><tr><td>TTL</td><td>保持默认的 Auto 即可</td></tr></tbody></table><p><img src="http://image2.ishareread.com/images/2025/20250707/12-%E5%9C%A8DNS%E4%B8%AD%E9%85%8D%E7%BD%AETXT%E9%AA%8C%E8%AF%81%E4%BF%A1%E6%81%AF.png" alt="添加TXT记录"></p><h4 id="4）在netify中进行验证，验证通过就可以用自己的域名访问了"><a href="#4）在netify中进行验证，验证通过就可以用自己的域名访问了" class="headerlink" title="4）在netify中进行验证，验证通过就可以用自己的域名访问了"></a>4）在netify中进行验证，验证通过就可以用自己的域名访问了</h4><p>在netify中进行验证，验证通过就可以用自己的域名访问了，在图中可以看到自己的子域名和netlify给的子域名。两个域名都可以用，自己的子域名的好处就是自己容易记忆。<br><img src="http://image2.ishareread.com/images/2025/20250707/13-Netlify%E5%9F%9F%E5%90%8D%E7%AE%A1%E7%90%86.png" alt="自定义域名配好"></p><h4 id="5）用自定义域名进行gemini-API接口的测试"><a href="#5）用自定义域名进行gemini-API接口的测试" class="headerlink" title="5）用自定义域名进行gemini API接口的测试"></a>5）用自定义域名进行gemini API接口的测试</h4><p> 在Cherry Studio中将API地址配置程自定义域名的地址<br><img src="http://image2.ishareread.com/images/2025/20250707/14-%E5%9C%A8cherrystdio%E4%B8%AD%E9%85%8D%E7%BD%AE%E8%87%AA%E5%AE%9A%E4%B9%89%E5%9F%9F%E5%90%8D%E6%8E%A5%E5%8F%A3.png" alt="配置自定义域名地址"><br>可以看到和gemini 2.5 pro 对话同样也很丝滑。<br><img src="http://image2.ishareread.com/images/2025/20250707/15-%E8%87%AA%E5%AE%9A%E4%B9%89%E5%9F%9F%E5%90%8D%E6%8E%A5%E5%8F%A3%E4%BD%BF%E7%94%A8%E6%95%88%E6%9E%9C.png" alt="测试"></p><hr><p>作者博客：<a href="http://xiejava.ishareread.com/">http://xiejava.ishareread.com/</a></p><center> <br><p><img src="http://image2.ishareread.com/images/fullbug%E5%BE%AE%E4%BF%A1%E5%85%AC%E4%BC%97%E5%8F%B7.jpg" alt="“fullbug”微信公众号" title="“fullbug”微信公众号"> </p><p>关注：微信公众号,一起学习成长！</center></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;谷歌的Gemini API 为开发者提供了具体的免费额度，允许将Gemini模型集成到自己的应用程序中。&lt;br&gt;模型可访问范围：开发者可以免费调用 Gemini 2.5 Pro 模型及其轻量级版本 Gemini 2.5 Flash 。&lt;br&gt;标准免费额度：通过在 Googl
      
    
    </summary>
    
    
      <category term="技术" scheme="http://xiejava.ishareread.com/categories/%E6%8A%80%E6%9C%AF/"/>
    
    
      <category term="AI机器学习" scheme="http://xiejava.ishareread.com/tags/AI%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/"/>
    
  </entry>
  
  <entry>
    <title>飞牛NAS本地化部署dify打造私有LLMOps平台</title>
    <link href="http://xiejava.ishareread.com/posts/a0bb8a4f/"/>
    <id>http://xiejava.ishareread.com/posts/a0bb8a4f/</id>
    <published>2025-06-14T03:25:43.000Z</published>
    <updated>2025-12-10T07:13:20.253Z</updated>
    
    <content type="html"><![CDATA[<p>作为一名程序员，在AI蓬勃发展的时代，一定要拥抱AI。<strong>Dify</strong> 是一款开源的大语言模型(LLM) 应用开发平台。它融合了后端即服务（Backend as Service）和 LLMOps 的理念，使开发者可以快速搭建生产级的生成式 AI 应用。即使你是非技术人员，也能参与到 AI 应用的定义和数据运营过程中。</p><p>由于 Dify 内置了构建 LLM 应用所需的关键技术栈，包括对数百个模型的支持、直观的 Prompt 编排界面、高质量的 RAG 引擎、稳健的 Agent 框架、灵活的流程编排，并同时提供了一套易用的界面和 API。这为开发者节省了许多重复造轮子的时间，使其可以专注在创新和业务需求上。</p><p>NAS作为私有化的个人数据中心，基本保持不停机的状态并且功耗小，比较适合作为私有化的开发平台载体。本文介绍如何在家庭飞牛NAS上本地化部署dify打造属于自己的私有化LLMOps平台，可以随时随地的通过Dify来构建自己的AI应用。</p><h2 id="一、准备工作"><a href="#一、准备工作" class="headerlink" title="一、准备工作"></a>一、准备工作</h2><h3 id="1、环境介绍"><a href="#1、环境介绍" class="headerlink" title="1、环境介绍"></a>1、环境介绍</h3><p>我的NAS设备为零刻ME mini全闪小主机，CPU intel N200,内存12G，装了fnOS作为NAS用。这个配置如果仅仅只是存存相片、文件等还是有点过剩了，所以为了充分发挥迷你主机的效用决定把它打造为私有的LLMOps平台。</p><p><img src="http://image2.ishareread.com/images/2025/20250614/1-nas%E9%85%8D%E7%BD%AE.png" alt="NAS的硬件配置"></p><h3 id="2、打开飞牛OS的SSH登录"><a href="#2、打开飞牛OS的SSH登录" class="headerlink" title="2、打开飞牛OS的SSH登录"></a>2、打开飞牛OS的SSH登录</h3><p>登录到飞牛OS，在“系统设置”中找到“SSH”，打开SSH功能</p><p><img src="http://image2.ishareread.com/images/2025/20250614/2-%E6%89%93%E5%BC%80SSH.png" alt="打开SSH"></p><h3 id="3、通过SSH客户端连上NAS主机"><a href="#3、通过SSH客户端连上NAS主机" class="headerlink" title="3、通过SSH客户端连上NAS主机"></a>3、通过SSH客户端连上NAS主机</h3><p>打开SSH后就可以通过SSH的客户端工具连到fnOS</p><p><img src="http://image2.ishareread.com/images/2025/20250614/3-SSH%E8%BF%9E%E6%8E%A5%E4%B8%BB%E6%9C%BA.png" alt="SSH连接主机"></p><h2 id="二、在飞牛NAS上安装Dify"><a href="#二、在飞牛NAS上安装Dify" class="headerlink" title="二、在飞牛NAS上安装Dify"></a>二、在飞牛NAS上安装Dify</h2><h3 id="1、找到Dify的安装源"><a href="#1、找到Dify的安装源" class="headerlink" title="1、找到Dify的安装源"></a>1、找到Dify的安装源</h3><p>在github或gitee上找到dify的项目地址<br><a href="https://github.com/langgenius/dify/" target="_blank" rel="noopener">https://github.com/langgenius/dify/</a><br><a href="https://gitee.com/dify_ai/dify" target="_blank" rel="noopener">https://gitee.com/dify_ai/dify</a><br>在国内访问github比较慢，可以访问gitee上的difyi项目地址。<br>这里有安装Dify的硬件要求和安装步骤。</p><p><img src="http://image2.ishareread.com/images/2025/20250614/4-gitee%E7%9A%84dify%E9%A1%B9%E7%9B%AE.png" alt="gitee的dify项目"></p><h3 id="2、在飞牛NAS上创建存储目录"><a href="#2、在飞牛NAS上创建存储目录" class="headerlink" title="2、在飞牛NAS上创建存储目录"></a>2、在飞牛NAS上创建存储目录</h3><p>在飞牛NAS上创建一个用户clone和安装dify的目录</p><p><img src="http://image2.ishareread.com/images/2025/20250614/5-nas%E5%88%9B%E5%BB%BA%E5%AD%98%E5%82%A8%E7%9B%AE%E5%BD%95.png" alt="NAS上创建Dify目录"><br>右键点击dify文件夹，点击“详细信息”。</p><p><img src="http://image2.ishareread.com/images/2025/20250614/6-%E6%9F%A5%E7%9C%8B%E7%9B%AE%E5%BD%95%E7%9A%84%E5%AD%98%E5%82%A8%E8%AF%A6%E6%83%85.png" alt="查看目录详情"></p><p>在详细信息中找到“复制原始路径”，这里复制的原始路径就是该文件夹在fnOS操作系统的实际路径。</p><p><img src="http://image2.ishareread.com/images/2025/20250614/7-%E5%A4%8D%E5%88%B6%E5%8E%9F%E5%A7%8B%E8%B7%AF%E5%BE%84.png" alt="找到实际路径"></p><h3 id="3、开始安装Dify"><a href="#3、开始安装Dify" class="headerlink" title="3、开始安装Dify"></a>3、开始安装Dify</h3><p>安装Dify需要docker环境，fnOS本身就已经安装好了docker环境，所以可以直接clone后进行安装<br>通过<code>sudo -i</code> 切换到 root 用户，进入到开始复制的原始路径。</p><p><img src="http://image2.ishareread.com/images/2025/20250614/8-%E5%88%87%E6%8D%A2root%E7%94%A8%E6%88%B7%E8%BF%9B%E5%85%A5dify%E7%9B%AE%E5%BD%95.png" alt="切换root用户"></p><p>通过<code>git clone https://gitee.com/dify_ai/dify</code> 命令clone项目</p><p><img src="http://image2.ishareread.com/images/2025/20250614/9-clonedify.png" alt="clone项目"></p><p>进入到dify下的docker目录，将.env.example 复制成.env文件</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> dify/docker</span><br><span class="line">cp .env.example .env</span><br></pre></td></tr></table></figure><p>.env文件中配置的是dify的一些环境变量，dify默认的web端口是80，为了避免80端口冲突，我们把dify的默认端口改成8080，修改.env的配置文件，将docker输出的Nginx端口改成8080，Nginx的SSL端口改成8443。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">EXPOSE_NGINX_PORT=8080</span><br><span class="line">EXPOSE_NGINX_SSL_PORT=8080</span><br></pre></td></tr></table></figure><p><img src="http://image2.ishareread.com/images/2025/20250614/10-%E4%BF%AE%E6%94%B9%E7%AB%AF%E5%8F%A3.png" alt="修改端口"></p><p>然后执行 <code>docker compose up -d</code> 就可以完成dify的安装</p><p><img src="http://image2.ishareread.com/images/2025/20250614/11-%E5%AE%89%E8%A3%85dify.png" alt="安装dify"></p><p>安装完成后通过NAS的内网IP就可以访问到dify的初始化界面<br><a href="http://192.168.0.18:8080/install" target="_blank" rel="noopener">http://192.168.0.18:8080/install</a><br>通过简单的配置，配置用户名、口令就可以正式使用dify了。</p><p><img src="http://image2.ishareread.com/images/2025/20250614/12-%E5%86%85%E7%BD%91%E8%AE%BF%E9%97%AEdify.png" alt="内网访问dify"></p><h2 id="三、设置外网访问"><a href="#三、设置外网访问" class="headerlink" title="三、设置外网访问"></a>三、设置外网访问</h2><p>为了随时随地的访问和使用dify我们要对dify进行端口映射，使用nas的ddns来进行外网访问。</p><h3 id="1、外网端口映射"><a href="#1、外网端口映射" class="headerlink" title="1、外网端口映射"></a>1、外网端口映射</h3><p>在路由器上添加一条映射规则，将内网的8080端口映射到外网的某个端口上。</p><p><img src="http://image2.ishareread.com/images/2025/20250614/12-%E5%A4%96%E7%BD%91%E7%AB%AF%E5%8F%A3%E6%98%A0%E5%B0%84.png" alt="外网端口映射"></p><h3 id="2、在飞牛nas上进行ddns配置"><a href="#2、在飞牛nas上进行ddns配置" class="headerlink" title="2、在飞牛nas上进行ddns配置"></a>2、在飞牛nas上进行ddns配置</h3><p>如有域名就可以配置阿里云或Cloudflare的ddns服务</p><p><img src="http://image2.ishareread.com/images/2025/20250614/13-DDNS%E9%85%8D%E7%BD%AE.png" alt="DDNS配置"></p><p>这样就可以通过域名+端口直接访问NAS上的dify应用，随时随地构建和调试自己的AI应用了。</p><p><img src="http://image2.ishareread.com/images/2025/20250614/14-%E5%A4%96%E7%BD%91%E8%AE%BF%E9%97%AEdify.png" alt="外网访问"></p><hr><p>作者博客：<a href="http://xiejava.ishareread.com/">http://xiejava.ishareread.com/</a></p><center> <br><p><img src="http://image2.ishareread.com/images/fullbug%E5%BE%AE%E4%BF%A1%E5%85%AC%E4%BC%97%E5%8F%B7.jpg" alt="“fullbug”微信公众号" title="“fullbug”微信公众号"> </p><p>关注：微信公众号,一起学习成长！</center></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;作为一名程序员，在AI蓬勃发展的时代，一定要拥抱AI。&lt;strong&gt;Dify&lt;/strong&gt; 是一款开源的大语言模型(LLM) 应用开发平台。它融合了后端即服务（Backend as Service）和 LLMOps 的理念，使开发者可以快速搭建生产级的生成式 AI 应
      
    
    </summary>
    
    
      <category term="技术" scheme="http://xiejava.ishareread.com/categories/%E6%8A%80%E6%9C%AF/"/>
    
    
      <category term="AI机器学习" scheme="http://xiejava.ishareread.com/tags/AI%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/"/>
    
      <category term="NAS" scheme="http://xiejava.ishareread.com/tags/NAS/"/>
    
  </entry>
  
  <entry>
    <title>什么是RACI矩阵，应用在什么场景？</title>
    <link href="http://xiejava.ishareread.com/posts/a95e359b/"/>
    <id>http://xiejava.ishareread.com/posts/a95e359b/</id>
    <published>2025-04-08T02:58:36.000Z</published>
    <updated>2025-12-10T07:13:20.215Z</updated>
    
    <content type="html"><![CDATA[<h2 id="一、什么是RACI"><a href="#一、什么是RACI" class="headerlink" title="一、什么是RACI"></a>一、什么是RACI</h2><p>RACI矩阵是一种用于明确项目或任务中角色与责任的管理工具，通过定义不同人员在任务中的参与程度来避免职责不清的问题。以下是其核心要点：</p><ol><li>‌RACI的含义‌</li></ol><ul><li>‌R（Responsible）执行者‌：直接完成任务的具体负责人。</li><li>‌A（Accountable）批准者‌：对任务结果负最终责任，通常为决策者。</li><li>‌C（Consulted）被咨询者‌：提供专业意见的专家或利益相关方。</li><li>‌I（Informed）被通知者‌：需知悉进展但不直接参与的人员。</li></ul><ol start="2"><li>‌典型应用场景‌</li></ol><ul><li>‌跨部门协作项目‌：例如新产品发布，需明确市场、研发、生产等部门的职责。</li><li>‌复杂流程优化‌：如企业ERP系统实施，区分流程设计、数据迁移等任务的责任人。</li><li>‌危机管理‌：如安全事故处理时明确指挥、执行、沟通等角色。</li><li>‌日常运营‌：适用于周期性工作（如财务审计）的职责划分。</li></ul><ol start="3"><li>‌使用案例‌</li></ol><ul><li>‌软件开发项目‌：</li></ul><table><thead><tr><th>任务</th><th>项目经理（A）</th><th>开发团队（R）</th><th>测试组（R）</th><th>客户（C）</th><th>法务（I）</th></tr></thead><tbody><tr><td>需求确认</td><td>A</td><td>R</td><td>-</td><td>C</td><td>I</td></tr><tr><td>代码审查</td><td>R</td><td>C</td><td>-</td><td>-</td><td></td></tr></tbody></table><ol start="4"><li>构建要点‌</li></ol><ul><li>每个任务确保‌仅1个A角色‌，避免多头领导</li><li>避免R角色过多导致执行分散（如单个任务超过3个R）</li><li>关键干系人必须纳入C或I，防止遗漏重要意见</li></ul><ol start="5"><li>常见误区‌</li></ol><ul><li>混淆A和R角色（如误将部门领导设为所有任务的A）</li><li>过度咨询（C角色过多导致决策延迟）</li><li>忽略变更管理（未随项目进展更新矩阵）</li></ul><h2 id="二、如何适用RACI矩阵"><a href="#二、如何适用RACI矩阵" class="headerlink" title="二、如何适用RACI矩阵"></a>二、如何适用RACI矩阵</h2><p>结合不同场景的关键步骤与操作要点：</p><ol><li><p><strong>前期准备‌</strong></p><ul><li>分解任务清单‌<br>基于项目目标，将工作拆解为具体任务（如软件开发中的需求收集、测试、部署等）‌。<br>示例：在IT系统迁移项目中，任务可拆分为“制定迁移方案”“数据备份验证”等‌。</li><li>识别参与角色‌<br>列出所有相关角色或部门（如项目经理、开发团队、法务部等），避免仅使用个人姓名，需标注岗位或职能‌。</li></ul></li><li><p><strong>构建矩阵‌</strong></p><ul><li>分配RACI角色‌<br>○ 每个任务需指定 ‌1个A角色‌（唯一责任人）和若干R/C/I角色‌。<br>示例：在需求确认阶段，产品经理为A，开发团队为R，法务部为I‌。<br>○ 避免单任务分配过多R角色（建议≤3个），防止执行分散‌。</li><li>关键逻辑验证‌<br>○ ‌横向检查‌：每项任务需至少包含R和A角色，确保无遗漏‌。<br>○ ‌纵向检查‌：单个角色名下任务量需合理，避免过度集中（如某成员承担过多R角色）‌。</li></ul></li><li><p><strong>应用中的关键技巧‌</strong></p><ul><li>与项目工具结合‌<br>○ 将RACI矩阵与甘特图、WBS（工作分解结构）联动，识别关键路径任务并优先分配资源‌。<br>示例：在部署阶段，明确运维团队为R角色并与甘特图中的时间节点对齐‌。</li><li>动态更新机制‌<br>○ 项目变更时同步调整矩阵（如新增任务或角色变更）‌。<br>○ 定期向I角色推送进展（如周报同步），向C角色发起咨询（如需求评审会）‌。</li></ul></li><li><p><strong>常见问题与规避策略‌</strong></p></li></ol><table><thead><tr><th>问题类型</th><th>解决方案</th></tr></thead><tbody><tr><td>‌角色冲突‌（多个A）</td><td>重新界定任务边界，仅保留1个A角色‌。</td></tr><tr><td>‌沟通低效‌（C/I过多）</td><td>精简咨询范围（如仅核心专家参与C角色），减少非必要通知‌。</td></tr><tr><td>‌ 责任模糊‌（无明确R）</td><td>通过工作分解细化任务颗粒度，确保每个子任务均有R角色‌。</td></tr></tbody></table><ol start="5"><li>扩展应用场景‌</li></ol><ul><li>‌RASCI矩阵‌：在RACI基础上增加S（Support）角色，标注辅助支持团队（如IT部门协助数据迁移）‌15。</li><li>‌多层级矩阵‌：针对复杂项目分层设计（如战略级、执行级），分别分配责任‌7。</li></ul><p>总结：核心操作流程<br>1.‌分解任务 → 2. 定义角色 → 3. 填充矩阵 → 4. 验证逻辑 → 5. 动态维护‌<br>示例：某市政工程通过RACI矩阵将环评报告责任唯一分配给环保机构（A角色），施工执行由承包商（R角色）承担，社区代表仅需知悉（I角色）‌。<br>通过结构化分配与持续优化，RACI矩阵可显著提升跨团队协作效率，减少责任争议‌。</p><h2 id="三、应用案例"><a href="#三、应用案例" class="headerlink" title="三、应用案例"></a>三、应用案例</h2><ol><li>IT系统升级项目‌<br>‌背景‌：某企业需将本地服务器迁移至云端，涉及IT部、安全部、财务部及外部供应商。<br>‌任务分解与角色分配‌：</li></ol><table><thead><tr><th>任务</th><th>IT经理 (A)</th><th>运维团队 （R）</th><th>安全部 （C）</th><th>财务部 （I）</th><th>供应商 （R）</th></tr></thead><tbody><tr><td>制定迁移方案</td><td>A</td><td>R</td><td>C</td><td>I</td><td>C</td></tr><tr><td>数据备份与验证</td><td>I</td><td>R</td><td>C</td><td>-</td><td>R</td></tr><tr><td>云环境安全测试</td><td>-</td><td>C</td><td>A</td><td>I</td><td>R</td></tr></tbody></table><p>‌关键点‌：</p><ul><li>安全部需深度参与方案设计和测试（C/A角色），避免安全漏洞；</li><li>供应商负责具体执行（R），但需接受IT经理的最终审批（A）。</li></ul><ol start="2"><li>日常运维（IT支持团队）‌<br>‌背景‌：某公司IT部门处理日常故障，需明确一线支持、二线专家及管理层职责。</li></ol><table><thead><tr><th>任务</th><th>IT主管 (A)</th><th>一线支持 (R)</th><th>二线专家 (C)</th><th>用户部门 (I)</th></tr></thead><tbody><tr><td>故障初步诊断</td><td>-</td><td>R</td><td>-</td><td>I</td></tr><tr><td>复杂问题升级处理</td><td>I</td><td>-</td><td>R</td><td>C</td></tr><tr><td>故障解决率报告</td><td>A</td><td>C</td><td>-</td><td>I</td></tr></tbody></table><p>‌注意事项‌：</p><ul><li>一线支持直接处理简单问题（R），二线专家解决技术难点（R）；</li><li>用户部门仅需知悉进展（I），避免干扰技术处理。</li></ul><p>从以上看出，RACI矩阵适用于‌任何<strong>需要明确角色分工的场景‌</strong>，尤其适合跨职能、多利益相关方的复杂任务。</p><hr><p>作者博客：<a href="http://xiejava.ishareread.com/">http://xiejava.ishareread.com/</a></p><center> <br><p><img src="http://image2.ishareread.com/images/fullbug%E5%BE%AE%E4%BF%A1%E5%85%AC%E4%BC%97%E5%8F%B7.jpg" alt="“fullbug”微信公众号" title="“fullbug”微信公众号"> </p><p>关注：微信公众号,一起学习成长！</center></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;一、什么是RACI&quot;&gt;&lt;a href=&quot;#一、什么是RACI&quot; class=&quot;headerlink&quot; title=&quot;一、什么是RACI&quot;&gt;&lt;/a&gt;一、什么是RACI&lt;/h2&gt;&lt;p&gt;RACI矩阵是一种用于明确项目或任务中角色与责任的管理工具，通过定义不同人员在任务中
      
    
    </summary>
    
    
      <category term="管理" scheme="http://xiejava.ishareread.com/categories/%E7%AE%A1%E7%90%86/"/>
    
      <category term="项目管理" scheme="http://xiejava.ishareread.com/categories/%E7%AE%A1%E7%90%86/%E9%A1%B9%E7%9B%AE%E7%AE%A1%E7%90%86/"/>
    
    
      <category term="项目管理" scheme="http://xiejava.ishareread.com/tags/%E9%A1%B9%E7%9B%AE%E7%AE%A1%E7%90%86/"/>
    
      <category term="学习方法" scheme="http://xiejava.ishareread.com/tags/%E5%AD%A6%E4%B9%A0%E6%96%B9%E6%B3%95/"/>
    
  </entry>
  
</feed>
